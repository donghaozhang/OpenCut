(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[499],{26:(e,t,a)=>{"use strict";a.d(t,{N:()=>c});var r=a(2869),s=a(2547),i=a(2435),n=a(9221),l=a(4667),o=a(3911),d=a(5655);class c{log(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];this.enableLogging&&console.log(...t)}async preloadImages(){let e=this.timelineElements.filter(e=>{if("media"!==e.type)return!1;let t=this.mediaItems.find(t=>t.id===e.mediaId);return(null==t?void 0:t.type)==="image"});if(0===e.length)return void this.log("No images to preload");this.log("Pre-loading ".concat(e.length," images as ImageBitmap"));let t=0;await Promise.all(e.map(async(a,r)=>{let s=this.mediaItems.find(e=>e.id===a.mediaId);if(s)try{var i;if(!s.url)return void this.log("No URL for media item:",a.mediaId);let r=await fetch(s.url),n=await r.blob(),l=await createImageBitmap(n);this.imageBitmapCache.set(a.mediaId,l),t++;let o=3+t/e.length*2;null==(i=this.onProgress)||i.call(this,Math.floor(o),"Loading images... (".concat(t,"/").concat(e.length,")"))}catch(e){this.log("Failed to preload image:",a.mediaId,e),t++}}))}async preloadVideoFrames(){let e=this.timelineElements.filter(e=>{if("media"!==e.type)return!1;let t=this.mediaItems.find(t=>t.id===e.mediaId);return(null==t?void 0:t.type)==="video"});if(0===e.length)return void this.log("No videos to preload frames for");this.log("Pre-decoding frames for ".concat(e.length," videos"));let t=0;await Promise.all(e.map(async a=>{let r=this.mediaItems.find(e=>e.id===a.mediaId);if(!r||!r.duration)return;let s=document.createElement("video");s.src=r.url||"",s.crossOrigin="anonymous";let i=new Map,n=Math.ceil(r.duration/1),l=0;try{await s.load();for(let a=0;a<r.duration;a+=1){var o;s.currentTime=a,await new Promise(e=>{s.onseeked=e});let r=await createImageBitmap(s);i.set(Math.floor(a),r),l++;let d=5+(t*n+l)/(e.length*n)*3;null==(o=this.onProgress)||o.call(this,Math.floor(d),"Decoding video frames... (".concat(l,"/").concat(n," frames)"))}this.videoFrameCache.set(a.mediaId,i),t++}catch(e){this.log("Failed to preload video frames:",a.mediaId,e),t++}}))}async startExport(){var e,t,a,r,i,l,d,c,m,u,p;if(this.log("Starting optimized export"),this.isExporting)throw new o.ze("Export already in progress","EXPORT_IN_PROGRESS");try{this.isExporting=!0;let p=(0,o.zG)();if(!p.supported)throw new o.pE("Browser not supported: ".concat(p.issues.join(", ")),p.issues);this.startMemoryMonitoring();let h=this.calculateActualVideoDuration();if(Math.abs(this.duration-h)>.5){let e=Math.min(this.duration,h+.1);this.log("Adjusting export duration from ".concat(this.duration,"s to ").concat(e,"s")),this.duration=e,this.captureService=new s.$({fps:this.fps,duration:e,width:this.settings.width,height:this.settings.height},this.settings,this.timelineElements)}null==(e=this.onProgress)||e.call(this,2,"Analyzing timeline content..."),this.duration<15?(this.log("Short video detected (".concat(this.duration,"s) - skipping some pre-loading optimizations")),null==(l=this.onProgress)||l.call(this,5,"Loading video elements..."),await this.preloadMediaElements(),null==(d=this.onProgress)||d.call(this,8,"Short video - rendering directly...")):(null==(c=this.onProgress)||c.call(this,3,"Pre-loading images..."),await this.preloadImages(),null==(m=this.onProgress)||m.call(this,5,"Pre-decoding video keyframes..."),await this.preloadVideoFrames(),null==(u=this.onProgress)||u.call(this,8,"Loading video elements..."),await this.preloadMediaElements()),null==(t=this.onProgress)||t.call(this,10,"Initializing video encoder..."),await this.recorder.startRecording(),await this.initializeAudioTracks(),null==(a=this.onProgress)||a.call(this,15,"Rendering video frames..."),this.exportStartTime=performance.now();let g=(0,n.D)()?await this.renderFramesOfflineOptimized():await this.renderFramesOptimized();return null==(r=this.onProgress)||r.call(this,90,"Finalizing export..."),this.log("Audio mixing skipped - not implemented in optimized version"),null==(i=this.onProgress)||i.call(this,100,"Export complete!"),g}catch(t){(0,o.Te)(t,"ExportEngine.startExport");let e=(0,o.Ob)(t);throw null==(p=this.onError)||p.call(this,e),t}finally{this.isExporting=!1,this.stopMemoryMonitoring(),this.cleanup()}}async renderFramesOptimized(){return new Promise((e,t)=>{let a=this.captureService.getTotalFrames(),r=0,s=0,i=1e3/this.fps;this.log("Starting optimized frame rendering: ".concat(a," frames"));let n=async l=>{if(this.shouldCancel)return void t(Error("Export cancelled"));let o=this.duration<15;if(r%(o?300:60)==0)try{this.checkMemoryStatus()}catch(e){t(e);return}if(r>=a){this.log("All frames rendered"),this.recorder.stopRecording().then(e).catch(t);return}try{let e=this.captureService.getFrameData(r);await this.renderSingleFrameOptimized(e);let t=15+Math.floor(r/a*75);if(t>s+2){var c;s=t;let e=d.aW.getMemorySummary(),i=this.calculateETA(r,a,performance.now()-(this.exportStartTime||0));null==(c=this.onProgress)||c.call(this,t,"Rendering frame ".concat(r+1,"/").concat(a," - ETA: ").concat(i," (").concat(e,")"))}r++,setTimeout(()=>{n(performance.now())},i)}catch(e){t(e)}};n(performance.now())})}async renderSingleFrameOptimized(e){if(!e||!e.elements)throw new o.$l("Invalid frame data provided",{frameNumber:-1,timestamp:-1,error:Error("frameData is undefined")});let t=this.canvas.getContext("2d");if(!t)throw Error("Canvas context not available");try{this.renderer.clearFrame(this.getBackgroundColor());let a=e.elements;t.save();let r=this.groupElementsByType(a);for(let t of r.images)await this.renderImageElementOptimized(t,e.timestamp);for(let t of r.videos)await this.renderVideoElementOptimized(t,e.timestamp);for(let e of r.text)this.renderTextElement(e,this.calculateBounds(e));t.restore()}catch(t){throw new o.$l("Failed to render frame ".concat(e.frameNumber),{frameNumber:e.frameNumber,timestamp:e.timestamp,error:t})}}async renderImageElementOptimized(e,t){var a;let r=this.mediaItems.find(t=>t.id===e.mediaId);if(console.log("\uD83D\uDD0D EXPORT-ENGINE: renderImageElementOptimized called",{elementId:e.id,mediaId:e.mediaId,hasMediaItem:!!r,mediaName:null==r?void 0:r.name,isGenerated:(null==r||null==(a=r.metadata)?void 0:a.source)==="text2image"}),!r)return;let s=this.duration<15,i=s?null:this.imageBitmapCache.get(e.mediaId);if(!i)return s||this.log("ImageBitmap not found in cache, falling back to regular rendering"),console.log("\uD83D\uDD04 EXPORT-ENGINE: Falling back to renderImageElement for",{mediaId:e.mediaId,reason:s?"short video":"no bitmap cache"}),await this.renderImageElement(e,this.calculateBounds(e));let n=this.calculateBounds(e),l=this.canvas.getContext("2d");l&&(l.save(),l.drawImage(i,n.x,n.y,n.width,n.height),l.restore())}async renderVideoElementOptimized(e,t){let a=this.duration<15?null:this.videoFrameCache.get(e.mediaId);if(!a||0===a.size)return this.renderVideoElement(e,this.calculateBounds(e),t);let r=Math.floor(Math.max(0,Math.min(t-(e.startTime||0)+(e.trimStart||0),Math.max(0,e.duration-.1)))),s=a.get(r);if(!s&&r>0&&(s=a.get(r-1)),!s)return this.renderVideoElement(e,this.calculateBounds(e),t);{let t=this.calculateBounds(e),a=this.canvas.getContext("2d");if(!a)return;a.save(),a.drawImage(s,t.x,t.y,t.width,t.height),a.restore()}}groupElementsByType(e){let t={images:[],videos:[],text:[]};for(let s of(console.log("\uD83D\uDD0D EXPORT-ENGINE: Grouping elements by type",{totalElements:e.length,elementTypes:e.map(e=>e.type)}),e))if("text"===s.type)t.text.push(s);else if("media"===s.type){var a,r;let e=s,i=this.mediaItems.find(t=>t.id===e.mediaId);console.log("\uD83D\uDCCA EXPORT-ENGINE: Processing media element",{elementId:s.id,mediaId:e.mediaId,hasMediaItem:!!i,mediaType:null==i?void 0:i.type,mediaName:null==i?void 0:i.name,isGenerated:(null==i||null==(a=i.metadata)?void 0:a.source)==="text2image"}),(null==i?void 0:i.type)==="image"?(t.images.push(s),console.log("\uD83D\uDDBC️ EXPORT-ENGINE: Added to images group",{elementId:s.id,mediaName:i.name,isGenerated:(null==(r=i.metadata)?void 0:r.source)==="text2image"})):(null==i?void 0:i.type)==="video"?(t.videos.push(s),console.log("\uD83C\uDFA5 EXPORT-ENGINE: Added to videos group",{elementId:s.id,mediaName:i.name})):console.warn("⚠️ EXPORT-ENGINE: Media element has unknown type",{elementId:s.id,mediaId:e.mediaId,mediaType:null==i?void 0:i.type,mediaItem:i})}return console.log("✅ EXPORT-ENGINE: Element grouping complete",{imageCount:t.images.length,videoCount:t.videos.length,textCount:t.text.length}),t}calculateBounds(e){return this.captureService.calculateElementBounds(e,this.settings.width,this.settings.height)}cleanup(){for(let e of this.imageBitmapCache.values())e.close();for(let e of(this.imageBitmapCache.clear(),this.videoFrameCache.values()))for(let t of e.values())t.close();this.videoFrameCache.clear(),this.preloadedVideos.clear()}async renderFramesOfflineOptimized(){var e,t;let a=this.captureService.getTotalFrames();for(let e=0;e<a;e++){if(this.shouldCancel)throw Error("Export cancelled");if(e%(this.duration<15?300:60)==0)try{this.checkMemoryStatus()}catch(e){throw e}let r=this.captureService.getFrameData(e);await this.renderSingleFrameOptimized(r);let s=this.canvas.toDataURL("image/png");await this.recorder.addFrame(s,e);let i=15+Math.floor(e/a*75);if(i%2==0){let r=d.aW.getMemorySummary(),s=this.calculateETA(e,a,performance.now()-(this.exportStartTime||0));null==(t=this.onProgress)||t.call(this,i,"Rendering frame ".concat(e+1,"/").concat(a," - ETA: ").concat(s," (").concat(r,")"))}}return null==(e=this.onProgress)||e.call(this,50,"Encoding video..."),this.recorder.stopRecording()}calculateActualVideoDuration(){return this.log("Using timeline duration:",this.duration),this.duration}getBackgroundColor(){return"#000000"}async preloadMediaElements(){let e=this.timelineElements.filter(e=>{var t;return"media"===e.type&&(null==(t=this.getMediaItem(e.mediaId))?void 0:t.type)==="video"});if(0===e.length)return void this.log("No video elements to preload");this.log("Pre-loading ".concat(e.length," video elements"));let t=0;for(let r of e){let s=this.getMediaItem(r.mediaId);if(!s)continue;let i=document.createElement("video");i.src=s.url||"",i.crossOrigin="anonymous",i.preload="auto";try{var a;await new Promise((e,t)=>{i.onloadeddata=()=>e(),i.onerror=()=>t(Error("Failed to load video: ".concat(s.url)))}),this.preloadedVideos.set(r.mediaId,i),t++;let n=8+t/e.length*2;null==(a=this.onProgress)||a.call(this,Math.floor(n),"Loading video elements... (".concat(t,"/").concat(e.length,")"))}catch(e){this.log("Failed to preload video element:",r.mediaId,e),t++}}}getMediaItem(e){return this.mediaItems.find(t=>t.id===e)}startMemoryMonitoring(){this.memoryMonitoringStarted||(d.aW.startMonitoring(1e3),this.memoryMonitoringStarted=!0)}stopMemoryMonitoring(){this.memoryMonitoringStarted&&(d.aW.stopMonitoring(),this.memoryMonitoringStarted=!1)}checkMemoryStatus(){let e=(0,d.Ml)(this.settings.width,this.settings.height,this.duration,this.fps),t=d.aW.checkFileSafety(e);if(t&&"error"===t.level)throw new o.E3(t.message,{estimatedBytes:e,level:t.level});if(t&&("warning"===t.level||"critical"===t.level)){var a;null==(a=this.onProgress)||a.call(this,this.lastProgress||0,"⚠️ ".concat(t.message))}}calculateETA(e,t,a){if(0===e)return"Calculating...";let r=(t-e)/(e/a);return r<1e3?"<1s":r<6e4?"".concat(Math.round(r/1e3),"s"):r<36e5?"".concat(Math.round(r/6e4),"m ").concat(Math.round(r%6e4/1e3),"s"):"".concat(Math.round(r/36e5),"h ").concat(Math.round(r%36e5/6e4),"m")}async initializeAudioTracks(){this.log("Audio track initialization skipped - not implemented in optimized version")}async renderVideoElement(e,t,a){let r=this.preloadedVideos.get(e.mediaId);if(!r){let t=this.getMediaItem(e.mediaId);if(!(null==t?void 0:t.url))return void this.log("No media item or URL found for:",e.mediaId);this.log("Creating video element on demand for short video"),(r=document.createElement("video")).src=t.url,r.crossOrigin="anonymous",r.preload="auto",await new Promise((e,a)=>{r.onloadeddata=()=>e(),r.onerror=()=>a(Error("Failed to load video: ".concat(t.url))),setTimeout(()=>a(Error("Video load timeout")),5e3)})}let s=a-(e.startTime||0)+(e.trimStart||0);if(s<0)return;let i=Math.min(s,Math.max(0,e.duration-.1));Math.abs(r.currentTime-i)>.05&&(r.currentTime=i,await new Promise(e=>{let t=setTimeout(()=>{this.log("Seek timeout for time ".concat(i,", using current frame")),e()},200);r.onseeked=()=>{clearTimeout(t),e()}})),this.renderer.save(),this.renderer.drawImage(r,t.x,t.y,t.width,t.height),this.renderer.restore()}async renderImageElement(e,t){var a,r,s,i,n,l,o;let d=this.getMediaItem(e.mediaId);if(console.log("\uD83D\uDDBC️ EXPORT-ENGINE: Processing image element",{elementId:e.id,mediaId:e.mediaId,elementType:e.type,hasMediaItem:!!d,mediaItemData:d?{name:d.name,type:d.type,hasFile:!!d.file,fileSize:null==(a=d.file)?void 0:a.size,fileType:null==(r=d.file)?void 0:r.type,hasUrl:!!d.url,urlLength:null==(s=d.url)?void 0:s.length,urlType:(null==(i=d.url)?void 0:i.startsWith("blob:"))?"blob":(null==(n=d.url)?void 0:n.startsWith("data:"))?"data":"other",isGenerated:(null==(l=d.metadata)?void 0:l.source)==="text2image",metadata:d.metadata}:null,bounds:t}),!(null==d?void 0:d.url))return void console.error("❌ EXPORT-ENGINE: No media item or URL found",{elementId:e.id,mediaId:e.mediaId,hasMediaItem:!!d,hasUrl:!!(null==d?void 0:d.url)});let c=new Image;c.crossOrigin="anonymous";let m=performance.now();console.log("⏱️ EXPORT-ENGINE: Starting image load",{mediaId:e.mediaId,url:d.url.substring(0,100)+(d.url.length>100?"...":""),isGenerated:(null==(o=d.metadata)?void 0:o.source)==="text2image",timestamp:new Date().toISOString(),bounds:t}),await new Promise((t,a)=>{c.onload=()=>{let a=performance.now()-m;console.log("✅ EXPORT-ENGINE: Image loaded successfully",{mediaId:e.mediaId,loadTimeMs:Math.round(a),imageSize:{width:c.naturalWidth,height:c.naturalHeight},complete:c.complete,src:c.src.substring(0,100)+"..."}),t()},c.onerror=t=>{var r;let s=performance.now()-m;console.error("\uD83D\uDEA8 EXPORT-ENGINE: Image load failed",{mediaId:e.mediaId,name:d.name,url:(d.url||"").substring(0,100)+"...",loadTimeMs:Math.round(s),error:t,errorType:(null==t?void 0:t.type)||"unknown",isGenerated:(null==(r=d.metadata)?void 0:r.source)==="text2image"}),d.url&&fetch(d.url).then(t=>{console.log("\uD83D\uDD0D EXPORT-ENGINE: URL fetch test result",{mediaId:e.mediaId,status:t.status,statusText:t.statusText,contentType:t.headers.get("content-type"),ok:t.ok})}).catch(t=>{console.error("\uD83D\uDEA8 EXPORT-ENGINE: URL fetch test failed",{mediaId:e.mediaId,fetchError:t.message})}),this.log("Failed to load image:",d.url),a(Error("Failed to load image: ".concat(d.url)))},setTimeout(()=>{let t=performance.now()-m;console.error("⏰ EXPORT-ENGINE: Image load timeout (5s)",{mediaId:e.mediaId,name:d.name,loadTimeMs:Math.round(t),imageState:{complete:c.complete,naturalWidth:c.naturalWidth,naturalHeight:c.naturalHeight,readyState:c.readyState||"unknown"}}),a(Error("Image load timeout"))},5e3),c.src=d.url||""}),console.log("\uD83C\uDFA8 EXPORT-ENGINE: About to draw image to canvas",{mediaId:e.mediaId,bounds:t,imageReady:c.complete&&c.naturalWidth>0}),this.renderer.save(),this.renderer.drawImage(c,t.x,t.y,t.width,t.height),this.renderer.restore(),console.log("✅ EXPORT-ENGINE: Successfully drew image to canvas",{mediaId:e.mediaId,elementId:e.id})}renderTextElement(e,t){"text"===e.type&&(this.renderer.save(),this.renderer.drawText(e.content||"",t.x,t.y,{fontSize:e.fontSize||24,fontFamily:e.fontFamily||"Arial",color:e.color||"#FFFFFF",textAlign:e.textAlign||"left"}),this.renderer.restore())}cancelExport(){this.shouldCancel=!0}static async createDownloadLink(e,t){var a;if("showSaveFilePicker"in window)try{let a=await window.showSaveFilePicker({suggestedName:t,types:[{description:"Video files",accept:{"video/mp4":[".mp4"],"video/webm":[".webm"],"video/quicktime":[".mov"]}}]}),r=await a.createWritable();await r.write(e),await r.close();return}catch(e){if("AbortError"===e.name)return}let r=URL.createObjectURL(e),s=document.createElement("iframe");s.style.display="none",document.body.appendChild(s);let i=s.contentDocument||(null==(a=s.contentWindow)?void 0:a.document);if(i){let e=i.createElement("a");e.href=r,e.download=t,i.body.appendChild(e),e.click(),i.body.removeChild(e)}setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(r)},1e3)}constructor(e){this.isExporting=!1,this.shouldCancel=!1,this.preloadedVideos=new Map,this.memoryMonitoringStarted=!1,this.enableLogging=!1,this.imageBitmapCache=new Map,this.videoFrameCache=new Map,this.lastProgress=0,this.exportStartTime=null,this.log("\uD83C\uDFD7️ Export engine initialized"),this.canvas=e.canvas,this.settings=e.settings,this.timelineElements=e.timelineElements,this.mediaItems=e.mediaItems,this.duration=e.duration,this.fps=e.fps,this.onProgress=e.onProgress,this.onError=e.onError,this.renderer=new r.K(this.canvas,this.settings),this.captureService=new s.$({fps:this.fps,duration:this.duration,width:this.settings.width,height:this.settings.height},this.settings,this.timelineElements);let t=(0,n.D)();this.log("FFmpeg export enabled:",t),t?this.recorder=new n.T({settings:this.settings,fps:this.fps}):this.recorder=new i.g({canvas:this.canvas,settings:this.settings,fps:this.fps}),this.audioMixer=new l.A({sampleRate:44100,channels:2,duration:this.duration})}}},924:(e,t,a)=>{"use strict";a.d(t,{Id:()=>r});let r={"imagen4-ultra":{id:"imagen4-ultra",name:"Imagen4 Ultra",description:"Google's latest high-quality model with exceptional photorealism",provider:"Google",endpoint:"https://fal.run/fal-ai/imagen4/preview/ultra",qualityRating:5,speedRating:3,estimatedCost:"$0.08-0.12",costPerImage:10,maxResolution:"2048x2048",supportedAspectRatios:["1:1","4:3","3:4","16:9","9:16"],defaultParams:{aspect_ratio:"1:1",num_images:1},availableParams:[{name:"aspect_ratio",type:"select",options:["1:1","4:3","3:4","16:9","9:16"],default:"1:1",description:"Image aspect ratio"},{name:"num_images",type:"number",min:1,max:4,default:1,description:"Number of images to generate"}],bestFor:["Photorealistic images","Product photography","Architectural visualization","Nature and landscapes","Portrait photography"],strengths:["Exceptional photorealism","Excellent prompt adherence","High detail and clarity","Natural lighting and shadows","Advanced understanding of complex prompts"],limitations:["Slower generation time","Higher cost per image","May struggle with highly stylized art","Limited creative interpretation"]},"seeddream-v3":{id:"seeddream-v3",name:"SeedDream v3",description:"ByteDance's creative model optimized for artistic and stylized generation",provider:"ByteDance",endpoint:"https://fal.run/fal-ai/bytedance/seedream/v3/text-to-image",qualityRating:4,speedRating:5,estimatedCost:"$0.03-0.06",costPerImage:4,maxResolution:"1536x1536",supportedAspectRatios:["1:1","4:3","3:4","16:9","9:16"],defaultParams:{guidance_scale:2.5,num_images:1},availableParams:[{name:"image_size",type:"select",options:["square_hd","square","portrait_4_3","portrait_16_9","landscape_4_3","landscape_16_9"],default:"square_hd",description:"Output image resolution and aspect ratio"},{name:"guidance_scale",type:"number",min:1,max:10,default:2.5,description:"Controls prompt alignment (1-10)"},{name:"num_images",type:"number",min:1,max:4,default:1,description:"Number of images to generate"},{name:"seed",type:"number",min:0,max:0x7fffffff,default:null,description:"Random seed for reproducible results"}],bestFor:["Artistic illustrations","Concept art and design","Stylized portraits","Creative interpretations","Abstract and surreal art"],strengths:["Fast generation speed","Creative and artistic output","Good style transfer capabilities","Cost-effective","Excellent for iterative design"],limitations:["Less photorealistic than Imagen4","May over-stylize realistic requests","Lower maximum resolution","Sometimes inconsistent quality"]},"flux-pro-v11-ultra":{id:"flux-pro-v11-ultra",name:"FLUX Pro v1.1 Ultra",description:"Latest FLUX model with enhanced detail and professional versatility",provider:"Black Forest Labs",endpoint:"https://fal.run/fal-ai/flux-pro/v1.1-ultra",qualityRating:4,speedRating:4,estimatedCost:"$0.05-0.09",costPerImage:7,maxResolution:"2048x2048",supportedAspectRatios:["1:1","4:3","3:4","16:9","9:16","21:9"],defaultParams:{aspect_ratio:"16:9",num_images:1,safety_tolerance:"2",enable_safety_checker:!0},availableParams:[{name:"aspect_ratio",type:"select",options:["21:9","16:9","4:3","3:2","1:1","2:3","3:4","9:16","9:21"],default:"16:9",description:"Output image aspect ratio"},{name:"num_images",type:"number",min:1,max:4,default:1,description:"Number of images to generate"},{name:"safety_tolerance",type:"select",options:["1","2","3","4","5","6"],default:"2",description:"Safety filtering tolerance (1=strict, 6=permissive)"},{name:"enable_safety_checker",type:"boolean",default:!0,description:"Enable content safety filtering"}],bestFor:["Professional content creation","Versatile image generation","Balanced realism and creativity","Commercial applications","High-resolution outputs"],strengths:["Excellent balance of quality and speed","Professional-grade output","Versatile across many styles","Good prompt understanding","High maximum resolution"],limitations:["Not as creative as SeedDream","Not as photorealistic as Imagen4","Mid-range pricing","May require prompt engineering"]}}},1352:(e,t,a)=>{"use strict";a.d(t,{J:()=>d});var r=a(6029),s=a(5729),i=a(3224),n=a(4650),l=a(2185);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(i.b,{ref:t,className:(0,l.cn)(o(),a),...s})});d.displayName=i.b.displayName},1484:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var r=a(6029);a(5729);var s=a(4650),i=a(2185);let n=(0,s.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,i.cn)(n({variant:a}),t),...s})}},1772:(e,t,a)=>{"use strict";a.d(t,{S:()=>o});var r=a(6029),s=a(5729),i=a(1010),n=a(2162),l=a(2185);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(i.bL,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:(0,r.jsx)(i.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})})});o.displayName=i.bL.displayName},2063:(e,t,a)=>{"use strict";a.d(t,{NR:()=>s,Nb:()=>i,Wm:()=>n});var r=a(6029);function s(e){let{className:t}=e;return(0,r.jsxs)("svg",{className:t,viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]})}function i(e){let{className:t}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 -3.5 256 256",preserveAspectRatio:"xMinYMin meet",children:(0,r.jsxs)("g",{fill:"currentColor",children:[(0,r.jsx)("path",{d:"M127.505 0C57.095 0 0 57.085 0 127.505c0 56.336 36.534 104.13 87.196 120.99 6.372 1.18 8.712-2.766 8.712-6.134 0-3.04-.119-13.085-.173-23.739-35.473 7.713-42.958-15.044-42.958-15.044-5.8-14.738-14.157-18.656-14.157-18.656-11.568-7.914.872-7.752.872-7.752 12.804.9 19.546 13.14 19.546 13.14 11.372 19.493 29.828 13.857 37.104 10.6 1.144-8.242 4.449-13.866 8.095-17.05-28.32-3.225-58.092-14.158-58.092-63.014 0-13.92 4.981-25.295 13.138-34.224-1.324-3.212-5.688-16.18 1.235-33.743 0 0 10.707-3.427 35.073 13.07 10.17-2.826 21.078-4.242 31.914-4.29 10.836.048 21.752 1.464 31.942 4.29 24.337-16.497 35.029-13.07 35.029-13.07 6.94 17.563 2.574 30.531 1.25 33.743 8.175 8.929 13.122 20.303 13.122 34.224 0 48.972-29.828 59.756-58.22 62.912 4.573 3.957 8.648 11.717 8.648 23.612 0 17.06-.148 30.791-.148 34.991 0 3.393 2.295 7.369 8.759 6.117 50.634-16.879 87.122-64.656 87.122-120.973C255.009 57.085 197.922 0 127.505 0"}),(0,r.jsx)("path",{d:"M47.755 181.634c-.28.633-1.278.823-2.185.389-.925-.416-1.445-1.28-1.145-1.916.275-.652 1.273-.834 2.196-.396.927.415 1.455 1.287 1.134 1.923M54.027 187.23c-.608.564-1.797.302-2.604-.589-.834-.889-.99-2.077-.373-2.65.627-.563 1.78-.3 2.616.59.834.899.996 2.08.36 2.65M58.33 194.39c-.782.543-2.06.034-2.849-1.1-.781-1.133-.781-2.493.017-3.038.792-.545 2.05-.055 2.85 1.07.78 1.153.78 2.513-.019 3.069M65.606 202.683c-.699.77-2.187.564-3.277-.488-1.114-1.028-1.425-2.487-.724-3.258.707-.772 2.204-.555 3.302.488 1.107 1.026 1.445 2.496.7 3.258M75.01 205.483c-.307.998-1.741 1.452-3.185 1.028-1.442-.437-2.386-1.607-2.095-2.616.3-1.005 1.74-1.478 3.195-1.024 1.44.435 2.386 1.596 2.086 2.612M85.714 206.67c.036 1.052-1.189 1.924-2.705 1.943-1.525.033-2.758-.818-2.774-1.852 0-1.062 1.197-1.926 2.721-1.951 1.516-.03 2.758.815 2.758 1.86M96.228 206.267c.182 1.026-.872 2.08-2.377 2.36-1.48.27-2.85-.363-3.039-1.38-.184-1.052.89-2.105 2.367-2.378 1.508-.262 2.857.355 3.049 1.398"})]})})}function n(e){let{className:t}=e;return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 353 353",fill:"none",className:t,children:[(0,r.jsxs)("g",{clipPath:"url(#clip0_1_3)",children:[(0,r.jsx)("rect",{x:"-241.816",y:"233.387",width:"592.187",height:"17.765",transform:"rotate(-37 -241.816 233.387)",fill:"white"}),(0,r.jsx)("rect",{x:"-189.907",y:"306.804",width:"592.187",height:"17.765",transform:"rotate(-37 -189.907 306.804)",fill:"white"}),(0,r.jsx)("rect",{x:"-146.928",y:"389.501",width:"592.187",height:"17.765",transform:"rotate(-37 -146.928 389.501)",fill:"white"}),(0,r.jsx)("rect",{x:"-103.144",y:"477.904",width:"592.187",height:"17.765",transform:"rotate(-37 -103.144 477.904)",fill:"white"}),(0,r.jsx)("rect",{x:"-57.169",y:"570.714",width:"592.187",height:"17.765",transform:"rotate(-37 -57.169 570.714)",fill:"white"})]}),(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:"clip0_1_3",children:(0,r.jsx)("rect",{width:"353",height:"353",fill:"white"})})})]})}},2265:(e,t,a)=>{"use strict";a.d(t,{p:()=>d});var r=a(6029),s=a(5729),i=a(5231),n=a(3639),l=a(2185),o=a(6003);let d=s.forwardRef((e,t)=>{let{className:a,type:s,showPassword:d,onShowPasswordChange:c,value:m,...u}=e,p="password"===s,h=p&&c,g=p&&d?"text":s;return(0,r.jsxs)("div",{className:d?"relative w-full":"",children:[(0,r.jsx)("input",{type:g,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",h&&"pr-10",a),ref:t,value:m,...u}),h&&(0,r.jsx)(o.$,{type:"button",variant:"text",size:"icon",onClick:()=>null==c?void 0:c(!d),className:"absolute right-0 top-0 h-full px-3 text-muted-foreground hover:text-foreground","aria-label":d?"Hide password":"Show password",children:d?(0,r.jsx)(i.A,{className:"h-4 w-4"}):(0,r.jsx)(n.A,{className:"h-4 w-4"})})]})});d.displayName="Input"},2435:(e,t,a)=>{"use strict";a.d(t,{g:()=>s});var r=a(4387);class s{setupMediaRecorder(){if(!this.canvas)throw Error("Canvas not available for recording");console.log("\uD83D\uDCF9 Setting up MediaRecorder with FPS:",this.fps);let e=this.canvas.captureStream(this.fps);if(!e)throw Error("Could not capture canvas stream");console.log("✅ Canvas stream captured with FPS:",this.fps),this.stream=new MediaStream,e.getVideoTracks().forEach(e=>{this.stream.addTrack(e)}),this.audioStream&&this.audioStream.getAudioTracks().forEach(e=>{this.stream.addTrack(e)});let t=this.getSupportedMimeType();this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:t,videoBitsPerSecond:this.getVideoBitrate()}),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.onerror=e=>{throw console.error("MediaRecorder error:",e),Error("MediaRecorder error occurred")}}getSupportedMimeType(){let{format:e}=this.settings,t={[r.A.MP4]:["video/mp4; codecs=h264","video/mp4","video/webm; codecs=vp9","video/webm"],[r.A.WEBM]:["video/webm; codecs=vp9","video/webm; codecs=vp8","video/webm"],[r.A.MOV]:["video/mp4; codecs=h264","video/mp4","video/webm; codecs=vp9","video/webm"]};for(let a of t[e]||t[r.A.MP4])if(MediaRecorder.isTypeSupported(a))return a;return"video/webm"}getVideoBitrate(){let{width:e,height:t}=this.settings;return Math.max(1e6,Math.min(1e7,e*t*this.fps*.1))}setAudioStream(e){this.audioStream=e}async startRecording(){if(this.recordedChunks=[],this.setupMediaRecorder(),!this.mediaRecorder)throw Error("MediaRecorder not initialized");console.log("\uD83C\uDFAC Starting video recording with FPS:",this.fps),this.mediaRecorder.start(100)}pauseRecording(){this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.pause()}resumeRecording(){this.mediaRecorder&&"paused"===this.mediaRecorder.state&&this.mediaRecorder.resume()}async stopRecording(){return new Promise((e,t)=>{if(!this.mediaRecorder)return void t(Error("MediaRecorder not initialized"));this.mediaRecorder.onstop=()=>{let t=new Blob(this.recordedChunks,{type:this.getSupportedMimeType()});console.log("✅ Video recording completed:",{chunks:this.recordedChunks.length,totalSize:"".concat((t.size/1024/1024).toFixed(2),"MB"),mimeType:this.getSupportedMimeType()}),e(t)},console.log("\uD83D\uDED1 Stopping video recording"),this.mediaRecorder.stop()})}getState(){if(!this.mediaRecorder)return"inactive";switch(this.mediaRecorder.state){case"recording":return"recording";case"paused":return"paused";default:return"inactive"}}cleanup(){this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.recordedChunks=[]}static isSupported(){return"undefined"!=typeof MediaRecorder&&void 0!==HTMLCanvasElement.prototype.captureStream}constructor(e){this.audioStream=null,this.mediaRecorder=null,this.recordedChunks=[],this.stream=null,this.canvas=e.canvas,this.settings=e.settings,this.fps=e.fps,this.audioStream=e.audioStream||null}}},2547:(e,t,a)=>{"use strict";a.d(t,{$:()=>r});class r{getTotalFrames(){return Math.ceil(this.options.duration*this.options.fps)}getFrameData(e){let t=Math.round(e/this.options.fps*1e3)/1e3,a=this.getVisibleElements(this.timelineElements,t);return{frameNumber:e,timestamp:t,elements:a}}*generateFrames(){let e=this.getTotalFrames();for(let t=0;t<e;t++)yield this.getFrameData(t)}async extractVideoFrame(e,t){return new Promise((a,r)=>{let s=document.createElement("canvas"),i=s.getContext("2d");if(!i)return void r(Error("Could not get 2D context"));s.width=e.videoWidth,s.height=e.videoHeight,e.currentTime=t;let n=()=>{i.drawImage(e,0,0,s.width,s.height),e.removeEventListener("seeked",n),a(s)},l=()=>{e.removeEventListener("seeked",n),e.removeEventListener("error",l),r(Error("Failed to seek video"))};e.addEventListener("seeked",n),e.addEventListener("error",l)})}async createImageElement(e){return new Promise((t,a)=>{let r=new Image;r.onload=()=>t(r),r.onerror=()=>a(Error("Failed to load image")),r.src=e})}calculateElementBounds(e,t,a){return{x:0,y:0,width:t,height:a}}isElementVisible(e,t){let a=e.startTime||0,r=e.trimStart||0,s=e.trimEnd||0,i=Math.max(0,(e.duration||0)-r-s);return t>=a&&t<a+i}sortElementsByLayer(e){return e}getVisibleElements(e,t){let a=e.filter(e=>this.isElementVisible(e,t));return this.sortElementsByLayer(a)}constructor(e,t,a=[]){this.options=e,this.settings=t,this.timelineElements=a}}},2869:(e,t,a)=>{"use strict";a.d(t,{K:()=>r});class r{clearFrame(e){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e&&(this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}drawImage(e,t,a,r,s){var i,n,l,o;console.log("\uD83C\uDFA8 CANVAS-RENDERER: Attempting to draw image",{imageType:e.constructor.name,imageSource:e instanceof HTMLImageElement?(null==(i=e.src)?void 0:i.substring(0,100))+"...":"N/A",imageDimensions:{natural:{width:e instanceof HTMLImageElement?e.naturalWidth:e instanceof HTMLVideoElement?e.videoWidth:e.width,height:e instanceof HTMLImageElement?e.naturalHeight:e instanceof HTMLVideoElement?e.videoHeight:e.height},display:{width:e.width||e.videoWidth,height:e.height||e.videoHeight}},imageState:{complete:!(e instanceof HTMLImageElement)||e.complete,readyState:e instanceof HTMLVideoElement?e.readyState:"N/A"},targetBounds:{x:t,y:a,width:r,height:s},canvasState:{width:this.canvas.width,height:this.canvas.height,contextValid:!!this.ctx}});try{e instanceof HTMLImageElement&&(!e.complete||0===e.naturalWidth||0===e.naturalHeight)&&console.warn("⚠️ CANVAS-RENDERER: Image not fully loaded",{complete:e.complete,naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight,src:(null==(n=e.src)?void 0:n.substring(0,100))+"..."}),this.ctx.drawImage(e,t,a,r,s),console.log("✅ CANVAS-RENDERER: Successfully drew image to canvas",{drawnAt:{x:t,y:a,width:r,height:s},timestamp:new Date().toISOString()})}catch(i){throw console.error("\uD83D\uDEA8 CANVAS-RENDERER: Failed to draw image",{error:i.message,errorName:i.name,imageDetails:{type:e.constructor.name,src:e instanceof HTMLImageElement?(null==(l=e.src)?void 0:l.substring(0,100))+"...":"N/A",complete:e instanceof HTMLImageElement?e.complete:"N/A",naturalWidth:e instanceof HTMLImageElement?e.naturalWidth:"N/A",naturalHeight:e instanceof HTMLImageElement?e.naturalHeight:"N/A"},canvasDetails:{width:this.canvas.width,height:this.canvas.height,contextType:null==(o=this.ctx)?void 0:o.constructor.name},targetBounds:{x:t,y:a,width:r,height:s}}),("SecurityError"===i.name||i.message.includes("tainted"))&&console.error("\uD83D\uDD12 CANVAS-RENDERER: CORS/Security error detected",{errorType:"CORS_VIOLATION",suggestion:"Image may be from different origin or blob URL expired"}),i}}drawText(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{fontSize:s=24,fontFamily:i="Arial, sans-serif",color:n="#000000",textAlign:l="left",textBaseline:o="top",maxWidth:d}=r;this.ctx.font="".concat(s,"px ").concat(i),this.ctx.fillStyle=n,this.ctx.textAlign=l,this.ctx.textBaseline=o,d?this.ctx.fillText(e,t,a,d):this.ctx.fillText(e,t,a)}fillRect(e,t,a,r,s){this.ctx.fillStyle=s,this.ctx.fillRect(e,t,a,r)}drawRect(e,t,a,r,s,i){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;s&&(this.ctx.fillStyle=s,this.ctx.fillRect(e,t,a,r)),i&&(this.ctx.strokeStyle=i,this.ctx.lineWidth=n,this.ctx.strokeRect(e,t,a,r))}applyBlur(e){this.ctx.filter="blur(".concat(e,"px)")}resetFilters(){this.ctx.filter="none"}save(){this.ctx.save()}restore(){this.ctx.restore()}setTransform(e,t,a,r,s,i){this.ctx.setTransform(e,t,a,r,s,i)}toDataURL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",t=arguments.length>1?arguments[1]:void 0;return this.canvas.toDataURL(e,t)}getImageData(e,t,a,r){return this.ctx.getImageData(e,t,a,r)}getDimensions(){return{width:this.canvas.width,height:this.canvas.height}}constructor(e,t){this.canvas=e,this.settings=t;let a=e.getContext("2d");if(!a)throw Error("Could not get 2D context from canvas");this.ctx=a,this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}}},3911:(e,t,a)=>{"use strict";a.d(t,{$l:()=>i,$y:()=>m,E3:()=>l,Ob:()=>o,Te:()=>d,mo:()=>s,pE:()=>n,zG:()=>c,ze:()=>r});class r extends Error{constructor(e,t,a){super(e),this.code=t,this.details=a,this.name="ExportError"}}class s extends r{constructor(e,t){super(e,"AUDIO_MIXER_ERROR",t),this.name="AudioMixerError"}}class i extends r{constructor(e,t){super(e,"CANVAS_RENDER_ERROR",t),this.name="CanvasRenderError"}}class n extends r{constructor(e,t){super(e,"BROWSER_COMPATIBILITY_ERROR",t),this.name="BrowserCompatibilityError"}}class l extends r{constructor(e,t){super(e,"MEMORY_ERROR",t),this.name="MemoryError"}}function o(e){if(e instanceof r)switch(e.code){case"MEDIARECORDER_ERROR":return"Failed to record video. Please check your browser's media recording capabilities.";case"AUDIO_MIXER_ERROR":return"Failed to process audio tracks. Please check your audio files and try again.";case"CANVAS_RENDER_ERROR":return"Failed to render video frames. Please check your video elements and try again.";case"TIMELINE_ERROR":return"Timeline processing error. Please check your project timeline and try again.";case"BROWSER_COMPATIBILITY_ERROR":return"Your browser doesn't support video export. Please try using a modern Chrome or Firefox browser.";case"MEMORY_ERROR":return"Insufficient memory to complete export. Please try exporting at a lower quality or shorter duration.";case"NO_CONTENT":return"Cannot export empty project. Please add some media files to your timeline before exporting.";case"EXPORT_IN_PROGRESS":return"Export is already in progress. Please wait for the current export to complete.";default:return e.message}return e.message||"An unknown error occurred during export."}function d(e,t){console.error("Export Error:",{error:(null==e?void 0:e.message)||"Unknown error",stack:(null==e?void 0:e.stack)||"No stack trace available",context:t,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,originalError:e})}function c(){let e=[];if(window.MediaRecorder||e.push("MediaRecorder API not supported"),HTMLCanvasElement.prototype.captureStream||e.push("Canvas stream capture not supported"),window.AudioContext||window.webkitAudioContext||e.push("Web Audio API not supported"),window.MediaRecorder)try{new MediaRecorder(new MediaStream),["video/webm;codecs=vp9","video/webm;codecs=vp8","video/mp4;codecs=h264"].some(e=>MediaRecorder.isTypeSupported(e))||e.push("No supported video codecs available")}catch(t){e.push("MediaRecorder codec check failed")}return{supported:0===e.length,issues:e}}function m(e,t,a,r){let s=e*t*4*(a*r)/1048576,i=null;return s>2e3?i="Very high memory usage. Export may fail on low-memory devices.":s>1e3&&(i="High memory usage expected. Consider reducing quality or duration."),{estimatedMB:Math.round(s),warning:i}}},4387:(e,t,a)=>{"use strict";a.d(t,{A:()=>r,y:()=>s});var r=function(e){return e.MP4="mp4",e.WEBM="webm",e.MOV="mov",e}({}),s=function(e){return e.HIGH="1080p",e.MEDIUM="720p",e.LOW="480p",e}({})},4567:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>o,TN:()=>c,XL:()=>d});var r=a(6029),s=a(5729),i=a(4650),n=a(2185);let l=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=s.forwardRef((e,t)=>{let{className:a,variant:s,...i}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(l({variant:s}),a),...i})});o.displayName="Alert";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})});d.displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...s})});c.displayName="AlertDescription"},4667:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});class r{addAudioTrack(e){this.audioTracks.push(e)}removeAudioTrack(e){this.audioTracks=this.audioTracks.filter(t=>t.element.id!==e)}clearTracks(){this.audioTracks=[]}async loadAudioBuffer(e){let t=await e.arrayBuffer();return await this.audioContext.decodeAudioData(t)}async loadAudioBufferFromUrl(e){let t=await fetch(e),a=await t.arrayBuffer();return await this.audioContext.decodeAudioData(a)}async mixTracks(){let{sampleRate:e,channels:t,duration:a}=this.options,r=Math.floor(e*a),s=this.audioContext.createBuffer(t,r,e),i=[];for(let e=0;e<t;e++)i.push(s.getChannelData(e));for(let t of this.audioTracks)await this.mixTrack(t,i,e);return s}async mixTrack(e,t,a){let{audioBuffer:r,startTime:s,endTime:i,volume:n,pan:l}=e,o=Math.floor(s*a),d=Math.min(Math.floor(i*a)-o,r.length,t[0].length-o),c=n*(1-Math.max(0,l)),m=n*(1+Math.min(0,l));for(let e=0;e<d;e++){let a=o+e;if(a>=t[0].length)break;let s=r.numberOfChannels>0?r.getChannelData(0)[e]:0,i=r.numberOfChannels>1?r.getChannelData(1)[e]:s;t[0][a]+=s*c,t.length>1&&(t[1][a]+=i*m)}}async exportAudio(){return await this.mixTracks()}async exportAsWav(){let e=await this.mixTracks();return this.audioBufferToWav(e)}audioBufferToWav(e){let t=e.length,a=e.numberOfChannels,r=e.sampleRate,s=t*a*2,i=44+s,n=new ArrayBuffer(i),l=new DataView(n),o=(e,t)=>{for(let a=0;a<t.length;a++)l.setUint8(e+a,t.charCodeAt(a))};o(0,"RIFF"),l.setUint32(4,i-8,!0),o(8,"WAVE"),o(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,a,!0),l.setUint32(24,r,!0),l.setUint32(28,r*a*2,!0),l.setUint16(32,2*a,!0),l.setUint16(34,16,!0),o(36,"data"),l.setUint32(40,s,!0);let d=44;for(let r=0;r<t;r++)for(let t=0;t<a;t++){let a=32767*Math.max(-1,Math.min(1,e.getChannelData(t)[r]));l.setInt16(d,a,!0),d+=2}return new Blob([n],{type:"audio/wav"})}getAudioContext(){return this.audioContext}dispose(){this.audioContext.close(),this.audioTracks=[]}constructor(e){this.audioTracks=[],this.options=e,this.audioContext=new AudioContext({sampleRate:e.sampleRate})}}},4999:(e,t,a)=>{"use strict";a.d(t,{l:()=>r});class r{getCurrentMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize||0:1024*this.frameCount*1024+this.estimateCacheSize()}getMemoryStatus(){let e,t=this.getCurrentMemoryUsage(),a=t/0x40000000,r=t/this.MEMORY_LIMIT,s=8-a;return e=r>this.CRITICAL_THRESHOLD?"critical":r>this.WARNING_THRESHOLD?"warning":s>4?"high":s>2?"medium":"low",{currentUsageBytes:t,currentUsageGB:Number(a.toFixed(1)),percentageUsed:Number((100*r).toFixed(1)),availableGB:Number(s.toFixed(1)),status:e,shouldTriggerGC:r>this.WARNING_THRESHOLD,shouldEmergencyCleanup:r>this.CRITICAL_THRESHOLD}}shouldTriggerGC(){return this.getCurrentMemoryUsage()/this.MEMORY_LIMIT>this.WARNING_THRESHOLD}isMemoryCritical(){return this.getCurrentMemoryUsage()/this.MEMORY_LIMIT>this.CRITICAL_THRESHOLD}getMemoryStatusString(){let e=this.getMemoryStatus();return"".concat(e.currentUsageGB,"GB / 8GB (").concat(e.percentageUsed,"%)")}getOptimalExportSettings(e,t){let a=this.getMemoryStatus().availableGB;return a<2?{bitrate:"4K"===e?15e6:8e6,keyFrameInterval:60,bufferSize:0x4000000,parallelEncoders:1,qualityLevel:"low"}:a<4?{bitrate:"4K"===e?25e6:12e6,keyFrameInterval:30,bufferSize:0x10000000,parallelEncoders:2,qualityLevel:"medium"}:{bitrate:"4K"===e?4e7:2e7,keyFrameInterval:30,bufferSize:0x20000000,parallelEncoders:Math.min(4,navigator.hardwareConcurrency||2),qualityLevel:"high"}}async optimizeMemoryUsage(){let e=performance.now();e-this.lastGCTime<5e3||(console.log("\uD83E\uDDF9 Triggering garbage collection to free memory"),"gc"in window?window.gc():Array(1e6).fill(0).length=0,this.lastGCTime=e,await new Promise(e=>setTimeout(e,100)))}async emergencyCleanup(){console.warn("\uD83D\uDEA8 Emergency memory cleanup triggered"),this.clearImageBitmapCache(),this.clearVideoFrameCache(),await this.optimizeMemoryUsage(),"gc"in window&&(window.gc(),await new Promise(e=>setTimeout(e,200)))}async checkMemoryDuringExport(e){if(this.frameCount=e,e%50!=0)return;let t=this.getMemoryStatus();t.shouldEmergencyCleanup?await this.emergencyCleanup():t.shouldTriggerGC&&await this.optimizeMemoryUsage()}clearImageBitmapCache(){for(let e of this.imageBitmapCache.values())e.close();this.imageBitmapCache.clear(),console.log("\uD83E\uDDF9 Cleared ImageBitmap cache")}clearVideoFrameCache(){for(let e of this.videoFrameCache.values())for(let t of e.values())t.close();this.videoFrameCache.clear(),console.log("\uD83E\uDDF9 Cleared video frame cache")}registerImageBitmap(e,t){this.imageBitmapCache.set(e,t)}registerVideoFrame(e,t,a){this.videoFrameCache.has(e)||this.videoFrameCache.set(e,new Map),this.videoFrameCache.get(e).set(t,a)}estimateCacheSize(){let e=1024*this.imageBitmapCache.size*1024,t=0;for(let e of this.videoFrameCache.values())t+=512*e.size*1024;return e+t}getMemoryBreakdown(){let e=this.getMemoryStatus(),t=1024*this.frameCount*1024,a=1024*this.imageBitmapCache.size*1024,r=0;for(let e of this.videoFrameCache.values())r+=512*e.size*1024;return{total:"".concat(e.currentUsageGB,"GB"),estimated:{frames:"".concat((t/1048576).toFixed(1),"MB"),imageBitmaps:"".concat((a/1048576).toFixed(1),"MB (").concat(this.imageBitmapCache.size," items)"),videoFrames:"".concat((r/1048576).toFixed(1),"MB (").concat(Array.from(this.videoFrameCache.values()).reduce((e,t)=>e+t.size,0)," frames)")}}}constructor(){this.MEMORY_LIMIT=0x200000000,this.WARNING_THRESHOLD=.85,this.CRITICAL_THRESHOLD=.95,this.frameCount=0,this.lastGCTime=0,this.imageBitmapCache=new Map,this.videoFrameCache=new Map}}},5061:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor/project/[project_id]",function(){return a(5493)}])},5493:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>rD});var r,s=a(6029),i=a(5729),n=a(1278),l=a(2718),o=a(2185);let d=e=>{let{className:t,...a}=e;return(0,s.jsx)(l.YZ,{className:(0,o.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...a})},c=l.Zk,m=e=>{let{withHandle:t,className:a,...r}=e;return(0,s.jsx)(l.TW,{className:(0,o.cn)("relative flex w-1 items-center justify-center bg-border/50 hover:bg-border transition-colors after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-1 data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",a),...r})};var u=a(3927),p=a(749),h=a(747),g=a(1130),f=a(2130),x=a(3231),v=a(8961),b=a(949),y=a(2612),w=a(4989),j=a(1637),N=a(8106);let E={ai:{icon:u.A,label:"AI"},media:{icon:p.A,label:"Media"},adjustment:{icon:h.A,label:"Adjustment"},audio:{icon:g.A,label:"Audio"},text:{icon:f.A,label:"Text"},text2image:{icon:x.A,label:"Text2Image"},stickers:{icon:v.A,label:"Stickers"},effects:{icon:b.A,label:"Effects"},transitions:{icon:y.A,label:"Transitions"},captions:{icon:w.A,label:"Captions"},filters:{icon:j.A,label:"Filters"}},S=(0,N.v)(e=>({activeTab:"media",setActiveTab:t=>e({activeTab:t}),aiActiveTab:"text",setAiActiveTab:t=>e({aiActiveTab:t})}));var C=a(4319);let T={toolsPanel:45,previewPanel:75,propertiesPanel:20,mainContent:70,timeline:30,mainContentHeight:75,timelineHeight:25,aiPanelWidth:22,aiPanelMinWidth:4,aiPanelMaxWidth:30},k=(0,N.v)()((0,C.Zr)((e,t)=>({...T,setToolsPanel:t=>e({toolsPanel:t}),setPreviewPanel:t=>e({previewPanel:t}),setPropertiesPanel:t=>e({propertiesPanel:t}),setMainContent:t=>e({mainContent:t}),setTimeline:t=>e({timeline:t}),setMainContentHeight:t=>e({mainContentHeight:t}),setTimelineHeight:t=>e({timelineHeight:t}),setAiPanelWidth:t=>{e({aiPanelWidth:"number"==typeof t&&!isNaN(t)&&t>=0&&t<=100?t:T.aiPanelWidth})},getAiPanelConstraints:()=>{let e=t();return{min:e.aiPanelMinWidth,max:e.aiPanelMaxWidth}},getAiPanelSizeForTab:e=>{let a=t();try{if("ai"===e)return{defaultSize:"number"==typeof a.aiPanelWidth?a.aiPanelWidth:T.aiPanelWidth,minSize:"number"==typeof a.aiPanelMinWidth?a.aiPanelMinWidth:T.aiPanelMinWidth,maxSize:"number"==typeof a.aiPanelMaxWidth?a.aiPanelMaxWidth:T.aiPanelMaxWidth};return{defaultSize:"number"==typeof a.toolsPanel?a.toolsPanel:T.toolsPanel,minSize:15,maxSize:35}}catch(e){return console.warn("Error in getAiPanelSizeForTab:",e),{defaultSize:T.aiPanelWidth,minSize:T.aiPanelMinWidth,maxSize:T.aiPanelMaxWidth}}}}),{name:"panel-sizes"}));var I=a(6003);function M(){let{activeTab:e,setActiveTab:t}=S(),{aiPanelWidth:a,aiPanelMinWidth:r}=k(),n="number"==typeof a?a:22,l=!(n<=("number"==typeof r?r:4)+2)&&!(n<18),d=(0,i.useRef)(null),[c,m]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!0),h=()=>{if(d.current){let{scrollLeft:e,scrollWidth:t,clientWidth:a}=d.current;m(e+a>=t-1),p(e<=1)}};return(0,i.useEffect)(()=>{let e=d.current;if(!e)return;h(),e.addEventListener("scroll",h);let t=new ResizeObserver(h);return t.observe(e),()=>{e.removeEventListener("scroll",h),t.disconnect()}},[]),(0,s.jsx)("div",{className:"border-timeline rounded-sm mb-8 mt-4",children:(0,s.jsx)("div",{ref:d,className:(0,o.cn)("h-18 bg-panel-accent py-2 flex justify-start items-center overflow-x-auto scrollbar-x-hidden relative transition-all duration-200",l?"px-6 gap-12":"px-3 gap-2"),children:Object.keys(E).map(a=>{let r=E[a];return(0,s.jsxs)("div",{className:(0,o.cn)("flex items-center cursor-pointer rounded-lg transition-all duration-200 hover:bg-white/10 flex-shrink-0 group",l?"flex-col gap-2 px-3 pt-3 pb-2 mx-1 min-w-[52px]":"justify-center p-2 mx-0.5 min-w-[40px]",e===a?"bg-white/5":"text-muted-foreground bg-white/5"),onClick:()=>t(a),style:{transform:"scale(1)",color:e===a?"#05c7c7":void 0},onMouseEnter:t=>{e!==a&&(t.currentTarget.style.transform="scale(1.05)")},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[(0,s.jsx)(r.icon,{className:(0,o.cn)("transition-all duration-200 mt-[5px]",l?"!size-[1.5rem]":"!size-[1.2rem]",e!==a&&"group-hover:text-[#05c7c7]")}),l&&(0,s.jsxs)("span",{className:"text-[0.65rem] tracking-wide mt-1 leading-none",children:[r.label,(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-[0.2rem] leading-none",children:"\xa0"})]})]},a)})})})}let A=e=>!e.types.includes("application/x-media-item")&&e.types.includes("Files");var R=a(9688),P=a(6749),D=a(4011);async function L(e,t){let a=Array.from(e),r=[],s=a.length,i=0;for(let e of a){let a,n,l,o,d,c=(0,P.getFileType)(e);if(!c){R.oR.error("Unsupported file type: ".concat(e.name));continue}let m=URL.createObjectURL(e);try{if("image"===c){let t=await (0,P.getImageDimensions)(e);l=t.width,o=t.height}else if("video"===c)try{let t=await (0,D.G5)(e);n=t.duration,l=t.width,o=t.height,d=t.fps,a=await (0,D.I6)(e,1)}catch(r){console.warn("FFmpeg processing failed, falling back to basic processing:",r);let t=await (0,P.generateVideoThumbnail)(e);a=t.thumbnailUrl,l=t.width,o=t.height,n=await (0,P.getMediaDuration)(e)}else"audio"===c&&(n=await (0,P.getMediaDuration)(e));if(r.push({name:e.name,type:c,file:e,url:m,thumbnailUrl:a,duration:n,width:l,height:o,fps:d}),await new Promise(e=>setTimeout(e,0)),i+=1,t){let e=Math.round(i/s*100);t(e)}}catch(t){console.error("Error processing file:",e.name,t),R.oR.error("Failed to process ".concat(e.name)),URL.revokeObjectURL(m)}}return r}var z=a(8748),F=a(3331),_=a(6282);function O(e){let{isVisible:t,title:a="Drop files here",description:r="Images, videos, and audio files"}=e;return t?(0,s.jsx)("div",{className:"absolute inset-0 bg-accent/20 backdrop-blur-lg border-2 border-dashed border-accent flex items-center justify-center z-10 pointer-events-none",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(F.A,{className:"h-8 w-8 text-accent mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm font-medium text-accent",children:a}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:r})]})}):null}var U=a(4309),B=a(5023),H=a(3042),W=a(2162),G=a(158),V=a(4650);let $=B.bL,q=B.l9;B.YJ,B.ZL,B.Pb,B.z6;let X=(0,V.F)("relative flex cursor-pointer select-none items-center gap-2 px-2 py-1.5 text-sm outline-none transition-opacity data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"focus:opacity-65 focus:text-accent-foreground",destructive:"text-destructive focus:text-destructive/80"}},defaultVariants:{variant:"default"}});i.forwardRef((e,t)=>{let{className:a,inset:r,children:i,variant:n="default",...l}=e;return(0,s.jsxs)(B.ZP,{ref:t,className:(0,o.cn)(X({variant:n}),"data-[state=open]:bg-accent data-[state=open]:opacity-65",r&&"pl-8",a),...l,children:[i,(0,s.jsx)(H.A,{className:"ml-auto"})]})}).displayName=B.ZP.displayName,i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(B.G5,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-transparent bg-popover p-1 text-[#05c7c7] shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=B.G5.displayName;let J=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(B.ZL,{children:(0,s.jsx)(B.UC,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-transparent p-1 bg-popover text-[#05c7c7] shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})})});J.displayName=B.UC.displayName;let K=i.forwardRef((e,t)=>{let{className:a,inset:r,variant:i="default",...n}=e;return(0,s.jsx)(B.q7,{ref:t,className:(0,o.cn)(X({variant:i}),r&&"pl-8",a),...n})});K.displayName=B.q7.displayName,i.forwardRef((e,t)=>{let{className:a,children:r,checked:i,variant:n="default",...l}=e;return(0,s.jsxs)(B.H_,{ref:t,className:(0,o.cn)(X({variant:n}),"pl-8 pr-2",a),checked:i,...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(B.VF,{children:(0,s.jsx)(W.A,{className:"h-4 w-4"})})}),r]})}).displayName=B.H_.displayName,i.forwardRef((e,t)=>{let{className:a,children:r,variant:i="default",...n}=e;return(0,s.jsxs)(B.hN,{ref:t,className:(0,o.cn)(X({variant:i}),"pl-8 pr-2",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(B.VF,{children:(0,s.jsx)(G.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=B.hN.displayName,i.forwardRef((e,t)=>{let{className:a,inset:r,...i}=e;return(0,s.jsx)(B.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...i})}).displayName=B.JU.displayName;let Z=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(B.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-foreground/10",a),...r})});Z.displayName=B.wv.displayName;var Y=a(2265),Q=a(9835),ee=a(4556),et=a(3865);let ea=Q.bL;Q.YJ;let er=Q.WT,es=(0,V.F)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none transition-opacity data-[disabled]:pointer-events-none data-[disabled]:opacity-50",{variants:{variant:{default:"focus:opacity-65 focus:text-accent-foreground",destructive:"text-destructive focus:text-destructive/80"}},defaultVariants:{variant:"default"}}),ei=i.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(Q.l9,{ref:t,className:(0,o.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[r,(0,s.jsx)(Q.In,{asChild:!0,children:(0,s.jsx)(ee.A,{className:"h-4 w-4 opacity-50"})})]})});ei.displayName=Q.l9.displayName;let en=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(et.A,{className:"h-4 w-4"})})});en.displayName=Q.PP.displayName;let el=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(ee.A,{className:"h-4 w-4"})})});el.displayName=Q.wn.displayName;let eo=i.forwardRef((e,t)=>{let{className:a,children:r,position:i="popper",...n}=e;return(0,s.jsx)(Q.ZL,{children:(0,s.jsxs)(Q.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,onCloseAutoFocus:e=>{e.preventDefault(),e.stopPropagation()},...n,children:[(0,s.jsx)(en,{}),(0,s.jsx)(Q.LM,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(el,{})]})})});eo.displayName=Q.UC.displayName,i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",a),...r})}).displayName=Q.JU.displayName;let ed=i.forwardRef((e,t)=>{let{className:a,children:r,variant:i="default",...n}=e;return(0,s.jsxs)(Q.q7,{ref:t,className:(0,o.cn)(es({variant:i}),a),...n,children:[(0,s.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(Q.VF,{})}),(0,s.jsx)(Q.p4,{children:r})]})});ed.displayName=Q.q7.displayName,i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-foreground/10",a),...r})}).displayName=Q.wv.displayName;let ec=a(1844).b;var em=a(6760);function eu(e){let{name:t,preview:a,dragData:r,onDragStart:n,aspectRatio:l=16/9,className:d="",showPlusOnDrag:c=!0,showLabel:m=!0,rounded:u=!0}=e,[p,h]=(0,i.useState)(!1),[g,f]=(0,i.useState)({x:0,y:0}),x=(0,i.useRef)(null),{mediaItems:v}=(0,P.useMediaStore)(),b=new window.Image;b.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=";let y=(0,i.useMemo)(()=>{if(!r.id)return!0;let e=v.find(e=>e.id===r.id);if(!e)return!0;if("ai"===e.source){var t;let a=((null==(t=e.thumbnails)?void 0:t.length)||0)>0&&e.processingComplete&&"complete"===e.processingStage;return console.log("\uD83C\uDFAC AI Item drag check:",{id:e.id,canDrag:a,stage:e.processingStage}),a}return!0},[r.id,v]);return(0,i.useEffect)(()=>{if(!p)return;let e=e=>{f({x:e.clientX,y:e.clientY})};return document.addEventListener("dragover",e),()=>{document.removeEventListener("dragover",e)}},[p]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{ref:x,className:"relative group w-28 h-28",children:(0,s.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-1 p-0 h-auto w-full relative cursor-default",!y&&"opacity-50 cursor-not-allowed",d),title:y?void 0:"Processing - please wait",children:[(0,s.jsxs)(ec,{ratio:l,className:(0,o.cn)("bg-accent relative overflow-hidden",u&&"rounded-md","[&::-webkit-drag-ghost]:opacity-0"),draggable:y,onDragStart:e=>{var t;if(console.log("\uD83D\uDE80 DRAG START TRIGGERED:",{id:r.id,name:r.name,canDrag:y}),!y){e.preventDefault(),console.log("\uD83D\uDEAB Drag prevented - item not ready:",r.id);return}console.group("\uD83C\uDFAC DRAG START"),console.log("Dragging item:",{id:r.id,canDrag:y,processingStage:null==(t=v.find(e=>e.id===r.id))?void 0:t.processingStage}),console.groupEnd(),e.dataTransfer.setDragImage(b,0,0),e.dataTransfer.setData("application/x-media-item",JSON.stringify(r)),e.dataTransfer.effectAllowed="copy",f({x:e.clientX,y:e.clientY}),h(!0),null==n||n(e)},onDragEnd:()=>{h(!1)},children:[a,!p&&(0,s.jsx)(ep,{className:"opacity-0 group-hover:opacity-100"})]}),m&&(0,s.jsx)("span",{className:"text-[0.7rem] text-muted-foreground truncate w-full text-left","aria-label":t,title:t,children:t.length>8?"".concat(t.slice(0,16),"...").concat(t.slice(-3)):t})]})}),p&&"undefined"!=typeof document&&(0,em.createPortal)((0,s.jsx)("div",{className:"fixed pointer-events-none z-[9999]",style:{left:g.x-40,top:g.y-40},children:(0,s.jsx)("div",{className:"w-[80px]",children:(0,s.jsxs)(ec,{ratio:1,className:"relative rounded-md overflow-hidden shadow-2xl ring ring-primary",children:[(0,s.jsx)("div",{className:"w-full h-full [&_img]:w-full [&_img]:h-full [&_img]:object-cover [&_img]:rounded-none",children:a}),c&&(0,s.jsx)(ep,{})]})})}),document.body)]})}function ep(e){let{className:t}=e;return(0,s.jsx)(I.$,{size:"icon",className:(0,o.cn)("absolute bottom-2 right-2 size-4",t),children:(0,s.jsx)(_.A,{className:"!size-3"})})}var eh=a(2311);let eg=e=>{switch(e){case"seededit":return{guidanceScale:1,steps:20,seed:void 0,safetyTolerance:2,numImages:1};case"flux-kontext":case"flux-kontext-max":return{guidanceScale:3.5,steps:28,seed:void 0,safetyTolerance:2,numImages:1}}},ef=(0,N.v)()((0,C.eh)((e,t)=>({originalImage:null,originalImageUrl:null,currentEditedUrl:null,selectedModel:"seededit",prompt:"",parameters:eg("seededit"),editHistory:[],currentHistoryIndex:-1,isProcessing:!1,progress:0,statusMessage:"",elapsedTime:0,estimatedTime:void 0,showParameters:!0,showHistory:!1,previewMode:"side-by-side",setOriginalImage:(t,a)=>{e({originalImage:t,originalImageUrl:a,currentEditedUrl:null,editHistory:[],currentHistoryIndex:-1})},clearImage:()=>{e({originalImage:null,originalImageUrl:null,currentEditedUrl:null,editHistory:[],currentHistoryIndex:-1,prompt:""})},setSelectedModel:t=>{e({selectedModel:t,parameters:eg(t)})},setPrompt:t=>{e({prompt:t})},updateParameter:(t,a)=>{e(e=>({parameters:{...e.parameters,[t]:a}}))},resetParameters:()=>{let{selectedModel:a}=t();e({parameters:eg(a)})},addToHistory:t=>{let a=Math.random().toString(36).substr(2,9),r={...t,id:a,timestamp:new Date};e(e=>{let a=e.editHistory.slice(0,e.currentHistoryIndex+1);return a.push(r),{editHistory:a,currentHistoryIndex:a.length-1,currentEditedUrl:t.editedUrl}})},goToHistoryItem:a=>{let{editHistory:r}=t();if(a>=0&&a<r.length){let t=r[a],s=eg(t.model);e({currentHistoryIndex:a,currentEditedUrl:t.editedUrl,prompt:t.prompt,selectedModel:t.model,parameters:{...s,...t.parameters}})}},canUndo:()=>{let{currentHistoryIndex:e}=t();return e>0},canRedo:()=>{let{editHistory:e,currentHistoryIndex:a}=t();return a<e.length-1},undo:()=>{let{currentHistoryIndex:e,goToHistoryItem:a}=t();e>0&&a(e-1)},redo:()=>{let{editHistory:e,currentHistoryIndex:a,goToHistoryItem:r}=t();a<e.length-1&&r(a+1)},clearHistory:()=>{e({editHistory:[],currentHistoryIndex:-1,currentEditedUrl:null})},setProcessingState:t=>{e(e=>{var a,r,s,i;return{isProcessing:t.isProcessing,progress:null!=(a=t.progress)?a:e.progress,statusMessage:null!=(r=t.statusMessage)?r:e.statusMessage,elapsedTime:null!=(s=t.elapsedTime)?s:e.elapsedTime,estimatedTime:null!=(i=t.estimatedTime)?i:e.estimatedTime}})},toggleParameters:()=>{e(e=>({showParameters:!e.showParameters}))},toggleHistory:()=>{e(e=>({showHistory:!e.showHistory}))},setPreviewMode:t=>{e({previewMode:t})}})));{let e=localStorage.getItem("adjustment-settings");if(e)try{let t=JSON.parse(e);ef.setState({selectedModel:t.selectedModel||"seededit",showParameters:null==(r=t.showParameters)||r,previewMode:t.previewMode||"side-by-side"})}catch(e){console.warn("Failed to load adjustment settings:",e)}ef.subscribe(e=>({selectedModel:e.selectedModel,showParameters:e.showParameters,previewMode:e.previewMode}),e=>{localStorage.setItem("adjustment-settings",JSON.stringify(e))})}var ex=a(674),ev=a(639),eb=a.n(ev);class ey{async addMediaItems(e,t){let a=e.length,r=0;for(let i of e)try{var s;let e=i.name;if((null==(s=i.metadata)?void 0:s.source)==="text2image"&&i.file&&!e.includes(".")){let t=(i.file.type||"image/png").split("/")[1]||"png";e="".concat(e,".").concat(t)}e=this.resolveFilename(e),i.file&&this.zip.file(e,i.file),r++,null==t||t(r/a)}catch(e){console.error("❌ ZIP-MANAGER: Failed to add ".concat(i.name," to ZIP:"),e)}}async generateZip(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a={...this.defaultOptions,...t};return await this.zip.generateAsync({type:"blob",compression:a.compression,compressionOptions:{level:null!=(e=a.compressionLevel)?e:6},platform:"UNIX",comment:"Created by OpenCut"})}resolveFilename(e){let t=Object.keys(this.zip.files),a=this.sanitizeFilenameForWindows(e),r=1;for(;t.includes(a);){let t=e.split(".").pop(),s=e.replace(".".concat(t),"");a="".concat(this.sanitizeFilenameForWindows(s)," (").concat(r,").").concat(t),r++}return a}sanitizeFilenameForWindows(e){let t=e.replace(/[<>:"|?*\x00-\x1f]/g,"_");return/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])(\.|$)/i.test(t)&&(t="file_".concat(t)),t.normalize("NFC")}reset(){this.zip=new(eb())}constructor(){this.defaultOptions={filename:"media-export.zip",compression:"DEFLATE",compressionLevel:6,includeMetadata:!0},this.zip=new(eb())}}async function ew(e,t){var a;if("showSaveFilePicker"in window)try{let a=await window.showSaveFilePicker({suggestedName:t,types:[{description:"ZIP files",accept:{"application/zip":[".zip"]}}]}),r=await a.createWritable();await r.write(e),await r.close();return}catch(e){}let r=URL.createObjectURL(e),s=document.createElement("iframe");s.style.display="none",document.body.appendChild(s);let i=s.contentDocument||(null==(a=s.contentWindow)?void 0:a.document);if(i){let e=i.createElement("a");e.href=r,e.download=t,i.body.appendChild(e),e.click(),i.body.removeChild(e)}setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(r)},100)}function ej(e){let{className:t,variant:a="outline",size:r="sm"}=e,{mediaItems:n}=(0,P.useMediaStore)(),{exportState:l,exportToZip:d,isExporting:c}=function(){let[e,t]=(0,i.useState)({phase:"idle",progress:0,totalFiles:0,completedFiles:0});return{exportState:e,exportToZip:(0,i.useCallback)(async(e,a)=>{if(0!==e.length){t({phase:"adding",progress:0,totalFiles:e.length,completedFiles:0});try{let r=new ey;await r.addMediaItems(e,a=>{t(t=>({...t,phase:"adding",progress:Math.round(40*a),completedFiles:Math.round(a*e.length)}))}),t(e=>({...e,phase:"compressing",progress:60}));let s=await r.generateZip(a);t(e=>({...e,phase:"downloading",progress:90}));let i=(null==a?void 0:a.filename)||"media-export-".concat(Date.now(),".zip");await ew(s,i),t(e=>({...e,phase:"complete",progress:100})),setTimeout(()=>{t({phase:"idle",progress:0,totalFiles:0,completedFiles:0})},2e3)}catch(e){t(t=>({...t,phase:"error",error:e instanceof Error?e.message:"Export failed"}))}}},[]),resetExport:(0,i.useCallback)(()=>{t({phase:"idle",progress:0,totalFiles:0,completedFiles:0})},[]),isExporting:"idle"!==e.phase&&"complete"!==e.phase&&"error"!==e.phase}}(),m=async()=>{if(n.filter(e=>{var t;return(null==(t=e.metadata)?void 0:t.source)==="text2image"}).length,0!==n.length&&!c)try{await d(n,{filename:"media-export-".concat(Date.now(),".zip")}),"complete"===l.phase&&R.oR.success("Successfully exported ".concat(n.length," files to ZIP!"))}catch(e){console.error("❌ EXPORT-ALL: Export failed:",e),R.oR.error("Failed to export media files")}},u=0===n.length,{phase:p,progress:h,completedFiles:g,totalFiles:f}=l,x=()=>{if(u)return"No Media";if(!c)return"Export All (".concat(n.length,")");switch(p){case"adding":return"Adding Files... ".concat(g,"/").concat(f);case"compressing":return"Compressing...";case"downloading":return"Downloading...";default:return"Exporting... ".concat(h,"%")}};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(I.$,{variant:a,size:r,onClick:m,disabled:u||c,"data-testid":"export-all-button",className:(0,o.cn)("gap-2 transition-all duration-200 min-w-[120px] !bg-transparent hover:!bg-transparent !border-transparent",c&&"cursor-not-allowed",t),children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.A,{className:"h-4 w-4 animate-spin"}),(0,s.jsx)("span",{className:"hidden sm:inline text-xs font-medium",children:x()}),(0,s.jsx)("span",{className:"sm:hidden text-xs",children:"Export"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ex.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline text-xs font-medium",children:x()}),(0,s.jsx)("span",{className:"sm:hidden text-xs",children:"Export"})]})}),c&&h>0&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 h-1 rounded-b-md transition-all duration-300",style:{width:"".concat(h,"%")},children:(0,s.jsx)("div",{className:(0,o.cn)("h-full rounded-b-md",(()=>{switch(p){case"adding":default:return"bg-blue-500";case"compressing":return"bg-yellow-500";case"downloading":case"complete":return"bg-green-500";case"error":return"bg-red-500"}})()),"data-testid":"export-progress"})}),u&&(0,s.jsx)("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 hover:opacity-100 transition-opacity pointer-events-none","data-testid":"empty-media-tooltip",children:"No media to export"})]})}let eN=e=>{var t;let{item:a}=e,[r,n]=(0,i.useState)(a.thumbnailUrl),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(0),{getThumbnailAtTime:m,generateEnhancedThumbnails:u}=(0,P.useMediaStore)();return((0,i.useEffect)(()=>{"video"!==a.type||a.thumbnails||a.thumbnailError||u(a.id,{resolution:"medium",sceneDetection:!0}).catch(e=>{var t;if(null==(t=e.message)?void 0:t.includes("Invalid file type for thumbnail generation"))return void console.warn("Thumbnail generation not supported for ".concat(a.name,", using fallback"));console.error("Failed to generate thumbnails for media item:",{itemId:a.id,itemName:a.name,error:e.message||e})})},[a.id,a.type,a.thumbnails,a.thumbnailError,u]),a.thumbnailError)?(0,s.jsxs)("div",{className:"relative w-full h-full bg-muted flex items-center justify-center rounded",children:[(0,s.jsx)(p.A,{className:"h-8 w-8 text-muted-foreground"}),(0,s.jsx)("div",{className:"absolute bottom-1 left-1 text-xs text-red-500",children:"Thumbnail failed"})]}):a.thumbnailUrl?(0,s.jsxs)("div",{className:"relative w-full h-full cursor-pointer group",onMouseMove:e=>{if(!l||!a.duration||!a.thumbnails)return;let t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width,s=r*a.duration,i=m(a.id,s);i&&(n(i),c(r))},onMouseEnter:()=>o(!0),onMouseLeave:()=>{o(!1),n(a.thumbnailUrl),c(0)},children:[(0,s.jsx)("img",{src:r||a.thumbnailUrl,className:"w-full h-full object-cover rounded transition-all duration-150",alt:"Thumbnail for ".concat(a.name),loading:"lazy"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 via-purple-500/20 to-transparent rounded"}),(0,s.jsx)("div",{className:"absolute top-1 right-1",children:(0,s.jsx)(p.A,{className:"h-4 w-4 text-white drop-shadow-md bg-black/50 rounded p-0.5"})}),a.duration&&(0,s.jsx)("div",{className:"absolute bottom-1 right-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white text-xs px-1.5 py-0.5 rounded font-medium",children:eE(a.duration)}),(0,s.jsx)("div",{className:"absolute bottom-1 left-1 text-white text-xs font-medium drop-shadow-sm bg-black/50 px-1.5 py-0.5 rounded truncate max-w-[80%]",children:a.name.replace(/\.[^/.]+$/,"")}),l&&a.thumbnails&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/20",children:(0,s.jsx)("div",{className:"h-full bg-white/80 transition-all duration-75",style:{width:"".concat(100*d,"%")}})}),(null==(t=a.thumbnailMetadata)?void 0:t.sceneDetected)&&(0,s.jsx)("div",{className:"absolute top-1 left-1 bg-green-500/80 text-white text-xs px-1 py-0.5 rounded",children:"HD"}),a.thumbnails&&a.thumbnails.length>1&&(0,s.jsx)("div",{className:"absolute top-8 left-1 bg-blue-500/80 text-white text-xs px-1 py-0.5 rounded",children:a.thumbnails.length})]}):(0,s.jsxs)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500/30 to-purple-500/30 flex flex-col items-center justify-center text-white rounded border border-blue-500/20",children:[(0,s.jsx)(p.A,{className:"h-8 w-8 mb-1 drop-shadow-sm"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Video"}),a.duration&&(0,s.jsx)("span",{className:"text-xs opacity-80 bg-black/30 px-1 rounded mt-1",children:eE(a.duration)})]})},eE=e=>{let t=Math.floor(e/60),a=Math.floor(e%60);return"".concat(t,":").concat(a.toString().padStart(2,"0"))},eS=()=>{let{mediaItems:e,generateEnhancedThumbnails:t,clearThumbnailCache:a}=(0,P.useMediaStore)(),[r,n]=(0,i.useState)(!1),l=async a=>{for(let r of(n(!0),e.filter(e=>"video"===e.type)))await t(r.id,{resolution:a,sceneDetection:!0,timestamps:"high"===a?[1,5,10,15,20]:[1,5,10]});n(!1)};return e.some(e=>"video"===e.type)?(0,s.jsxs)("div",{className:"flex gap-2 mb-2 p-2 bg-muted rounded-lg",children:[(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>l("low"),disabled:r,className:"!border-transparent !bg-transparent hover:!bg-transparent",children:r?(0,s.jsx)(z.A,{className:"h-3 w-3 animate-spin"}):"Low"}),(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>l("medium"),disabled:r,className:"!border-transparent !bg-transparent hover:!bg-transparent",children:"Medium"}),(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>l("high"),disabled:r,className:"!border-transparent !bg-transparent hover:!bg-transparent",children:"High"})]}),(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:a,className:"!border-transparent !bg-transparent hover:!bg-transparent",children:"Clear Cache"})]}):null};function eC(){let{mediaItems:e,addMediaItem:t,removeMediaItem:a,generateEnhancedThumbnails:r,getThumbnailAtTime:n,clearThumbnailCache:l}=(0,P.useMediaStore)(),{activeProject:o}=(0,eh.I)(),d=(0,i.useRef)(null),[c,m]=(0,i.useState)(!1),[u,p]=(0,i.useState)(0),[h,f]=(0,i.useState)(""),[v,b]=(0,i.useState)("all");(0,i.useEffect)(()=>{},[e]);let y=async e=>{if(e&&0!==e.length){if(!o)return void R.oR.error("No active project");m(!0),p(0);try{for(let a of(await L(e,e=>p(e))))if(await t(o.id,a),"video"===a.type){let e=P.useMediaStore.getState().mediaItems.find(e=>e.file===a.file&&e.name===a.name);e&&r(e.id,{resolution:"medium",sceneDetection:!0})}}catch(e){U.w.log("MediaView","FILE_PROCESSING_ERROR",{error:e instanceof Error?e.message:"Unknown error"}),R.oR.error("Failed to process files")}finally{m(!1),p(0)}}},{isDragOver:w,dragProps:j}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,a]=(0,i.useState)(!1),r=(0,i.useRef)(0);return{isDragOver:t,dragProps:{onDragEnter:e=>{e.preventDefault(),A(e.dataTransfer)&&(r.current+=1,t||a(!0))},onDragOver:e=>{if(e.preventDefault(),!A(e.dataTransfer))return},onDragLeave:e=>{e.preventDefault(),A(e.dataTransfer)&&(r.current-=1,0===r.current&&a(!1))},onDrop:t=>{t.preventDefault(),a(!1),r.current=0,e.onDrop&&t.dataTransfer.files&&A(t.dataTransfer)&&e.onDrop(t.dataTransfer.files)}}}}({onDrop:y}),N=async(e,t)=>{if(e.stopPropagation(),!o)return void R.oR.error("No active project");await a(o.id,t)},[E,C]=(0,i.useState)(e);(0,i.useEffect)(()=>{C(e.filter(e=>(!v||"all"===v||e.type===v)&&(!h||!!e.name.toLowerCase().includes(h.toLowerCase()))))},[e,v,h]);let T=e=>"image"===e.type?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)("img",{src:e.url,alt:e.name,className:"max-w-full max-h-full object-contain",loading:"lazy",onError:e=>{},onLoad:()=>{}})}):"video"===e.type?(0,s.jsx)(eN,{item:e}):"audio"===e.type?(0,s.jsxs)("div",{className:"w-full h-full bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex flex-col items-center justify-center text-muted-foreground rounded border border-green-500/20",children:[(0,s.jsx)(g.A,{className:"h-6 w-6 mb-1"}),(0,s.jsx)("span",{className:"text-xs",children:"Audio"}),e.duration&&(0,s.jsx)("span",{className:"text-xs opacity-70",children:eE(e.duration)})]}):(0,s.jsxs)("div",{className:"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded",children:[(0,s.jsx)(x.A,{className:"h-6 w-6"}),(0,s.jsx)("span",{className:"text-xs mt-1",children:"Unknown"})]});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{ref:d,type:"file",accept:"image/*,video/*,audio/*",multiple:!0,className:"hidden",onChange:e=>{e.target.files&&y(e.target.files),e.target.value=""}}),(0,s.jsxs)("div",{className:"h-full flex flex-col gap-1 transition-colors relative border-panel-primary rounded-sm ".concat(w?"bg-accent/30":""),...j,children:[(0,s.jsx)(O,{isVisible:w}),(0,s.jsx)(eS,{}),(0,s.jsx)("div",{className:"px-3 pt-1 pb-2",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(ea,{value:v,onValueChange:b,children:[(0,s.jsx)(ei,{className:"w-[80px] h-full text-xs rounded-full",children:(0,s.jsx)(er,{})}),(0,s.jsxs)(eo,{className:"",children:[(0,s.jsx)(ed,{value:"all",children:"All"}),(0,s.jsx)(ed,{value:"video",children:"Video"}),(0,s.jsx)(ed,{value:"audio",children:"Audio"}),(0,s.jsx)(ed,{value:"image",children:"Image"})]})]}),(0,s.jsx)(Y.p,{type:"text",placeholder:"Search media...",className:"min-w-[60px] flex-1 h-full text-xs border-subtle rounded-full",value:h,onChange:e=>f(e.target.value)}),(0,s.jsx)(ej,{variant:"outline",size:"sm"}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=d.current)?void 0:e.click()},disabled:c,className:"flex-none bg-transparent min-w-[30px] whitespace-nowrap overflow-hidden px-2 justify-center items-center !border-transparent",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(F.A,{className:"h-4 w-4 animate-spin"}),(0,s.jsxs)("span",{className:"hidden md:inline ml-2",children:[u,"%"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline ml-2","aria-label":"Add file",children:"Add"})]})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-3 pt-0 max-h-full scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100",children:0===E.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center h-full",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-full bg-muted/30 flex items-center justify-center mb-4",children:(0,s.jsx)(x.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No media in project"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Drag files here or use the button above"})]}):(0,s.jsx)("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(auto-fill, 160px)"},children:E.map(e=>(0,s.jsxs)($,{children:[(0,s.jsx)(q,{children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(eu,{name:e.name,preview:T(e),dragData:{id:e.id,type:e.type,name:e.name},showPlusOnDrag:!1,rounded:!1}),"ai"===e.source&&"complete"!==e.processingStage&&(0,s.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center rounded",children:(0,s.jsxs)("div",{className:"text-white text-xs text-center",children:[(0,s.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mx-auto mb-1"}),(0,s.jsxs)("div",{children:["thumbnail-canvas"===e.processingStage&&"Generating Thumbnails...","thumbnail-ffmpeg"===e.processingStage&&"Processing Video...","uploading"===e.processingStage&&"Uploading...",!e.processingStage&&"Processing..."]})]})})]})}),(0,s.jsxs)(J,{children:["image"===e.type&&(0,s.jsx)(K,{onClick:()=>{P.useMediaStore.getState();let t=ef.getState(),a=S.getState(),r=e.url&&e.url.startsWith("blob:")?e.url:e.file?URL.createObjectURL(e.file):"";e.file&&r&&t.setOriginalImage(e.file,r),a.setActiveTab("adjustment")},children:"Edit Image"}),(0,s.jsx)(K,{children:"Export clips"}),(0,s.jsx)(K,{variant:"destructive",onClick:t=>N(t,e.id),children:"Delete"})]})]},e.id))})})]})]})}function eT(){return(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(eu,{name:"Default text",preview:(0,s.jsx)("div",{className:"flex items-center justify-center w-full h-full bg-accent rounded",children:(0,s.jsx)("span",{className:"text-xs select-none",children:"Default text"})}),dragData:{id:"default-text",type:"text",name:"Default text",content:"Default text"},aspectRatio:1,showLabel:!1})})}var ek=a(1352);let eI=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,o.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-xs",a),ref:t,...r})});eI.displayName="Textarea";var eM=a(6949),eA=a(1772),eR=a(4596);let eP=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eR.bL,{className:(0,o.cn)("grid gap-2",a),...r,ref:t})});eP.displayName=eR.bL.displayName;let eD=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eR.q7,{ref:t,className:(0,o.cn)("aspect-square h-3 w-3 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),...r,children:(0,s.jsx)(eR.C1,{className:"flex items-center justify-center",children:(0,s.jsx)(G.A,{className:"h-1.5 w-1.5 fill-primary",style:{width:"6px",height:"6px"}})})})});eD.displayName=eR.q7.displayName;var eL=a(4392),ez=a(6782),eF=a(354);let e_=(0,N.v)()((0,C.lt)((e,t)=>({prompt:"",setPrompt:t=>e({prompt:t}),selectedModels:["imagen4-ultra","seeddream-v3","flux-pro-v11-ultra"],toggleModel:t=>e(e=>({selectedModels:e.selectedModels.includes(t)?e.selectedModels.filter(e=>e!==t):[...e.selectedModels,t]})),clearModelSelection:()=>e({selectedModels:[]}),generationMode:"multi",setGenerationMode:a=>{e({generationMode:a});let{selectedModels:r}=t();"single"===a&&r.length>1?e({selectedModels:r.slice(0,1)}):"multi"===a&&0===r.length?e({selectedModels:["imagen4-ultra","seeddream-v3"]}):"single"===a&&0===r.length&&e({selectedModels:["imagen4-ultra"]})},isGenerating:!1,generationResults:{},selectedResults:[],toggleResultSelection:t=>e(e=>({selectedResults:e.selectedResults.some(e=>e.modelKey===t.modelKey)?e.selectedResults.filter(e=>e.modelKey!==t.modelKey):[...e.selectedResults,t]})),clearSelectedResults:()=>e({selectedResults:[]}),generateImages:async(r,s)=>{let{selectedModels:i,generationMode:n}=t();if(0===i.length)return;e({isGenerating:!0,generationResults:{},selectedResults:[]});let l={};i.forEach(e=>{l[e]={status:"loading"}}),e({generationResults:l});try{let{generateWithMultipleModels:n}=await a.e(461).then(a.bind(a,3461)),l=await n(i,r,s),o={};for(let[e,t]of Object.entries(l))o[e]={status:t.success?"success":"error",imageUrl:t.success?t.imageUrl:void 0,error:t.success?void 0:t.error,generatedAt:new Date};e({generationResults:o,isGenerating:!1});let d=[];for(let[e,t]of Object.entries(o))"success"===t.status&&t.imageUrl&&d.push({modelKey:e,imageUrl:t.imageUrl,prompt:r,settings:s});e({selectedResults:d}),d.length>0&&t().addSelectedToMedia(d),t().addToHistory(r,i,o)}catch(a){let t={};i.forEach(e=>{t[e]={status:"error",error:a instanceof Error?a.message:"Unknown error"}}),e({generationResults:t,isGenerating:!1})}},addSelectedToMedia:r=>{let{selectedResults:s,generationResults:i,prompt:n}=t(),l=r||s;0!==l.length&&(Promise.resolve().then(a.bind(a,6749)).then(e=>{let{useMediaStore:t}=e,{addGeneratedImages:a}=t.getState();a(l.map(e=>({url:e.imageUrl,type:"image",name:"Generated: ".concat(e.prompt.slice(0,30)).concat(e.prompt.length>30?"...":""),size:0,duration:0,metadata:{source:"text2image",model:e.modelKey,prompt:e.prompt,settings:e.settings,generatedAt:new Date}})))}).catch(e=>{}),e({selectedResults:[]}))},clearResults:()=>e({generationResults:{},selectedResults:[],isGenerating:!1}),generationHistory:[],addToHistory:(t,a,r)=>e(e=>({generationHistory:[{id:"history-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),prompt:t,models:a,results:r,createdAt:new Date},...e.generationHistory.slice(0,49)]}))}),{name:"text2image-store"}));var eO=a(924),eU=a(3036);let eB=i.createContext({mode:null,setMode:()=>{},open:!1,setOpen:()=>{}});function eH(e){let{children:t,defaultMode:a}=e,[r,n]=i.useState(a||null),[l,o]=i.useState(!0),d=i.useMemo(()=>({mode:r,setMode:n,open:l,setOpen:o}),[r,l]);return(0,s.jsx)(eB.Provider,{value:d,children:(0,s.jsx)(eU.bL,{open:l,onOpenChange:o,children:t(d)})})}let eW=i.forwardRef((e,t)=>{let{children:a,mode:r,title:n,className:l}=e,{setMode:d,setOpen:c}=i.useContext(eB);return(0,s.jsx)(eU.l9,{ref:t,onClick:()=>{d(r),c(!0)},className:(0,o.cn)("inline-flex h-9 items-center justify-center rounded-md bg-zinc-900 px-4 py-2 text-sm font-medium text-zinc-50 hover:bg-zinc-900/90 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90 dark:focus-visible:ring-zinc-300",l),title:n,children:a})});eW.displayName="FloatingActionPanelTrigger",i.forwardRef((e,t)=>{let{children:a,className:r,align:i="center",sideOffset:n=4,...l}=e;return(0,s.jsx)(eU.ZL,{children:(0,s.jsx)(eU.UC,{ref:t,align:i,sideOffset:n,className:(0,o.cn)("z-50 w-auto rounded-md border shadow-md outline-none bg-transparent data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...l,children:a})})}).displayName="FloatingActionPanelContent",i.forwardRef((e,t)=>{let{children:a,onClick:r,className:n,icon:l}=e,{setOpen:d}=i.useContext(eB);return(0,s.jsxs)("button",{ref:t,onClick:()=>{null==r||r(),d(!1)},className:(0,o.cn)("flex w-full items-center rounded-sm px-2 py-1.5 text-sm hover:bg-zinc-100 focus:bg-zinc-100 focus:outline-none",n),children:[l&&(0,s.jsx)("span",{className:"mr-2",children:l}),a]})}).displayName="FloatingActionPanelButton",i.forwardRef((e,t)=>{let{className:a,placeholder:r="Add a note...",...i}=e;return(0,s.jsx)("textarea",{ref:t,placeholder:r,className:(0,o.cn)("min-h-[80px] w-full resize-none rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...i})}).displayName="FloatingActionPanelTextarea";let eG=i.forwardRef((e,t)=>{let{id:a,checked:r=!1,onCheckedChange:i,className:n}=e;return(0,s.jsx)("button",{ref:t,type:"button",role:"checkbox","aria-checked":r,"data-state":r?"checked":"unchecked",value:"on",id:a,onClick:()=>null==i?void 0:i(!r),className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm !border-transparent shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:cursor-not-allowed disabled:opacity-50 bg-transparent data-[state=checked]:bg-transparent data-[state=checked]:text-zinc-900",n),children:(0,s.jsx)("span",{"data-state":r?"checked":"unchecked",className:"flex items-center justify-center text-current",style:{pointerEvents:"none"},children:r&&(0,s.jsx)(W.A,{className:"h-1.5 w-1.5"})})})});function eV(e){let{id:t,name:a,description:r,quality:i,speed:n,price:l,checked:o=!1,onCheckedChange:d}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-transparent",children:[(0,s.jsx)("div",{children:(0,s.jsx)("label",{className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 font-medium cursor-pointer",htmlFor:t,style:{marginLeft:"5px"},children:a})}),(0,s.jsx)(eG,{id:t,checked:o,onCheckedChange:d})]})}function e$(){let{prompt:e,setPrompt:t,selectedModels:a,toggleModel:r,generationMode:n,setGenerationMode:l,isGenerating:o,generateImages:d,generationResults:c,selectedResults:m,toggleResultSelection:u,addSelectedToMedia:p,clearResults:h}=e_(),[g,f]=(0,i.useState)("square_hd"),[x,v]=(0,i.useState)(""),b=a.length,y=Object.keys(c).length>0,w=m.length,j=async()=>{if(!e.trim())return;let t={imageSize:g,seed:x?parseInt(x):void 0};try{await d(e,t),console.log("Generation completed")}catch(e){console.error("Generation failed:",e)}};return(0,s.jsxs)("div",{className:"p-4 space-y-6",children:[(0,s.jsx)(I.$,{onClick:j,disabled:!e.trim()||0===b||o,className:"w-full",size:"lg",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eL.A,{className:"w-4 h-4 mr-2"}),"single"===n?"Generate Image":"Generate with ".concat(b," Model").concat(1!==b?"s":"")]})}),(0,s.jsxs)(eM.Zp,{className:"border-0 shadow-none",style:{marginTop:"5px"},children:[(0,s.jsxs)(eM.aR,{className:"pb-3",children:[(0,s.jsx)(eM.ZB,{className:"text-sm",children:"Generation Mode"}),(0,s.jsx)("div",{style:{height:"6px"}})]}),(0,s.jsx)(eM.Wu,{children:(0,s.jsxs)(eP,{value:n,onValueChange:e=>l(e),className:"flex flex-col gap-3",style:{marginBottom:"5px"},children:[(0,s.jsxs)("div",{className:"flex items-center space-x-6 cursor-pointer",children:[(0,s.jsx)(eD,{value:"single",id:"single",className:"h-4 w-4"}),(0,s.jsx)(ek.J,{htmlFor:"single",className:"text-sm cursor-pointer",children:"Single Model"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-6 cursor-pointer",children:[(0,s.jsx)(eD,{value:"multi",id:"multi",className:"h-4 w-4"}),(0,s.jsx)(ek.J,{htmlFor:"multi",className:"text-sm cursor-pointer",children:"Multi-Model Compare"})]})]})})]}),(0,s.jsxs)(eM.Zp,{children:[(0,s.jsxs)(eM.aR,{className:"pb-3",children:[(0,s.jsx)("div",{style:{height:"5px"}}),(0,s.jsx)(eM.ZB,{className:"text-sm",children:"single"===n?"Select Model":"Select Models (".concat(b," chosen)")}),(0,s.jsx)("div",{style:{height:"5px"}})]}),(0,s.jsx)(eM.Wu,{children:(0,s.jsx)(eH,{defaultMode:"selection",children:e=>{var t;let{mode:i,open:l}=e;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eW,{mode:"selection",title:"Select AI Model(s)",className:"w-full !bg-transparent hover:!bg-transparent",children:0===b?"Choose Model(s)":"single"===n&&a[0]?null==(t=eO.Id[a[0]])?void 0:t.name:"".concat(b," Model").concat(1!==b?"s":""," Selected")}),l&&(0,s.jsx)("div",{className:"w-full border rounded-md bg-transparent max-h-[300px] overflow-y-auto",children:(0,s.jsx)("div",{className:"p-2 space-y-3",children:Object.entries(eO.Id).map(e=>{let[t,i]=e;return(0,s.jsx)(eV,{id:t,name:i.name,checked:a.includes(t),onCheckedChange:e=>{"single"===n?(a.forEach(e=>{e!==t&&r(e)}),e&&!a.includes(t)&&r(t)):r(t)}},t)})})})]})}})})]}),(0,s.jsxs)(eM.Zp,{className:"border-0 shadow-none",style:{marginTop:"5px"},children:[(0,s.jsxs)(eM.aR,{className:"pb-3",children:[(0,s.jsx)(eM.ZB,{className:"text-sm",children:"Prompt"}),(0,s.jsx)("div",{style:{height:"5px"}})]}),(0,s.jsx)(eM.Wu,{children:(0,s.jsx)(eI,{placeholder:"Describe the image you want to generate...",value:e,onChange:e=>t(e.target.value),className:"min-h-[100px] resize-none"})})]}),(0,s.jsxs)(eM.Zp,{className:"border-0 shadow-none",style:{marginTop:"5px"},children:[(0,s.jsx)(eM.aR,{className:"pb-3",children:(0,s.jsx)(eM.ZB,{className:"text-sm",style:{marginLeft:"5px"},children:"Settings"})}),(0,s.jsx)(eM.Wu,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(ek.J,{htmlFor:"size",className:"text-xs",children:"Image Size"}),(0,s.jsx)("div",{style:{height:"5px"}}),(0,s.jsxs)(ea,{value:g,onValueChange:f,children:[(0,s.jsx)(ei,{id:"size",className:"justify-between",children:(0,s.jsx)(er,{})}),(0,s.jsxs)(eo,{className:"z-[100] bg-white border shadow-lg",children:[(0,s.jsx)(ed,{value:"square",children:"Square"}),(0,s.jsx)(ed,{value:"square_hd",children:"Square HD"}),(0,s.jsx)(ed,{value:"landscape_4_3",children:"Landscape (4:3)"}),(0,s.jsx)(ed,{value:"landscape_16_9",children:"Landscape (16:9)"}),(0,s.jsx)(ed,{value:"portrait_4_3",children:"Portrait (4:3)"}),(0,s.jsx)(ed,{value:"portrait_16_9",children:"Portrait (16:9)"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(ek.J,{htmlFor:"seed",className:"text-xs",children:"Seed (Optional)"}),(0,s.jsx)(Y.p,{id:"seed",placeholder:"Random",value:x,onChange:e=>v(e.target.value),type:"number"})]})]})})]}),y&&(0,s.jsxs)(eM.Zp,{children:[(0,s.jsx)(eM.aR,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(eM.ZB,{className:"text-sm",children:"single"===n?"Generated Image":"Compare Results"}),(0,s.jsxs)(I.$,{variant:"outline",size:"sm",onClick:h,className:"text-xs",children:[(0,s.jsx)(ez.A,{className:"w-3 h-3 mr-1"}),"Clear"]})]})}),(0,s.jsx)(eM.Wu,{children:"single"===n?(0,s.jsx)("div",{className:"space-y-4",children:Object.entries(c).map(t=>{var a,r;let[i,n]=t;return(0,s.jsxs)("div",{className:"space-y-2",children:["loading"===n.status&&(0,s.jsx)("div",{className:"flex items-center justify-center p-8 border-2 border-dashed rounded-lg",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(z.A,{className:"w-8 h-8 mx-auto mb-2 animate-spin"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Generating with ",null==(a=eO.Id[i])?void 0:a.name,"..."]})]})}),"success"===n.status&&n.imageUrl&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("img",{src:n.imageUrl,alt:"Generated image",className:"w-full rounded-lg border"}),(0,s.jsxs)(I.$,{onClick:()=>p([{modelKey:i,imageUrl:n.imageUrl,prompt:e,settings:{imageSize:g,seed:x?parseInt(x):void 0}}]),className:"w-full",variant:"outline",children:[(0,s.jsx)(eF.A,{className:"w-4 h-4 mr-2"}),"Add to Media Panel"]})]}),"error"===n.status&&(0,s.jsx)("div",{className:"p-4 border-2 border-red-200 rounded-lg bg-red-50",children:(0,s.jsxs)("p",{className:"text-sm text-red-800",children:["Failed to generate with ",null==(r=eO.Id[i])?void 0:r.name,": ",n.error]})})]},i)})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(c).map(t=>{var a,r;let[i,n]=t;return(0,s.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"p-3 bg-muted",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{className:"text-sm font-medium",children:null==(a=eO.Id[i])?void 0:a.name}),"success"===n.status&&n.imageUrl&&(0,s.jsx)(eA.S,{checked:m.some(e=>e.modelKey===i),onCheckedChange:()=>u({modelKey:i,imageUrl:n.imageUrl,prompt:e,settings:{imageSize:g,seed:x?parseInt(x):void 0}})})]})}),(0,s.jsxs)("div",{className:"aspect-square bg-muted",children:["loading"===n.status&&(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(z.A,{className:"w-6 h-6 mx-auto mb-2 animate-spin"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Generating..."})]})}),"success"===n.status&&n.imageUrl&&(0,s.jsx)("img",{src:n.imageUrl,alt:"Generated by ".concat(null==(r=eO.Id[i])?void 0:r.name),className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>u({modelKey:i,imageUrl:n.imageUrl,prompt:e,settings:{imageSize:g,seed:x?parseInt(x):void 0}})}),"error"===n.status&&(0,s.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,s.jsxs)("p",{className:"text-xs text-red-600 text-center",children:["Generation failed: ",n.error]})})]})]},i)})}),w>0&&(0,s.jsxs)(I.$,{onClick:()=>{p(),h()},className:"w-full",size:"lg",children:[(0,s.jsx)(eF.A,{className:"w-4 h-4 mr-2"}),"Add ",w," Selected Image",1!==w?"s":""," to Media Panel"]})]})})]})]})}eG.displayName="FloatingActionPanelCheckbox";var eq=a(9114),eX=a(7642),eJ=a(44),eK=a(7903);let eZ=eK.bL,eY=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eK.B8,{ref:t,className:(0,o.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...r})});eY.displayName=eK.B8.displayName;let eQ=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eK.l9,{ref:t,className:(0,o.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...r})});eQ.displayName=eK.l9.displayName;let e0=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eK.UC,{ref:t,className:(0,o.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});e0.displayName=eK.UC.displayName;let e1="ce1a4a62-4ceb-4faa-989f-2ed52adb7f7d:6b16e77cf71a9c9ed70149237587f95e",e2="https://fal.run";async function e5(e,t,a){try{if(!e1)throw console.error("❌ FAL API Key Missing!"),console.error("Please set NEXT_PUBLIC_FAL_API_KEY in your .env.local file"),Error("FAL API key not configured. Please set NEXT_PUBLIC_FAL_API_KEY in your environment variables.");console.log("\uD83D\uDD11 FAL API Key present: ".concat(e1?"Yes (length: "+e1.length+")":"No"));let n={seedance:"fal-ai/bytedance/seedance/v1/lite/text-to-video",seedance_pro:"fal-ai/bytedance/seedance/v1/pro/text-to-video",veo3:"fal-ai/google/veo3",veo3_fast:"fal-ai/google/veo3/fast",hailuo:"fal-ai/minimax/hailuo-02/standard/text-to-video",hailuo_pro:"fal-ai/minimax/hailuo-02/pro/text-to-video",kling_v2:"fal-ai/kling-video/v2.1/master"}[e.model]||"fal-ai/minimax/hailuo-02/standard/text-to-video",l=e6();console.log("\uD83C\uDFAC Generating video with FAL AI: ".concat(n)),console.log("\uD83D\uDCDD Prompt: ".concat(e.prompt));let o={prompt:e.prompt};"hailuo"===e.model||"hailuo_pro"===e.model?o.duration=(e.duration||6)>=10?"10":"6":"seedance"===e.model?(o.duration=e.duration||5,o.resolution=e.resolution||"720p",o.aspect_ratio="16:9"):"seedance_pro"===e.model?(o.duration=e.duration||5,o.resolution=e.resolution||"1080p",o.aspect_ratio="16:9"):(o.duration=e.duration||5,o.resolution=e.resolution||"1080p"),console.log("\uD83D\uDCE4 Sending request to ".concat(n," with payload:"),o);let d=Date.now();t&&t({status:"queued",progress:0,message:"Submitting request to FAL.ai queue...",elapsedTime:0}),console.log("\uD83D\uDCE4 Attempting queue submission with payload:",o);let c=await fetch("".concat(e2,"/").concat(n),{method:"POST",headers:{Authorization:"Key ".concat(e1),"Content-Type":"application/json","X-Fal-Queue":"true","X-Queue":"true",Queue:"true"},body:JSON.stringify(o)});if(!c.ok){var r,s,i;let e,t=await c.json().catch(()=>({}));console.error("❌ FAL Queue Submit Error:",{status:c.status,statusText:c.statusText,errorData:t,endpoint:n});let a=(r=c,s=t,i=n,e="FAL Queue error! status: ".concat(r.status),s.detail?e=Array.isArray(s.detail)?s.detail.map(e=>e.msg||e).join(", "):s.detail:s.error?e=s.error:s.message?e=s.message:"string"==typeof s?e=s:s.errors&&Array.isArray(s.errors)&&(e=s.errors.join(", ")),422===r.status?e="Invalid request parameters: ".concat(JSON.stringify(s)):401===r.status?e="Invalid FAL API key. Please check your NEXT_PUBLIC_FAL_API_KEY environment variable.":429===r.status?e="Rate limit exceeded. Please wait a moment before trying again.":404===r.status&&(e="Model endpoint not found: ".concat(i,". The model may have been updated or moved.")),e);throw Error(a)}let m=await c.json();console.log("✅ FAL Response received:",m),console.log("\uD83D\uDDCB Response structure:",{hasRequestId:!!m.request_id,hasVideo:!!m.video,hasVideoUrl:!!(m.video&&m.video.url),keys:Object.keys(m),fullResponse:m});let u=m.request_id;if(u)return console.log("\uD83D\uDCCB Queue mode: polling for result..."),await e4(u,n,d,t,l,e.model,a);if(m.video&&m.video.url){if(console.log("⚡ Direct mode: video ready immediately"),null==a?void 0:a.downloadToMemory){console.log("\uD83D\uDCE5 Starting streaming download of video...");let e=await e9(m.video.url,a);a.onComplete&&a.onComplete(e)}return t&&t({status:"completed",progress:100,message:"Video generated successfully with ".concat(e.model),elapsedTime:Math.floor((Date.now()-d)/1e3)}),{job_id:l,status:"completed",message:"Video generated successfully with ".concat(e.model),estimated_time:Math.floor((Date.now()-d)/1e3),video_url:m.video.url,video_data:m}}{console.warn("⚠️ Queue mode failed, trying direct API call...");let r=await fetch("".concat(e2,"/").concat(n),{method:"POST",headers:{Authorization:"Key ".concat(e1),"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error("Both queue and direct modes failed. Status: ".concat(r.status,", Error: ").concat(JSON.stringify(e)))}let s=await r.json();if(console.log("✅ Direct API result:",s),s.video&&s.video.url){if(null==a?void 0:a.downloadToMemory){console.log("\uD83D\uDCE5 Starting streaming download of direct video...");let e=await e9(s.video.url,a);a.onComplete&&a.onComplete(e)}return t&&t({status:"completed",progress:100,message:"Video generated successfully with ".concat(e.model),elapsedTime:Math.floor((Date.now()-d)/1e3)}),{job_id:l,status:"completed",message:"Video generated successfully with ".concat(e.model),estimated_time:Math.floor((Date.now()-d)/1e3),video_url:s.video.url,video_data:s}}throw console.error("❌ Both attempts failed. Queue result:",m,"Direct result:",s),Error("No video URL received from either queue or direct API mode. Please check the logs for details.")}}catch(e){throw console.error("Error generating video:",e),t&&t({status:"failed",progress:0,message:e instanceof Error?e.message:"Unknown error occurred",elapsedTime:0}),e}}async function e4(e,t,a,r,s,i,n){let l=0;for(;l<60;){l++;let t=Math.floor((Date.now()-a)/1e3);try{let a=await fetch("".concat(e2,"/queue/requests/").concat(e,"/status"),{headers:{Authorization:"Key ".concat(e1)}});if(!a.ok){console.warn("⚠️ Status check failed (attempt ".concat(l,"):"),a.status),await e3(5e3);continue}let c=await a.json();if(console.log("\uD83D\uDCCA Queue status (".concat(t,"s):"),c),r){let e=function(e,t){let a={elapsedTime:t,logs:e.logs||[]};switch(e.status){case"IN_QUEUE":return{...a,status:"queued",progress:5,message:"Queued (position: ".concat(e.queue_position||"unknown",")"),estimatedTime:e.estimated_time};case"IN_PROGRESS":let r=Math.min(90,20+2*t);return{...a,status:"processing",progress:r,message:"Generating video...",estimatedTime:e.estimated_time};case"COMPLETED":return{...a,status:"completed",progress:100,message:"Video generation completed!"};case"FAILED":return{...a,status:"failed",progress:0,message:e.error||"Generation failed"};default:return{...a,status:"queued",progress:0,message:"Status: ".concat(e.status)}}}(c,t);r(e)}if("COMPLETED"===c.status){let a=await fetch("".concat(e2,"/queue/requests/").concat(e),{headers:{Authorization:"Key ".concat(e1)}});if(a.ok){var o,d;let l=await a.json();if(console.log("✅ FAL Queue completed:",l),(null==n?void 0:n.downloadToMemory)&&(null==(o=l.video)?void 0:o.url)){console.log("\uD83D\uDCE5 Starting streaming download of queued video...");let e=await e9(l.video.url,n);n.onComplete&&n.onComplete(e)}return r&&r({status:"completed",progress:100,message:"Video generated successfully with ".concat(i),elapsedTime:t}),{job_id:s||e,status:"completed",message:"Video generated successfully with ".concat(i),estimated_time:t,video_url:(null==(d=l.video)?void 0:d.url)||l.video,video_data:l}}}if("FAILED"===c.status){let e=c.error||"Video generation failed";throw r&&r({status:"failed",progress:0,message:e,elapsedTime:t}),Error(e)}await e3(5e3)}catch(e){if(console.error("❌ Status polling error (attempt ".concat(l,"):"),e),l>=60){let e="Timeout: Video generation took longer than expected (".concat(Math.floor(5)," minutes)");throw r&&r({status:"failed",progress:0,message:e,elapsedTime:t}),Error(e)}await e3(5e3)}}throw Error("Maximum polling attempts reached")}function e3(e){return new Promise(t=>setTimeout(t,e))}function e6(){return"job_"+Math.random().toString(36).substr(2,9)+"_"+Date.now()}async function e8(e){return new Promise((t,a)=>{let r=new FileReader;r.onload=()=>t(r.result),r.onerror=a,r.readAsDataURL(e)})}async function e7(e){try{var t,a;let r,s;if(!e1)throw Error("FAL API key not configured");console.log("\uD83E\uDD16 Starting image-to-video generation with FAL AI"),console.log("\uD83D\uDCDD Prompt:",e.prompt||"No additional prompt"),console.log("\uD83D\uDDBC️ Image:",e.image.name),console.log("\uD83D\uDCE4 Converting image to base64...");let i=await e8(e.image);console.log("✅ Image converted to data URL"),"kling_v2"===e.model?(r="fal-ai/kling-video/v2.1/master/image-to-video",s={prompt:e.prompt||"Create a cinematic video from this image",image_url:i,duration:e.duration||5,cfg_scale:.5}):(r="fal-ai/bytedance/seedance/v1/pro/image-to-video",s={prompt:e.prompt||"Create a cinematic video from this image",image_url:i,resolution:e.resolution||"1080p",duration:(null==(a=e.duration)?void 0:a.toString())||"5"});let n=e6();console.log("\uD83C\uDFAC Generating video with: ".concat(r)),console.log("\uD83D\uDCDD Payload:",s);let l=await fetch("".concat(e2,"/").concat(r),{method:"POST",headers:{Authorization:"Key ".concat(e1),"Content-Type":"application/json"},body:JSON.stringify(s)});if(!l.ok){let e=await l.json().catch(()=>({}));if(e.detail&&e.detail.includes("User is locked")){if(e.detail.includes("Exhausted balance"))throw Error("Your FAL.ai account balance has been exhausted. Please top up your balance at fal.ai/dashboard/billing to continue generating videos.");throw Error("Your FAL.ai account is temporarily locked. Please check your account status at fal.ai/dashboard.")}if(401===l.status)throw Error("Invalid FAL.ai API key. Please check your API key configuration.");if(429===l.status)throw Error("Rate limit exceeded. Please wait a moment before trying again.");throw Error("FAL API error: ".concat(e.detail||l.statusText))}let o=await l.json();return console.log("✅ FAL API response:",o),{job_id:n,status:"completed",message:"Video generated successfully from image with ".concat(e.model),estimated_time:0,video_url:(null==(t=o.video)?void 0:t.url)||o.video,video_data:o}}catch(e){throw console.error("Error generating video from image:",e),e}}async function e9(e,t){var a;console.log("\uD83D\uDD17 Starting streaming download from:",e);let r=await fetch(e);if(!r.ok)throw Error("Failed to download video: ".concat(r.status," ").concat(r.statusText));let s=null==(a=r.body)?void 0:a.getReader();if(!s)throw Error("Response body is not readable");let i=[],n=0;try{for(;;){let{done:e,value:a}=await s.read();if(e)break;i.push(a),n+=a.length,t.onDataReceived&&t.onDataReceived(a),console.log("\uD83D\uDCCA Downloaded ".concat(n," bytes..."))}let e=new Uint8Array(n),a=0;for(let t of i)e.set(t,a),a+=t.length;return console.log("✅ Download complete: ".concat(e.length," bytes total")),e}finally{s.releaseLock()}}class te{async startDownload(e,t,a){let r="ai-video-".concat(a,"-").concat(e,"-").concat(Date.now(),".mp4"),s="".concat(this.outputDir,"/").concat(r),i={id:e,filename:r,localPath:s,status:"downloading",progress:0,metadata:{prompt:t,model:a,duration:0,createdAt:new Date}};return this.activeDownloads.set(e,i),console.log("\uD83D\uDE80 AIVideoOutputManager: Started download tracking for ".concat(e)),s}updateProgress(e,t){let a=this.activeDownloads.get(e);a&&(a.progress=Math.min(100,Math.max(0,t)),console.log("\uD83D\uDCCA AIVideoOutputManager: Progress ".concat(e,": ").concat(a.progress,"%")))}async completeDownload(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,a=this.activeDownloads.get(e);return a?(a.status="completed",a.progress=100,a.metadata.duration=t,console.log("✅ AIVideoOutputManager: Download completed for ".concat(e)),a):null}markError(e,t){let a=this.activeDownloads.get(e);a&&(a.status="error",console.error("❌ AIVideoOutputManager: Download failed for ".concat(e,": ").concat(t)))}getDownloadStatus(e){return this.activeDownloads.get(e)||null}getAllActiveDownloads(){return Array.from(this.activeDownloads.values())}cleanupDownload(e){this.activeDownloads.delete(e),console.log("\uD83E\uDDF9 AIVideoOutputManager: Cleaned up download tracking for ".concat(e))}async createFileFromData(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"video/mp4";return new File([new Blob([e],{type:a})],t,{type:a})}constructor(e="./ai-generated-videos"){this.activeDownloads=new Map,this.outputDir=e}}var tt=a(8863);function ta(e){let{isOpen:t,onClose:a,generationHistory:r,onSelectVideo:i,onRemoveFromHistory:n,aiModels:l}=e;return t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:a}),(0,s.jsxs)("div",{className:"\n        fixed right-0 top-0 h-full w-80 bg-background border-l border-border z-50\n        transform transition-transform duration-300 ease-in-out\n        ".concat(t?"translate-x-0":"translate-x-full","\n      "),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eq.A,{className:"size-5 text-primary"}),(0,s.jsx)("h3",{className:"font-semibold",children:"Generation History"})]}),(0,s.jsx)(I.$,{size:"sm",variant:"text",onClick:a,className:"h-8 w-8 p-0",children:(0,s.jsx)(eX.A,{className:"size-4"})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===r.length?(0,s.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,s.jsx)(eq.A,{className:"size-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"No generation history yet"}),(0,s.jsx)("p",{className:"text-xs mt-1",children:"Generated videos will appear here"})]}):(0,s.jsx)("div",{className:"space-y-3",children:r.map(e=>{var t;return(0,s.jsxs)("div",{className:"bg-panel-accent rounded-lg border p-3",children:[(0,s.jsxs)("div",{className:"aspect-video bg-black rounded-lg mb-3 relative overflow-hidden",children:[(0,s.jsx)("video",{src:e.videoUrl,className:"w-full h-full object-cover",muted:!0,poster:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23000'/%3E%3C/svg%3E",children:"Your browser does not support the video tag."}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:(0,s.jsx)(eJ.A,{className:"size-8 text-white opacity-80"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"flex items-start justify-between",children:(0,s.jsx)("h4",{className:"text-sm font-medium line-clamp-2",children:e.prompt.length>40?"".concat(e.prompt.substring(0,40),"..."):e.prompt})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Model:"}),(0,s.jsx)("br",{}),(null==(t=l.find(t=>t.id===e.model))?void 0:t.name)||e.model]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Duration:"}),(0,s.jsx)("br",{}),e.duration||5,"s"]})]}),e.fileSize&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,s.jsx)("span",{className:"font-medium",children:"Size:"})," ",(e.fileSize/1024).toFixed(1)," KB"]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,s.jsxs)(I.$,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>i(e),children:[(0,s.jsx)(eJ.A,{className:"mr-1 size-3"}),"Use"]}),(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>{let t=document.createElement("a");t.href=e.videoUrl,t.download="generated-video-".concat(e.jobId.substring(0,8),".mp4"),t.click()},children:(0,s.jsx)(eF.A,{className:"size-3"})}),(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>n(e.jobId),className:"text-destructive hover:text-destructive",children:(0,s.jsx)(tt.A,{className:"size-3"})})]})]},e.jobId)})})}),(0,s.jsx)("div",{className:"p-4 border-t border-border",children:(0,s.jsxs)("p",{className:"text-xs text-muted-foreground text-center",children:[r.length," video",1!==r.length?"s":""," in history"]})})]})]}):null}let tr=[{id:"kling_v2",name:"Kling v2.1",description:"Premium model with unparalleled motion fluidity",price:"0.15",resolution:"1080p"},{id:"seedance",name:"Seedance v1 Lite",description:"Fast and efficient text-to-video generation",price:"0.18",resolution:"720p"},{id:"hailuo",name:"Hailuo 02",description:"Standard quality with realistic physics",price:"0.27",resolution:"768p"},{id:"hailuo_pro",name:"Hailuo 02 Pro",description:"Premium 1080p with ultra-realistic physics",price:"0.48",resolution:"1080p"},{id:"seedance_pro",name:"Seedance v1 Pro",description:"High quality 1080p video generation",price:"0.62",resolution:"1080p"},{id:"veo3_fast",name:"Veo3 Fast",description:"High quality, faster generation",price:"2.00",resolution:"1080p"},{id:"veo3",name:"Veo3",description:"Highest quality, slower generation",price:"3.00",resolution:"1080p"}];function ts(){var e,t;let[a,r]=(0,i.useState)(""),[n,l]=(0,i.useState)([]),[o,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)(null),[p,h]=(0,i.useState)(null),[g,v]=(0,i.useState)(null),[b,y]=(0,i.useState)([]),[w,j]=(0,i.useState)([]),[N]=(0,i.useState)(()=>new te("./ai-generated-videos")),[E,C]=(0,i.useState)(null),[T,M]=(0,i.useState)(null),A=(0,i.useRef)(null),{aiActiveTab:R,setAiActiveTab:D}=S(),{activeProject:L}=(0,eh.I)(),_=(null==L||null==(e=L.id)?void 0:e.startsWith("project-"))&&/^project-\d{13}$/.test((null==L?void 0:L.id)||""),O=e=>{l(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},B=e=>n.includes(e),H=async()=>{if("text"===R){if(!a.trim()||0===n.length)return}else if(!E||0===n.length)return;d(!0),m(null),h(null),y([]);try{let t=[];for(let r=0;r<n.length;r++){var e;let s=n[r],i=null==(e=tr.find(e=>e.id===s))?void 0:e.name;q("\uD83E\uDDEA Mock generating with ".concat(i," (").concat(r+1,"/").concat(n.length,")")),await new Promise(e=>setTimeout(e,1500));let l={jobId:"mock-job-".concat(Date.now(),"-").concat(r),videoUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",videoPath:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",fileSize:2097152,duration:15,prompt:a.trim(),model:s};t.push({modelId:s,video:l}),ef(l),U.w.log("AIView","MOCK_VIDEO_GENERATED",{modelName:i,mockJobId:l.jobId,modelId:s})}y(t),q("\uD83E\uDDEA Mock generated ".concat(t.length," videos successfully!"))}catch(e){m("Mock generation error: "+(e instanceof Error?e.message:"Unknown error")),U.w.log("AIView","MOCK_GENERATION_FAILED",{error:e instanceof Error?e.message:"Unknown error"})}finally{d(!1)}};U.w.log("AIView","RENDER",{activeTab:R,selectedModels:n,selectedImageExists:!!E,currentProjectId:null==L?void 0:L.id,isFallbackProject:_,currentUrl:window.location.href,renderCount:Math.random(),codeVersion:"2025-07-21-15:30-MULTI-SELECT-IMPLEMENTATION"});let[G,V]=(0,i.useState)(0),[$,q]=(0,i.useState)(""),[X,J]=(0,i.useState)(0),[K,Z]=(0,i.useState)(),[Y,Q]=(0,i.useState)(0),[ee,et]=(0,i.useState)(null),[ea,er]=(0,i.useState)([]),[es,ei]=(0,i.useState)(!1),{addMediaItem:en}=(0,P.useMediaStore)(),{aiPanelWidth:el,aiPanelMinWidth:eo}=k(),ed="number"==typeof el?el:22,ec=ed<=("number"==typeof eo?eo:4)+2,em=ed<18,eu=async e=>{var t;console.log("\uD83D\uDCE5 Starting video download from:",e);let a=await fetch(e);if(!a.ok)throw Error("Failed to download video: ".concat(a.status," ").concat(a.statusText));let r=null==(t=a.body)?void 0:t.getReader();if(!r)throw Error("Response body is not readable");let s=[],i=0;try{for(;;){let{done:e,value:t}=await r.read();if(e)break;s.push(t),i+=t.length}let e=new Uint8Array(i),t=0;for(let a of s)e.set(a,t),t+=a.length;return console.log("✅ Download complete: ".concat(e.length," bytes total")),e}finally{r.releaseLock()}},ep=500-a.length;(0,i.useEffect)(()=>{let e=localStorage.getItem("ai-generation-history");if(e)try{let t=JSON.parse(e);j(t)}catch(e){U.w.log("AIView","PARSE_HISTORY_ERROR",{error:e instanceof Error?e.message:"Unknown error"})}},[]);let eg=e=>{try{localStorage.setItem("ai-generation-history",JSON.stringify(e))}catch(e){U.w.log("AIView","SAVE_HISTORY_ERROR",{error:e instanceof Error?e.message:"Unknown error"})}},ef=e=>{let t=[e,...w.slice(0,9)];j(t),eg(t)};(0,i.useEffect)(()=>()=>{ee&&clearInterval(ee)},[ee]);let ex=async()=>{var e,t,r;if("text"===R){if(!a.trim()||0===n.length)return}else if(!E||0===n.length)return;d(!0),m(null),h(null),y([]);try{let s=[];for(let i=0;i<n.length;i++){let l,o=n[i];q("Generating with ".concat(null==(e=tr.find(e=>e.id===o))?void 0:e.name," (").concat(i+1,"/").concat(n.length,")")),Q(i);let d=e=>{var t;V(e.progress||0),q(e.message||"Generating with ".concat(null==(t=tr.find(e=>e.id===o))?void 0:t.name,"...")),J(e.elapsedTime||0),Z(e.estimatedTime),e.logs&&er(e.logs)};if(l="text"===R?await e5({prompt:a.trim(),model:o,resolution:"1080p",duration:6},d):await e7({image:E,model:o,prompt:a.trim()||void 0,resolution:"1080p",duration:6}),"completed"===l.status&&l.video_url){let e={jobId:l.job_id,videoUrl:l.video_url,videoPath:l.video_url,fileSize:void 0,duration:6,prompt:a.trim(),model:o};if(s.push({modelId:o,video:e}),ef(e),L)try{let a=(null==(t=tr.find(e=>e.id===o))?void 0:t.name)||o,r=await N.startDownload(e.jobId,e.prompt,o);console.log("\uD83D\uDE80 Started download tracking for ".concat(a,": ").concat(r)),q("Downloading ".concat(a," video..."));let s=await eu(e.videoUrl);await N.completeDownload(e.jobId,e.duration||6);let i="ai-".concat(a.toLowerCase().replace(/\s+/g,"-"),"-").concat(e.jobId.substring(0,8),".mp4"),n=await N.createFileFromData(s,i);await en(L.id,{name:"AI (".concat(a,"): ").concat(e.prompt.substring(0,20),"..."),type:"video",file:n,duration:e.duration||5,width:1920,height:1080}),U.w.log("AIView","VIDEO_DOWNLOADED_AND_ADDED_TO_MEDIA_PANEL",{videoUrl:e.videoUrl,modelName:a,fileName:i,projectId:L.id,downloadSize:s.length})}catch(t){N.markError(e.jobId,t instanceof Error?t.message:"Unknown error"),U.w.log("AIView","VIDEO_DOWNLOAD_OR_ADD_TO_MEDIA_PANEL_FAILED",{error:t instanceof Error?t.message:"Unknown error",modelName:null==(r=tr.find(e=>e.id===o))?void 0:r.name,projectId:L.id})}}}y(s),q("Generated ".concat(s.length," videos successfully!"))}catch(e){m(e instanceof Error?e.message:"An unknown error occurred"),U.w.log("AIView","MULTI_GENERATION_FAILED",{error:e instanceof Error?e.message:"Unknown error"})}finally{d(!1)}},ev=()=>{v(null),y([]),h(null),m(null),V(0),q(""),J(0),Z(void 0),Q(0),er([]),ee&&(clearInterval(ee),et(null))},eb=!o&&0!==n.length&&("text"===R?a.trim().length>0:null!==E),ey=n.reduce((e,t)=>{let a=tr.find(e=>e.id===t);return e+(a?parseFloat(a.price):0)},0);return(0,s.jsxs)("div",{className:"h-full flex flex-col transition-all duration-200 ".concat(ec?"p-2":em?"p-3":"p-4"),children:[(0,s.jsxs)("div",{className:"flex items-center mb-4 ".concat(ec?"justify-center":em?"flex-col gap-1":"justify-between"),children:[(0,s.jsxs)("div",{className:"flex items-center ".concat(em&&!ec?"flex-col":""),style:{marginLeft:"5px",gap:"7px"},children:[(0,s.jsx)(u.A,{className:"size-5 text-primary"}),!ec&&(0,s.jsx)("h3",{className:"text-sm font-medium ".concat(em?"text-center text-xs":""),children:em?"AI":"AI Video Generation"})]}),w.length>0&&!ec&&(0,s.jsxs)(I.$,{type:"button",size:"sm",variant:"text",onClick:()=>ei(!0),className:"h-8 ".concat(em?"px-1":"px-2"),children:[(0,s.jsx)(eq.A,{className:"size-4 mr-1"}),!em&&"History (".concat(w.length,")"),em&&w.length]})]}),ec?(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center gap-2",children:[(0,s.jsx)(u.A,{className:"size-8 text-primary/50"}),(0,s.jsx)("span",{className:"text-[0.6rem] text-muted-foreground text-center",children:"AI"})]}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col ".concat(em?"gap-2":"gap-4"),children:[(0,s.jsxs)(eZ,{value:R,onValueChange:e=>{U.w.log("AIView","TAB_CHANGE",{from:R,to:e,currentProjectId:null==L?void 0:L.id}),D(e)},children:[(0,s.jsxs)(eY,{className:"grid w-full grid-cols-2 bg-transparent",children:[(0,s.jsxs)(eQ,{value:"text",className:"flex items-center bg-transparent text-white data-[state=active]:bg-transparent data-[state=active]:text-white border-0 shadow-none hover:text-blue-400 transition-colors duration-200 ".concat(em?"gap-1 text-xs p-2":"gap-2"),children:[(0,s.jsx)(f.A,{className:"size-4"}),em?"Text":"Text to Video"]}),(0,s.jsxs)(eQ,{value:"image",className:"flex items-center bg-transparent text-white data-[state=active]:bg-transparent data-[state=active]:text-white border-0 shadow-none hover:text-blue-400 transition-colors duration-200 ".concat(em?"gap-1 text-xs p-2":"gap-2"),children:[(0,s.jsx)(x.A,{className:"size-4"}),em?"Image":"Image to Video"]})]}),(0,s.jsx)(e0,{value:"text",className:em?"space-y-2":"space-y-4",children:(0,s.jsxs)("div",{className:em?"space-y-1":"space-y-2",children:[(0,s.jsx)("div",{style:{height:"6px"}}),(0,s.jsx)(ek.J,{htmlFor:"prompt",className:em?"text-xs":"",style:{marginLeft:"5px"},children:em?"Prompt":"Describe your video"}),(0,s.jsx)("div",{style:{height:"6px"}}),(0,s.jsx)(eI,{id:"prompt",placeholder:em?"Video prompt...":"Describe your video...",value:a,onChange:e=>r(e.target.value.slice(0,500)),className:"resize-none ".concat(em?"min-h-[60px] text-sm":"min-h-[80px]")}),(0,s.jsxs)("div",{className:"flex items-center ".concat(em?"flex-col gap-1":"justify-between"),children:[!em&&(0,s.jsx)("p",{className:"text-[0.65rem] text-muted-foreground",style:{marginLeft:"5px"},children:"Be specific about scenes, actions, and style"}),(0,s.jsxs)("span",{className:"text-xs ".concat(ep<50?"text-destructive":"text-muted-foreground"),children:[ep,"/",500]})]})]})},"text-tab-content"),(0,s.jsxs)(e0,{value:"image",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(ek.J,{children:"Upload Image"}),(0,s.jsx)("div",{style:{height:"6px"}}),E?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:T,alt:"Selected image",className:"w-full h-40 object-cover rounded-lg border"}),(0,s.jsx)(I.$,{type:"button",size:"sm",variant:"destructive",className:"absolute top-2 right-2",onClick:()=>{C(null),M(null),A.current&&(A.current.value="")},children:(0,s.jsx)(eX.A,{className:"size-3"})}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:[E.name," (",(E.size/1024/1024).toFixed(1)," MB)"]})]}):(0,s.jsxs)("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>{var e;return null==(e=A.current)?void 0:e.click()},children:[(0,s.jsx)(F.A,{className:"size-8 mx-auto mb-2 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Click to upload an image"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"JPG, PNG, WEBP (max 10MB)"})]}),(0,s.jsx)("input",{ref:A,type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(!a)return;if(!a.type.startsWith("image/"))return void m("Please select a valid image file");if(a.size>0xa00000)return void m("Image file too large (max 10MB)");C(a),m(null);let r=new FileReader;r.onload=e=>{var t;M(null==(t=e.target)?void 0:t.result)},r.readAsDataURL(a)},className:"hidden"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{style:{height:"6px"}}),(0,s.jsx)(ek.J,{htmlFor:"image-prompt",style:{marginLeft:"5px"},children:"Additional prompt (optional)"}),(0,s.jsx)("div",{style:{height:"6px"}}),(0,s.jsx)(eI,{id:"image-prompt",placeholder:"Describe how the image should animate...",value:a,onChange:e=>r(e.target.value.slice(0,500)),className:"min-h-[60px] resize-none"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Describe motion, style, or effects"}),(0,s.jsxs)("span",{className:"text-xs ".concat(ep<50?"text-destructive":"text-muted-foreground"),children:[ep,"/",500]})]})]})]},"image-tab-content")]}),(0,s.jsx)(I.$,{onClick:ex,disabled:!eb,className:"w-full",size:em?"sm":"lg",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.A,{className:"mr-2 size-4 animate-spin"}),em?"Gen...":"Generating..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"mr-2 size-4"}),em?"Generate":"Generate Video"]})}),(0,s.jsxs)("div",{className:em?"space-y-1":"space-y-2",children:[(0,s.jsx)(ek.J,{htmlFor:"models",className:"font-medium text-foreground ".concat(em?"text-xs":"text-sm"),children:em?"Models":"AI Models"}),(0,s.jsx)("div",{style:{height:"6px"}}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-2 overflow-y-auto ".concat(em?"max-h-32":"max-h-48"),children:tr.map(e=>(0,s.jsxs)(I.$,{type:"button",variant:"outline",size:"sm",onClick:()=>O(e.id),className:"\n                  flex items-center justify-between h-auto text-left font-mono\n                  transition-all duration-200 border-border/50 \n                  ".concat(em?"p-2":"p-3","\n                  ").concat(B(e.id)?"bg-transparent border-blue-500/50":"bg-transparent hover:bg-accent/50 hover:border-border","\n                "),children:[(0,s.jsxs)("div",{className:"flex items-center ".concat(em?"gap-2":"gap-3"),children:[(0,s.jsx)("div",{className:"\n                    w-4 h-4 rounded border flex items-center justify-center\n                    ".concat(B(e.id)?"bg-blue-500 border-transparent":"border-border bg-transparent","\n                  "),children:B(e.id)&&(0,s.jsx)(W.A,{className:"w-3 h-3 text-white"})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium ".concat(em?"text-xs":"text-sm"," ").concat(B(e.id)?"text-[#05c7c7]":"text-foreground"),children:em?e.name.split(" ")[0]:e.name}),!em&&(0,s.jsx)("span",{className:"text-xs ".concat(B(e.id)?"text-[#05c7c7]":"text-muted-foreground"),children:e.description})]})]}),!em&&(0,s.jsxs)("span",{className:"text-xs font-normal ml-6 ".concat(B(e.id)?"text-[#05c7c7]":"text-muted-foreground"),children:["USD ",e.price," • ",e.resolution]}),em&&(0,s.jsxs)("span",{className:"text-xs font-normal ".concat(B(e.id)?"text-[#05c7c7]":"text-muted-foreground"),children:["$",e.price]})]},e.id))}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)(I.$,{type:"button",size:"sm",variant:"outline",onClick:()=>l(tr.map(e=>e.id)),className:"text-xs flex-1 !bg-transparent",children:"Select All"}),(0,s.jsx)(I.$,{type:"button",size:"sm",variant:"outline",onClick:()=>l([]),className:"text-xs flex-1 !bg-transparent",children:"Clear All"})]})]}),n.length>0&&(0,s.jsxs)("div",{className:"bg-panel-accent rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(u.A,{className:"size-4 text-primary"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[n.length," Model",n.length>1?"s":""," Selected"]})]}),(0,s.jsx)("div",{className:"space-y-1",children:n.map(e=>{let t=tr.find(t=>t.id===e);return(0,s.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,s.jsx)("span",{className:"text-foreground",children:null==t?void 0:t.name}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:["USD ",null==t?void 0:t.price]})]},e)})})]}),(0,s.jsx)("div",{className:"mt-auto pt-4 space-y-2",children:(0,s.jsx)(I.$,{onClick:H,disabled:!eb,className:"w-full",size:"lg",variant:"outline",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.A,{className:"mr-2 size-4 animate-spin"}),"Mock Generating..."]}):(0,s.jsx)(s.Fragment,{children:"Generate Preview"})})}),o&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(z.A,{className:"size-4 animate-spin text-blue-500"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-blue-700",children:["Model ",Y+1," of ",n.length]})]}),(0,s.jsxs)("div",{className:"text-xs text-blue-600",children:[Math.floor(X/60),":",String(X%60).padStart(2,"0")]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"text-blue-600",children:$}),(0,s.jsxs)("span",{className:"text-blue-600",children:[G,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-blue-100 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(G,"%")}})})]}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-blue-600",children:[(0,s.jsxs)("span",{children:["Elapsed: ",Math.floor(X/60),":",String(X%60).padStart(2,"0")]}),K&&(0,s.jsxs)("span",{children:["Est. remaining: ",Math.floor(K/60),":",String(K%60).padStart(2,"0")]})]}),(0,s.jsxs)("div",{className:"text-xs text-blue-600",children:["Generating with: ",(0,s.jsx)("span",{className:"font-medium",children:null==(t=tr.find(e=>e.id===n[Y]))?void 0:t.name})]}),ea.length>0&&(0,s.jsxs)("details",{className:"text-xs",children:[(0,s.jsxs)("summary",{className:"text-blue-600 cursor-pointer hover:text-blue-700",children:["View detailed logs (",ea.length," entries)"]}),(0,s.jsx)("div",{className:"mt-2 p-2 bg-blue-50 rounded border max-h-24 overflow-y-auto",children:ea.map((e,t)=>(0,s.jsx)("div",{className:"text-blue-700 font-mono text-[10px] mb-1",children:e},t))})]})]}),c&&(0,s.jsx)("div",{className:"mt-2 p-2 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive",children:c}),o&&p&&(0,s.jsx)("div",{className:"mt-2 space-y-2",children:(0,s.jsxs)("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(z.A,{className:"size-4 animate-spin text-blue-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-blue-700",children:$||"Processing..."})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(G,"%")}})}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,s.jsxs)("span",{className:"text-xs text-blue-600",children:["Job ID: ",p.substring(0,8),"..."]}),(0,s.jsxs)("span",{className:"text-xs text-blue-600",children:[G,"%"]})]})]})}),p&&!o&&!g&&!c&&(0,s.jsx)("div",{className:"mt-2 p-2 bg-green-500/10 border border-green-500/20 rounded text-sm text-green-700",children:"✅ Generation completed! Processing video..."}),n.length>0&&!b.length&&(0,s.jsx)("div",{className:"mt-2 text-center",children:(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Total Cost: USD ",ey.toFixed(2)," • ",n.length," model",n.length>1?"s":""]})}),!eb&&!o&&0===b.length&&(0,s.jsx)("div",{className:"mt-2 text-center",children:(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:0===n.length?"Select at least one AI model":"text"===R?"Enter a video description":"Upload an image"})}),b.length>0&&(0,s.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(eJ.A,{className:"size-4 text-green-600"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-green-700",children:[b.length," Video",b.length>1?"s":""," Generated Successfully!"]})]}),(0,s.jsx)("div",{className:"text-sm text-green-700 mb-3",children:"✅ All videos automatically added to Media panel"}),(0,s.jsx)("div",{className:"space-y-2",children:b.map(e=>{let{modelId:t,video:a}=e,r=tr.find(e=>e.id===t);return(0,s.jsxs)("div",{className:"bg-green-500/5 border border-green-500/20 rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"font-medium text-sm text-green-700",children:null==r?void 0:r.name}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["USD ",null==r?void 0:r.price," • ",null==r?void 0:r.resolution]})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)(I.$,{type:"button",size:"sm",variant:"outline",onClick:()=>{let e=document.createElement("a");e.href=a.videoUrl,e.download="ai-".concat(null==r?void 0:r.name.toLowerCase().replace(/\s+/g,"-"),"-").concat(a.jobId.substring(0,8),".mp4"),e.click()},className:"flex-1",children:[(0,s.jsx)(eF.A,{className:"mr-1 size-3"}),"Download"]})})]},t)})}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsxs)(I.$,{type:"button",size:"sm",variant:"outline",onClick:()=>{b.forEach(e=>{let{modelId:t,video:a}=e,r=tr.find(e=>e.id===t),s=document.createElement("a");s.href=a.videoUrl,s.download="ai-".concat(null==r?void 0:r.name.toLowerCase().replace(/\s+/g,"-"),"-").concat(a.jobId.substring(0,8),".mp4"),s.click()})},className:"flex-1",children:[(0,s.jsx)(eF.A,{className:"mr-1 size-3"}),"Download All (",b.length,")"]}),(0,s.jsx)(I.$,{type:"button",size:"sm",variant:"outline",onClick:ev,className:"flex-1",children:"Generate Again"})]})]}),g&&0===b.length&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(eJ.A,{className:"size-4 text-green-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-green-700",children:"Video Generated Successfully!"})]}),(0,s.jsx)("div",{className:"text-sm text-green-700 mb-3",children:"✅ Video automatically added to Media panel"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(I.$,{type:"button",size:"sm",variant:"outline",onClick:()=>{let e=document.createElement("a");e.href=g.videoUrl,e.download="generated-video-".concat(g.jobId.substring(0,8),".mp4"),e.click()},children:[(0,s.jsx)(eF.A,{className:"mr-1 size-3"}),"Download"]}),(0,s.jsx)(I.$,{type:"button",size:"sm",variant:"outline",className:"flex-1",onClick:ev,children:"Generate Another Video"})]})]}),(0,s.jsx)(ta,{isOpen:es,onClose:()=>ei(!1),generationHistory:w,onSelectVideo:e=>{v(e),ei(!1)},onRemoveFromHistory:e=>{let t=w.filter(t=>t.jobId!==e);j(t),eg(t)},aiModels:tr})]})]})}var ti=a(1484),tn=a(7623),tl=a(3559),to=a(7025),td=a(2576),tc=a(2427),tm=a(6617);let tu="ce1a4a62-4ceb-4faa-989f-2ed52adb7f7d:6b16e77cf71a9c9ed70149237587f95e",tp="https://fal.run",th={seededit:{endpoint:"fal-ai/bytedance/seededit/v3/edit-image",defaultParams:{guidance_scale:1}},"flux-kontext":{endpoint:"fal-ai/flux-pro/kontext",defaultParams:{guidance_scale:3.5,num_inference_steps:28,safety_tolerance:2,num_images:1}},"flux-kontext-max":{endpoint:"fal-ai/flux-pro/kontext/max",defaultParams:{guidance_scale:3.5,num_inference_steps:28,safety_tolerance:2,num_images:1}}};async function tg(e){if(!tu)throw Error("FAL API key not configured");console.log("\uD83D\uDCE4 UPLOAD: Starting upload process for:",{fileName:e.name,fileSize:e.size,fileType:e.type});try{console.log("\uD83D\uDD04 UPLOAD: Attempting FAL storage upload...");let t=new FormData;t.append("file",e);let a=await fetch("https://fal.run/storage/upload",{method:"POST",headers:{Authorization:"Key ".concat(tu)},body:t});if(a.ok){let e=await a.json();return console.log("✅ UPLOAD: FAL storage upload successful:",e),e.url}{let e=await a.text();console.warn("⚠️ UPLOAD: FAL storage upload failed, falling back to base64:",{status:a.status,error:e})}}catch(e){console.warn("⚠️ UPLOAD: FAL storage upload error, using base64 fallback:",e)}return console.log("\uD83D\uDD04 UPLOAD: Using base64 data URL fallback..."),new Promise((t,a)=>{let r=new FileReader;r.onload=()=>{if(r.result){let a=r.result;if(a.startsWith("data:image;base64,")){let t=e.type||"image/png",r=a.split(",")[1];a="data:".concat(t,";base64,").concat(r),console.log("\uD83D\uDD27 UPLOAD: Fixed MIME type in data URL")}console.log("✅ UPLOAD: Image converted to base64 data URL for FAL API"),console.log("\uD83D\uDD0D UPLOAD: Data URL format:",{type:typeof a,length:a.length,startsWithData:a.startsWith("data:"),prefix:a.substring(0,30),mimeType:a.split(";")[0]}),t(a)}else a(Error("Failed to convert image to base64"))},r.onerror=()=>a(Error("Failed to read image file")),r.readAsDataURL(e)})}async function tf(e,t){var a,r,s,i,n;if(!tu)throw Error("FAL API key not configured");let l=th[e.model];if(!l)throw Error("Unsupported model: ".concat(e.model));let o=Date.now(),d="edit_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),c={prompt:e.prompt,image_url:e.imageUrl,...l.defaultParams};void 0!==e.guidanceScale&&(c.guidance_scale=e.guidanceScale),void 0!==e.steps&&(c.num_inference_steps=e.steps),void 0!==e.seed&&(c.seed=e.seed),void 0!==e.safetyTolerance&&(c.safety_tolerance=e.safetyTolerance),void 0!==e.numImages&&(c.num_images=e.numImages),console.log("\uD83C\uDFA8 Editing image with ".concat(e.model,":"),{...c,image_url:(null==(a=c.image_url)?void 0:a.substring(0,50))+"..."}),console.log("\uD83D\uDD0D DEBUG: Image URL details:",{type:typeof c.image_url,length:null==(r=c.image_url)?void 0:r.length,startsWithData:null==(s=c.image_url)?void 0:s.startsWith("data:"),startsWithHttps:null==(i=c.image_url)?void 0:i.startsWith("https:"),firstChars:null==(n=c.image_url)?void 0:n.substring(0,20)}),t&&t({status:"queued",progress:0,message:"Submitting to FAL.ai...",elapsedTime:0});try{let a=await fetch("".concat(tp,"/").concat(l.endpoint),{method:"POST",headers:{Authorization:"Key ".concat(tu),"Content-Type":"application/json","X-Fal-Queue":"true"},body:JSON.stringify(c)});if(!a.ok){let e=await a.json().catch(()=>({}));if(console.error("FAL API Error:",e),422===a.status&&e.detail&&Array.isArray(e.detail)&&e.detail.find(e=>"content_policy_violation"===e.type))throw Error("Content policy violation: Please use appropriate language for image descriptions");let t=e.detail?"string"==typeof e.detail?e.detail:JSON.stringify(e.detail):e.message||a.statusText;throw Error("API error: ".concat(a.status," - ").concat(t))}let r=await a.json();if(console.log("✅ FAL API response:",JSON.stringify(r,null,2)),r.request_id)return console.log("\uD83D\uDCCB Using queue mode with request_id:",r.request_id),await tx(r.request_id,l.endpoint,o,t,d,e.model);if(r.images&&r.images.length>0)return console.log("\uD83C\uDFAF Using direct mode with images:",r.images.length),t&&t({status:"completed",progress:100,message:"Image editing completed!",elapsedTime:Math.floor((Date.now()-o)/1e3)}),{job_id:d,status:"completed",message:"Image edited successfully",result_url:r.images[0].url,seed_used:r.seed,processing_time:Math.floor((Date.now()-o)/1e3)};if(r.image&&r.image.url)return console.log("\uD83C\uDFAF Using direct mode with single image object"),t&&t({status:"completed",progress:100,message:"Image editing completed!",elapsedTime:Math.floor((Date.now()-o)/1e3)}),{job_id:d,status:"completed",message:"Image edited successfully",result_url:r.image.url,seed_used:r.seed,processing_time:Math.floor((Date.now()-o)/1e3)};else if(r.url)return console.log("\uD83C\uDFAF Using direct mode with root URL"),t&&t({status:"completed",progress:100,message:"Image editing completed!",elapsedTime:Math.floor((Date.now()-o)/1e3)}),{job_id:d,status:"completed",message:"Image edited successfully",result_url:r.url,seed_used:r.seed,processing_time:Math.floor((Date.now()-o)/1e3)};else throw console.error("❌ Unexpected API response structure:",{hasRequestId:!!r.request_id,hasImages:!!r.images,hasImageObject:!!r.image,hasUrlRoot:!!r.url,keys:Object.keys(r),result:r}),Error("Unexpected response format from FAL API. Response keys: ".concat(Object.keys(r).join(", ")))}catch(e){throw t&&t({status:"failed",progress:0,message:e instanceof Error?e.message:"Unknown error",elapsedTime:Math.floor((Date.now()-o)/1e3)}),e}}async function tx(e,t,a,r,s,i){let n=0;for(;n<30;){n++;let t=Math.floor((Date.now()-a)/1e3);try{let a=await fetch("".concat(tp,"/queue/requests/").concat(e,"/status"),{headers:{Authorization:"Key ".concat(tu)}});if(!a.ok){console.warn("Status check failed (attempt ".concat(n,"):"),a.status),await tv(5e3);continue}let c=await a.json();if(console.log("\uD83D\uDCCA Edit status (".concat(t,"s):"),c),r){let e=function(e,t){let a={elapsedTime:t};switch(e.status){case"IN_QUEUE":return{...a,status:"queued",progress:10,message:"Queued (position: ".concat(e.queue_position||"unknown",")"),estimatedTime:e.estimated_time};case"IN_PROGRESS":return{...a,status:"processing",progress:Math.min(90,20+3*t),message:"Processing image...",estimatedTime:e.estimated_time};case"COMPLETED":return{...a,status:"completed",progress:100,message:"Image editing completed!"};case"FAILED":return{...a,status:"failed",progress:0,message:e.error||"Processing failed"};default:return{...a,status:"processing",progress:5,message:"Status: ".concat(e.status)}}}(c,t);r(e)}if("COMPLETED"===c.status){let a=await fetch("".concat(tp,"/queue/requests/").concat(e),{headers:{Authorization:"Key ".concat(tu)}});if(a.ok){var l,o,d;let n=await a.json();return console.log("✅ Edit completed:",n),r&&r({status:"completed",progress:100,message:"Image edited successfully with ".concat(i),elapsedTime:t}),{job_id:s||e,status:"completed",message:"Image edited successfully with ".concat(i),result_url:(null==(o=n.images)||null==(l=o[0])?void 0:l.url)||(null==(d=n.image)?void 0:d.url),seed_used:n.seed,processing_time:t}}}if("FAILED"===c.status){let e=c.error||"Image editing failed";throw r&&r({status:"failed",progress:0,message:e,elapsedTime:t}),Error(e)}await tv(5e3)}catch(e){if(console.error("Status polling error (attempt ".concat(n,"):"),e),n>=30)throw Error("Image editing timeout");await tv(5e3)}}throw Error("Maximum polling attempts reached")}function tv(e){return new Promise(t=>setTimeout(t,e))}function tb(){return[{id:"seededit",name:"SeedEdit v3",description:"Precise photo editing with content preservation",provider:"ByteDance",estimatedCost:"$0.05-0.10",features:["Photo retouching","Object modification","Realistic edits"],parameters:{guidanceScale:{min:1,max:10,default:1,step:.1},seed:{optional:!0}}},{id:"flux-kontext",name:"FLUX Pro Kontext",description:"Context-aware editing with scene transformations",provider:"FLUX",estimatedCost:"$0.15-0.25",features:["Style changes","Object replacement","Scene modification"],parameters:{guidanceScale:{min:1,max:20,default:3.5,step:.5},steps:{min:1,max:50,default:28,step:1},safetyTolerance:{min:1,max:6,default:2,step:1},numImages:{min:1,max:4,default:1,step:1}}},{id:"flux-kontext-max",name:"FLUX Pro Kontext Max",description:"Advanced editing for complex tasks and typography",provider:"FLUX",estimatedCost:"$0.25-0.40",features:["Complex edits","Typography","Professional adjustments"],parameters:{guidanceScale:{min:1,max:20,default:3.5,step:.5},steps:{min:1,max:50,default:28,step:1},safetyTolerance:{min:1,max:6,default:2,step:1},numImages:{min:1,max:4,default:1,step:1}}}]}async function ty(e){return new Promise((t,a)=>{let r=new Image,s=URL.createObjectURL(e);r.onload=()=>{let a={width:r.naturalWidth,height:r.naturalHeight,size:e.size,type:e.type,aspectRatio:r.naturalWidth/r.naturalHeight};URL.revokeObjectURL(s),t(a)},r.onerror=()=>{URL.revokeObjectURL(s),a(Error("Failed to load image"))},r.src=s})}async function tw(e,t){try{let a=await fetch(e),r=await a.blob(),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=t,i.style.display="none",document.body.appendChild(i),setTimeout(()=>{i.click(),document.body.removeChild(i),setTimeout(()=>{URL.revokeObjectURL(s)},100)},10)}catch(e){throw Error("Failed to download image: ".concat(e))}}function tj(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function tN(){let{selectedModel:e,setSelectedModel:t}=ef(),a=tb();return(0,s.jsx)(eM.Zp,{children:(0,s.jsxs)(eM.Wu,{className:"p-3 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Model Selection"})]}),(0,s.jsx)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto pr-1",style:{scrollbarWidth:"thin"},children:a.map(a=>{let r=e===a.id;return(0,s.jsxs)("button",{className:(0,o.cn)("w-full h-6 px-2 rounded-md border text-left cursor-pointer transition-all duration-200 flex items-center justify-between",r?"bg-transparent text-[#05c7c7] border-[#05c7c7] shadow-sm":"bg-card hover:bg-muted/50 border-muted-foreground/20 hover:border-muted-foreground/40"),onClick:()=>t(a.id),children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0",children:[r&&(0,s.jsx)(W.A,{className:"w-3 h-3 flex-shrink-0"}),(0,s.jsx)("span",{className:"text-xs font-medium truncate",children:a.name})]}),(0,s.jsx)("span",{className:(0,o.cn)("text-[10px] font-medium ml-2 flex-shrink-0 border border-transparent",r?"text-[#05c7c7]/80":"text-muted-foreground"),children:a.estimatedCost})]},a.id)})})]})})}var tE=a(2039);let tS=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(tE.bL,{ref:t,className:(0,o.cn)("relative flex w-full touch-none select-none items-center",a),...r,children:[(0,s.jsx)(tE.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,s.jsx)(tE.Q6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(tE.zi,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});tS.displayName=tE.bL.displayName;var tC=a(1771);function tT(){let{selectedModel:e,parameters:t,updateParameter:a,resetParameters:r}=ef(),i=tb().find(t=>t.id===e);if(!i)return null;let n=i.parameters;return(0,s.jsx)(eM.Zp,{children:(0,s.jsxs)(eM.Wu,{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full"}),(0,s.jsx)(ek.J,{className:"text-sm font-semibold",children:"Parameters"})]}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:r,className:"h-6 px-2",children:(0,s.jsx)(tC.A,{className:"size-3"})})]}),n.guidanceScale&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(ek.J,{className:"text-xs",children:"Guidance Scale"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:t.guidanceScale})]}),(0,s.jsx)(tS,{value:[t.guidanceScale],onValueChange:e=>{let[t]=e;return a("guidanceScale",t)},min:n.guidanceScale.min,max:n.guidanceScale.max,step:n.guidanceScale.step,className:"w-full"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Controls how closely the edit follows your prompt"})]}),n.steps&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(ek.J,{className:"text-xs",children:"Inference Steps"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:t.steps})]}),(0,s.jsx)(tS,{value:[t.steps],onValueChange:e=>{let[t]=e;return a("steps",t)},min:n.steps.min,max:n.steps.max,step:n.steps.step,className:"w-full"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"More steps = higher quality, slower processing"})]}),n.safetyTolerance&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(ek.J,{className:"text-xs",children:"Safety Tolerance"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:t.safetyTolerance})]}),(0,s.jsx)(tS,{value:[t.safetyTolerance],onValueChange:e=>{let[t]=e;return a("safetyTolerance",t)},min:n.safetyTolerance.min,max:n.safetyTolerance.max,step:n.safetyTolerance.step,className:"w-full"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Content safety filtering level"})]}),n.numImages&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(ek.J,{className:"text-xs",children:"Number of Images"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:t.numImages})]}),(0,s.jsx)(tS,{value:[t.numImages],onValueChange:e=>{let[t]=e;return a("numImages",t)},min:n.numImages.min,max:n.numImages.max,step:n.numImages.step,className:"w-full"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Generate multiple variations"})]}),n.seed&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(ek.J,{className:"text-xs",children:"Seed (Optional)"}),(0,s.jsx)(Y.p,{type:"number",value:t.seed||"",onChange:e=>a("seed",e.target.value?parseInt(e.target.value):void 0),placeholder:"Random",className:"h-8 text-xs"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Use same seed for reproducible results"})]})]})})}function tk(){let{originalImageUrl:e,currentEditedUrl:t,previewMode:a,setPreviewMode:r,editHistory:n,currentHistoryIndex:l}=ef(),[o,d]=(0,i.useState)(!1),c=n[l];return((0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&o&&d(!1)};if(o)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[o]),e)?(0,s.jsxs)(eM.Zp,{className:"h-full flex flex-col",children:[(0,s.jsxs)(eM.Wu,{className:"p-3 flex-1 flex flex-col",children:[(0,s.jsxs)(eZ,{value:t?"edited":"original",className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"Preview"}),c&&(0,s.jsx)(ti.E,{variant:"outline",className:"text-[10px] px-1.5 py-0 h-4",children:c.model})]}),(0,s.jsxs)(eY,{className:"grid grid-cols-2 h-6",children:[(0,s.jsx)(eQ,{value:"original",className:"text-[10px] px-2 h-5",children:"Original"}),(0,s.jsx)(eQ,{value:"edited",disabled:!t,className:"text-[10px] px-2 h-5",children:t?"Edited":"No Edit"})]})]}),(0,s.jsx)(e0,{value:"original",className:"flex-1 mt-0",children:(0,s.jsx)("div",{className:"h-full bg-muted/20 rounded-lg border-2 border-dashed border-muted-foreground/20 flex items-center justify-center overflow-hidden",children:(0,s.jsx)("img",{src:e,alt:"Original",className:"max-w-full max-h-full object-contain"})})}),(0,s.jsx)(e0,{value:"edited",className:"flex-1 mt-0",children:(0,s.jsx)("div",{className:"h-full bg-muted/20 rounded-lg border-2 border-dashed border-muted-foreground/20 flex items-center justify-center overflow-hidden",children:t?(0,s.jsx)("img",{src:t,alt:"Edited",className:"max-w-full max-h-full object-contain"}):(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(x.A,{className:"size-8 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm",children:"No edits yet"}),(0,s.jsx)("p",{className:"text-xs",children:"Generate an edit to see results"})]})})})]}),c&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t space-y-2",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,s.jsx)("strong",{children:"Prompt:"})," ",c.prompt]}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,s.jsxs)("span",{children:["Model: ",c.model]}),(0,s.jsxs)("span",{children:["Time: ",c.processingTime,"s"]})]})]})]}),o&&(0,s.jsxs)("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4",onClick:()=>d(!1),children:[(0,s.jsxs)("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between bg-gradient-to-b from-black/50 to-transparent",children:[(0,s.jsx)("div",{className:"text-white text-sm opacity-75",children:"Press ESC or click outside image to close"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(I.$,{variant:"secondary",size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/20",onClick:()=>d(!1),children:[(0,s.jsx)(eX.A,{className:"size-4 mr-1"}),"Close"]})})]}),(0,s.jsx)("div",{className:"max-w-full max-h-full",children:(0,s.jsx)("img",{src:t||e,alt:"Fullscreen preview",className:"max-w-full max-h-full object-contain shadow-2xl",onClick:e=>e.stopPropagation()})})]})]}):(0,s.jsx)(eM.Zp,{className:"h-full flex items-center justify-center",children:(0,s.jsxs)(eM.Wu,{children:[(0,s.jsx)(x.A,{className:"size-12 text-muted-foreground mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"No image to preview"})]})})}var tI=a(6594);let tM=i.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(tI.bL,{ref:t,className:(0,o.cn)("relative overflow-hidden",a),...i,children:[(0,s.jsx)(tI.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(tA,{}),(0,s.jsx)(tI.OK,{})]})});tM.displayName=tI.bL.displayName;let tA=i.forwardRef((e,t)=>{let{className:a,orientation:r="vertical",...i}=e;return(0,s.jsx)(tI.VM,{ref:t,orientation:r,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,s.jsx)(tI.lr,{className:"relative flex-1 rounded-full bg-border"})})});tA.displayName=tI.VM.displayName;var tR=a(3184);function tP(){let{editHistory:e,currentHistoryIndex:t,goToHistoryItem:a,clearHistory:r,canUndo:i,canRedo:n,undo:l,redo:d,toggleHistory:c}=ef(),m=async(e,t)=>{try{let a=new Date(e.timestamp).toISOString().slice(0,19).replace(/[:.]/g,"-"),r="edit-".concat(t+1,"-").concat(e.model,"-").concat(a,".png");await tw(e.editedUrl,r),R.oR.success("Edit ".concat(t+1," downloaded!"))}catch(e){R.oR.error("Failed to download image")}};return 0===e.length?(0,s.jsxs)(eM.Zp,{className:"h-full",children:[(0,s.jsx)(eM.aR,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(eM.ZB,{className:"text-sm flex items-center gap-2",children:[(0,s.jsx)(eq.A,{className:"size-4"}),"Edit History"]}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:c,className:"h-6 w-6 p-0",children:(0,s.jsx)(eX.A,{className:"size-3"})})]})}),(0,s.jsx)(eM.Wu,{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(eq.A,{className:"size-8 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm",children:"No edits yet"}),(0,s.jsx)("p",{className:"text-xs",children:"Start editing to build history"})]})})]}):(0,s.jsxs)(eM.Zp,{className:"h-full flex flex-col",children:[(0,s.jsxs)(eM.aR,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(eM.ZB,{className:"text-sm flex items-center gap-2",children:[(0,s.jsx)(eq.A,{className:"size-4"}),"Edit History",(0,s.jsx)(ti.E,{variant:"secondary",className:"text-xs",children:e.length})]}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:c,className:"h-6 w-6 p-0",children:(0,s.jsx)(eX.A,{className:"size-3"})})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(I.$,{variant:"outline",size:"sm",onClick:l,disabled:!i(),className:"flex-1 h-7",children:[(0,s.jsx)(tc.A,{className:"size-3 mr-1"}),"Undo"]}),(0,s.jsxs)(I.$,{variant:"outline",size:"sm",onClick:d,disabled:!n(),className:"flex-1 h-7",children:[(0,s.jsx)(tm.A,{className:"size-3 mr-1"}),"Redo"]}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:r,className:"h-7 px-2",children:(0,s.jsx)(tt.A,{className:"size-3"})})]})]}),(0,s.jsx)(eM.Wu,{className:"flex-1 p-3 pt-0",children:(0,s.jsx)(tM,{className:"h-full",children:(0,s.jsx)("div",{className:"space-y-2",children:e.map((e,r)=>{let i=r===t,n=r>t;return(0,s.jsxs)("div",{className:(0,o.cn)("p-3 rounded-lg border cursor-pointer transition-all group",i?"bg-primary/10 border-primary":n?"bg-muted/30 border-muted opacity-60":"hover:bg-muted/50 hover:border-muted-foreground/20"),onClick:()=>a(r),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(ti.E,{variant:i?"default":"outline",className:"text-xs",children:["#",r+1]}),(0,s.jsx)("span",{className:"text-xs font-medium",children:e.model})]}),(0,s.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),m(e,r)},className:"h-5 w-5 p-0",children:(0,s.jsx)(eF.A,{className:"size-3"})})})]}),(0,s.jsx)("div",{className:"aspect-video bg-muted/20 rounded border mb-2 overflow-hidden",children:(0,s.jsx)("img",{src:e.editedUrl,alt:"Edit ".concat(r+1),className:"w-full h-full object-cover"})}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-2 line-clamp-2",children:e.prompt}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(tR.A,{className:"size-3"}),(0,s.jsx)("span",{children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,s.jsxs)("span",{children:[e.processingTime,"s"]})]})]},e.id)})})})})]})}var tD=a(9120);function tL(e){let{onImageSelect:t,uploading:a}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useRef)(null),d=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?n(!0):"dragleave"===e.type&&n(!1)},[]),c=(0,i.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),n(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){let a=e.dataTransfer.files[0];a.type.startsWith("image/")&&t(a)}},[t]),m=(0,i.useCallback)(e=>{e.preventDefault(),e.target.files&&e.target.files[0]&&t(e.target.files[0])},[t]),u=(0,i.useCallback)(()=>{var e;null==(e=l.current)||e.click()},[]);return(0,s.jsx)(eM.Zp,{children:(0,s.jsx)(eM.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:(0,o.cn)("border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",r?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50 hover:bg-muted/25",a&&"pointer-events-none opacity-50"),onDragEnter:d,onDragLeave:d,onDragOver:d,onDrop:c,onClick:u,children:[(0,s.jsx)("input",{ref:l,type:"file",multiple:!1,className:"hidden",accept:"image/*",onChange:m,disabled:a}),a?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(z.A,{className:"size-8 text-primary animate-spin"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Loading image..."}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Please wait while we process your image"})]})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-center size-16 rounded-full bg-muted/50",children:r?(0,s.jsx)(tD.A,{className:"size-8 text-primary"}):(0,s.jsx)(F.A,{className:"size-8 text-muted-foreground"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-1",children:r?"Drop image here":"Upload an image to edit"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Drag & drop or click to browse"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Supports JPEG, PNG, WebP • Max 50MB"})]}),(0,s.jsxs)(I.$,{variant:"outline",size:"sm",className:"mt-2 !bg-transparent !border-transparent",children:[(0,s.jsx)(x.A,{className:"size-4 mr-2"}),"Choose Image"]})]})]})})})}function tz(){let{originalImage:e,originalImageUrl:t,currentEditedUrl:a,selectedModel:r,prompt:n,parameters:l,editHistory:d,isProcessing:c,progress:m,statusMessage:u,elapsedTime:p,showParameters:h,showHistory:g,previewMode:f,setOriginalImage:v,clearImage:b,setPrompt:y,addToHistory:w,setProcessingState:j,toggleParameters:N,toggleHistory:E,canUndo:C,canRedo:T,undo:k,redo:M}=ef();console.log("\uD83D\uDD0D ADJUSTMENT-VIEW: Component state:",{hasOriginalImage:!!e,originalImageType:e?typeof e:"null",originalImageName:null==e?void 0:e.name,originalImageSize:null==e?void 0:e.size,hasOriginalImageUrl:!!t});let{addMediaItem:A}=(0,P.useMediaStore)(),{activeProject:D}=(0,eh.I)(),{setActiveTab:L}=S(),[F,_]=(0,i.useState)(!1),[O,U]=(0,i.useState)(null);(0,i.useEffect)(()=>{console.log("\uD83D\uDD04 ADJUSTMENT-VIEW: originalImage changed:",{hasImage:!!e,imageName:null==e?void 0:e.name,shouldShowControls:!!e})},[e]);let B=(0,i.useCallback)(async(e,t,a)=>{try{if(!D)return void console.warn("No active project - cannot add to media");let r=await fetch(e);if(!r.ok)throw Error("Failed to fetch image: ".concat(r.statusText));let s=await r.blob(),i=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-"),n=a.slice(0,30).replace(/[^a-zA-Z0-9\s]/g,"").trim(),l="edited-".concat(t,"-").concat(n?n+"-":"").concat(i,".png"),o=new File([s],l,{type:"image/png"}),{width:d,height:c}=await ty(o);await A(D.id,{name:l,type:"image",file:o,width:d,height:c}),console.log("✅ Edited image automatically added to media: ".concat(l))}catch(e){console.error("Failed to auto-add to media:",e),R.oR.error("Failed to add edited image to media panel")}},[D,A]),H=(0,i.useCallback)(async e=>{U(null);let t=["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?e.size>0x3200000?{valid:!1,error:"File too large. Maximum size is 50MB."}:{valid:!0}:{valid:!1,error:"Unsupported file type. Please use JPEG, PNG, or WebP."};if(!t.valid)return void U(t.error);try{_(!0);let t=await ty(e),a=await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var r;(null==(r=e.target)?void 0:r.result)?t(e.target.result):a(Error("Failed to read file"))},r.onerror=()=>a(Error("Failed to read file")),r.readAsDataURL(e)});console.log("\uD83D\uDCF8 ADJUSTMENT-VIEW: Setting original image:",{fileName:e.name,fileSize:e.size,fileType:e.type,previewUrlLength:a.length}),v(e,a),R.oR.success("Image loaded: ".concat(t.width,"x").concat(t.height," (").concat(tj(e.size),")"))}catch(e){console.error("Error loading image:",e),U("Failed to load image")}finally{_(!1)}},[v]),W=(0,i.useCallback)(async()=>{if(!e||!n.trim())return void U("Please select an image and enter a prompt");U(null);try{j({isProcessing:!0,progress:5,statusMessage:"Uploading image..."}),console.log("\uD83D\uDE80 ADJUSTMENT: About to upload image:",{fileName:e.name,fileSize:e.size,fileType:e.type});let a=await tg(e);console.log("\uD83C\uDFAF ADJUSTMENT: Upload completed, imageUrl:",{type:typeof a,length:null==a?void 0:a.length,startsWithData:null==a?void 0:a.startsWith("data:"),prefix:null==a?void 0:a.substring(0,30)});let s=await tf({imageUrl:a,prompt:n,model:r,...l},e=>{j({isProcessing:"completed"!==e.status&&"failed"!==e.status,progress:e.progress,statusMessage:e.message,elapsedTime:e.elapsedTime||0,estimatedTime:e.estimatedTime})});if("completed"===s.status&&s.result_url)w({originalUrl:t,editedUrl:s.result_url,prompt:n,model:r,parameters:l,processingTime:s.processing_time}),await B(s.result_url,r,n),R.oR.success("\uD83C\uDF89 Image edited successfully with ".concat(r,"! Check the preview panel and your media library."),{duration:4e3});else throw Error("No result URL received")}catch(t){console.error("Edit failed:",t);let e=t instanceof Error?t.message:"Unknown error";e.includes("Content policy violation")?(R.oR.error("Content policy violation",{description:"Please use appropriate language for image descriptions. Avoid terms that could be flagged as inappropriate.",duration:6e3}),U("Please try a different description")):(U("Edit failed: ".concat(e)),R.oR.error("Edit failed",{description:e,duration:4e3})),j({isProcessing:!1})}},[e,n,r,l,t,w,j,B]),G=(0,i.useCallback)(async()=>{if(a)try{let e=new Date().toISOString().slice(0,19).replace(/[:.]/g,"-"),t="edited-".concat(r,"-").concat(e,".png");await tw(a,t),R.oR.success("Image downloaded!")}catch(e){console.error("Download failed:",e),R.oR.error("Failed to download image")}},[a,r]),V=e&&n.trim()&&!c;return(0,s.jsxs)("div",{className:"h-full flex flex-col p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:()=>L("media"),className:"mr-2 bg-transparent hover:bg-primary hover:text-primary-foreground transition-colors","aria-label":"Back to media",children:(0,s.jsx)(tn.A,{className:"size-4"})}),(0,s.jsx)(x.A,{className:"size-5 text-primary"}),(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Image Adjustment"}),d.length>0&&(0,s.jsxs)(ti.E,{variant:"secondary",children:[d.length," edits"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:N,className:"!bg-transparent ".concat(h?"bg-primary/10":""),children:(0,s.jsx)(tl.A,{className:"size-4"})}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:E,disabled:0===d.length,className:g?"bg-primary/10":"",children:(0,s.jsx)(eq.A,{className:"size-4"})}),a&&(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:G,children:(0,s.jsx)(eF.A,{className:"size-4"})})]})]}),O&&(0,s.jsx)(eM.Zp,{className:"border-destructive",children:(0,s.jsx)(eM.Wu,{className:"p-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,s.jsx)(to.A,{className:"size-4"}),(0,s.jsx)("span",{className:"text-sm",children:O})]})})}),c&&(0,s.jsx)(eM.Zp,{className:"border-blue-500",children:(0,s.jsxs)(eM.Wu,{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[(0,s.jsx)(z.A,{className:"size-4 animate-spin"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:u})]}),(0,s.jsxs)("div",{className:"text-xs text-blue-600",children:[Math.floor(p/60),":",String(p%60).padStart(2,"0")]})]}),m>0&&(0,s.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-blue-600",children:[(0,s.jsx)("span",{children:"Progress"}),(0,s.jsxs)("span",{children:[m,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-blue-100 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(m,"%")}})})]})]})}),(0,s.jsx)("div",{className:"flex-1 flex flex-col min-h-0",children:(0,s.jsxs)("div",{className:"flex-1 space-y-3 overflow-y-auto pr-2 pb-4",style:{scrollbarWidth:"thin"},children:[e?(0,s.jsx)(eM.Zp,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20",children:(0,s.jsx)(eM.Wu,{className:"p-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(td.A,{className:"size-4 text-green-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-xs font-semibold text-green-800 dark:text-green-200",children:"Image loaded"}),(0,s.jsx)("div",{className:"text-[10px] text-green-600 dark:text-green-400 font-medium",children:tj(e.size)})]})]}),(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:b,className:"border-green-300 hover:bg-green-100 dark:border-green-700 dark:hover:bg-green-900/20 text-xs h-6",children:"Remove"})]})})}):(0,s.jsx)(tL,{onImageSelect:H,uploading:F}),e&&(0,s.jsx)(eM.Zp,{className:"bg-gradient-to-r from-primary/5 to-blue-500/5 border-primary/20",children:(0,s.jsxs)(eM.Wu,{className:"p-3 space-y-2",children:[(0,s.jsx)(I.$,{onClick:W,disabled:!V,className:"w-full h-10 font-semibold text-sm transition-all duration-200 hover:scale-[1.01] shadow-sm",size:"default",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.A,{className:"mr-2 size-4 animate-spin"}),"Processing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{className:"mr-2 size-4"}),"Generate Edit"]})}),d.length>0&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(I.$,{variant:"outline",onClick:k,disabled:!C(),className:"flex-1 h-8 text-xs",size:"sm",children:[(0,s.jsx)(tc.A,{className:"size-3 mr-1"}),"Undo"]}),(0,s.jsxs)(I.$,{variant:"outline",onClick:M,disabled:!T(),className:"flex-1 h-8 text-xs",size:"sm",children:[(0,s.jsx)(tm.A,{className:"size-3 mr-1"}),"Redo"]})]})]})}),e&&(0,s.jsx)(tN,{}),e&&(0,s.jsx)(eM.Zp,{children:(0,s.jsxs)(eM.Wu,{className:"p-3 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Edit Instructions"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("textarea",{value:n,onChange:e=>y(e.target.value),placeholder:"Describe what you want to change...",className:"w-full p-2.5 text-sm border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200",rows:3,maxLength:700}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-[10px] text-muted-foreground font-medium",children:"Be specific about changes"}),(0,s.jsxs)("span",{className:(0,o.cn)("text-[10px] font-medium transition-colors",n.length>650?"text-orange-500":n.length>600?"text-yellow-500":"text-muted-foreground"),children:[n.length,"/700"]})]})]})]})}),e&&(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(tk,{})}),e&&h&&(0,s.jsx)(tT,{}),!e&&(0,s.jsx)(eM.Zp,{className:"h-64 flex items-center justify-center",children:(0,s.jsxs)(eM.Wu,{className:"text-center",children:[(0,s.jsx)(x.A,{className:"size-12 text-muted-foreground mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No Image Selected"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Upload an image to start editing with AI models"})]})})]})}),g&&(0,s.jsx)("div",{className:"fixed right-4 top-4 bottom-4 w-80 z-50",children:(0,s.jsx)(tP,{})})]})}function tF(){let{activeTab:e}=S();U.w.log("MediaPanel","RENDER",{activeTab:e,timestamp:Date.now(),aiViewWillRender:"ai"===e});let t={media:(0,s.jsx)(eC,{}),audio:(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"Audio view coming soon..."}),text:(0,s.jsx)(eT,{}),text2image:(0,s.jsx)(e$,{}),stickers:(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"Stickers view coming soon..."}),effects:(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"Effects view coming soon..."}),transitions:(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"Transitions view coming soon..."}),captions:(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"Captions view coming soon..."}),filters:(0,s.jsx)("div",{className:"p-4 text-muted-foreground",children:"Filters view coming soon..."}),adjustment:(0,s.jsx)(tz,{}),ai:(0,s.jsx)(ts,{})};return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-panel rounded-xl overflow-hidden pt-4","data-testid":"media-panel",children:[(0,s.jsx)(M,{}),(0,s.jsx)("div",{className:"flex-1 pt-6 px-4",children:t[e]})]})}function t_(e){let{className:t=""}=e,{activeTab:a}=S(),{setToolsPanel:r,setAiPanelWidth:i,aiPanelWidth:n,aiPanelMinWidth:l,aiPanelMaxWidth:o}=k();return(0,s.jsx)(m,{withHandle:!0,className:"".concat("ai"===a?"ai-resize-handle":""," ").concat(t),onDoubleClick:()=>{if("ai"!==a)return;let e=n<=l+2?22:l;r(e),i(e)}})}var tO=a(1559),tU=a(693);function tB(){let{canvasSize:e,canvasMode:t,canvasPresets:a}=(0,tO.U)(),{mediaItems:r}=(0,P.useMediaStore)(),{tracks:s}=(0,tU.A)(),i=a.find(t=>t.width===e.width&&t.height===e.height),n=()=>e.width/e.height,l=e=>{for(let{ratio:t,label:a}of[{ratio:16/9,label:"16:9"},{ratio:9/16,label:"9:16"},{ratio:1,label:"1:1"},{ratio:4/3,label:"4:3"},{ratio:3/4,label:"3:4"},{ratio:21/9,label:"21:9"}])if(.01>Math.abs(e-t))return a;return e.toFixed(2)};return{currentPreset:i,canvasMode:t,isOriginal:"original"===t,getCurrentAspectRatio:n,getOriginalAspectRatio:()=>{for(let e of s)for(let t of e.elements)if("media"===t.type){let e=r.find(e=>e.id===t.mediaId);if(e&&("video"===e.type||"image"===e.type))return(0,P.getMediaAspectRatio)(e)}return 16/9},formatAspectRatio:l,getDisplayName:()=>"original"===t?"Original":i?i.name:l(n()),canvasSize:e,canvasPresets:a}}function tH(e){let{element:t}=e;return(0,s.jsx)("div",{className:"space-y-4 p-5",children:"Audio properties"})}function tW(e){let{element:t}=e;return(0,s.jsx)("div",{className:"space-y-4 p-5",children:"Media properties"})}let tG=[{value:"Arial",label:"Arial",category:"system",hasClassName:!1},{value:"Helvetica",label:"Helvetica",category:"system",hasClassName:!1},{value:"Times New Roman",label:"Times New Roman",category:"system",hasClassName:!1},{value:"Georgia",label:"Georgia",category:"system",hasClassName:!1},{value:"Inter",label:"Inter",category:"google",weights:[400,700],hasClassName:!0},{value:"Roboto",label:"Roboto",category:"google",weights:[400,700],hasClassName:!0},{value:"Open Sans",label:"Open Sans",category:"google",hasClassName:!0},{value:"Playfair Display",label:"Playfair Display",category:"google",hasClassName:!0},{value:"Comic Neue",label:"Comic Neue",category:"google",hasClassName:!1}];function tV(e){let{defaultValue:t,onValueChange:a,className:r}=e;return(0,s.jsxs)(ea,{defaultValue:t,onValueChange:a,children:[(0,s.jsx)(ei,{className:"w-full text-xs ".concat(r||""),children:(0,s.jsx)(er,{placeholder:"Select a font"})}),(0,s.jsx)(eo,{children:tG.map(e=>(0,s.jsx)(ed,{value:e.value,className:"text-xs",style:{fontFamily:e.value},children:e.label},e.value))})]})}function t$(e){let{direction:t="row",children:a,className:r}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex gap-2","row"===t?"items-center justify-between gap-6":"flex-col gap-1",r),children:a})}function tq(e){let{children:t,className:a}=e;return(0,s.jsx)("label",{className:(0,o.cn)("text-xs",a),children:t})}function tX(e){let{children:t,className:a}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex-1",a),children:t})}function tJ(e){let{element:t,trackId:a}=e,{updateTextElement:r}=(0,tU.A)();return(0,s.jsxs)("div",{className:"space-y-6 p-5",children:[(0,s.jsx)(eI,{placeholder:"Name",defaultValue:t.content,className:"min-h-[4.5rem] resize-none bg-background/50",onChange:e=>r(a,t.id,{content:e.target.value})}),(0,s.jsxs)(t$,{direction:"row",children:[(0,s.jsx)(tq,{children:"Font"}),(0,s.jsx)(tX,{children:(0,s.jsx)(tV,{defaultValue:t.fontFamily,onValueChange:e=>r(a,t.id,{fontFamily:e})})})]}),(0,s.jsxs)(t$,{direction:"column",children:[(0,s.jsx)(tq,{children:"Font size"}),(0,s.jsx)(tX,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(tS,{defaultValue:[t.fontSize],min:8,max:300,step:1,onValueChange:e=>{let[s]=e;return r(a,t.id,{fontSize:s})},className:"w-full"}),(0,s.jsx)(Y.p,{type:"number",value:t.fontSize,onChange:e=>r(a,t.id,{fontSize:parseInt(e.target.value)}),className:"w-12 !text-xs h-7 rounded-sm text-center   [appearance:textfield]   [&::-webkit-outer-spin-button]:appearance-none   [&::-webkit-inner-spin-button]:appearance-none"})]})})]})]})}var tK=a(8622);function tZ(){let{activeProject:e,updateProjectFps:t}=(0,eh.I)(),{getDisplayName:a,canvasSize:r}=tB(),{selectedElements:i,tracks:n}=(0,tU.A)(),{mediaItems:l}=(0,P.useMediaStore)(),o=(0,s.jsx)("div",{className:"space-y-6 p-6 pt-8 bg-gray-800/50 rounded-lg",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"h-5"}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(ek.J,{className:"text-xs text-muted-foreground ml-[5px]",children:"Name:"}),(0,s.jsx)("span",{className:"text-xs text-right mr-[5px]",children:(null==e?void 0:e.name)||""})]}),(0,s.jsx)(tY,{label:"Aspect ratio:",value:a()}),(0,s.jsx)(tY,{label:"Resolution:",value:"".concat(r.width," \xd7 ").concat(r.height)}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(ek.J,{className:"text-xs text-muted-foreground ml-[5px]",children:"Frame rate:"}),(0,s.jsxs)(ea,{value:((null==e?void 0:e.fps)||30).toString(),onValueChange:e=>{let a=parseFloat(e);!isNaN(a)&&a>0&&t(a)},children:[(0,s.jsx)(ei,{className:"w-32 h-6 text-xs !border-transparent mr-[5px]",children:(0,s.jsx)(er,{})}),(0,s.jsx)(eo,{children:tK.FPS_PRESETS.map(e=>{let{value:t,label:a}=e;return(0,s.jsx)(ed,{value:t,className:"text-xs",children:a},t)})})]})]})]})});return(0,s.jsx)(tM,{className:"h-full bg-panel rounded-xl",style:{borderTop:"2px solid #ff6b6b",borderRight:"2px solid #4ecdc4",borderBottom:"2px solid #45b7d1",borderLeft:"2px solid #96ceb4"},children:i.length>0?i.map(e=>{let{trackId:t,elementId:a}=e,r=n.find(e=>e.id===t),i=null==r?void 0:r.elements.find(e=>e.id===a);if((null==i?void 0:i.type)==="text")return(0,s.jsx)("div",{className:"p-6 pt-8 bg-gray-800/50 rounded-lg",children:(0,s.jsx)(tJ,{element:i,trackId:t})},a);if((null==i?void 0:i.type)==="media"){let e=l.find(e=>e.id===i.mediaId);return(null==e?void 0:e.type)==="audio"?(0,s.jsx)("div",{className:"p-6 pt-8 bg-gray-800/50 rounded-lg",children:(0,s.jsx)(tH,{element:i})},a):(0,s.jsx)("div",{className:"p-6 pt-8 bg-gray-800/50 rounded-lg",children:(0,s.jsx)(tW,{element:i})},a)}return null}):o})}function tY(e){let{label:t,value:a}=e;return(0,s.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,s.jsx)(ek.J,{className:"text-xs text-muted-foreground ml-[5px]",children:t}),(0,s.jsx)("span",{className:"text-xs text-right mr-[5px]",children:a})]})}var tQ=a(1612),t0=a(8077),t1=a(8368),t2=a(2543),t5=a(6615),t4=a(9095),t3=a(7566),t6=a(2730),t8=a(7627),t7=a(2012),t9=a(7717);let ae=e=>{let{audioUrl:t,height:a=32,className:r=""}=e,n=(0,i.useRef)(null),l=(0,i.useRef)(null),[o,d]=(0,i.useState)(!0),[c,m]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{let e=!0;return(async()=>{if(n.current&&t)try{if(l.current){try{l.current.destroy()}catch(e){}l.current=null}l.current=t9.A.create({container:n.current,waveColor:"rgba(255, 255, 255, 0.6)",progressColor:"rgba(255, 255, 255, 0.9)",cursorColor:"transparent",barWidth:2,barGap:1,height:a,normalize:!0,interact:!1}),l.current.on("ready",()=>{e&&(d(!1),m(!1))}),l.current.on("error",t=>{console.error("WaveSurfer error:",t),e&&(m(!0),d(!1))}),await l.current.load(t)}catch(t){console.error("Failed to initialize WaveSurfer:",t),e&&(m(!0),d(!1))}})(),()=>{if(e=!1,l.current){try{l.current.destroy()}catch(e){}l.current=null}}},[t,a]),c)?(0,s.jsx)("div",{className:"flex items-center justify-center ".concat(r),style:{height:a},children:(0,s.jsx)("span",{className:"text-xs text-foreground/60",children:"Audio unavailable"})}):(0,s.jsxs)("div",{className:"relative ".concat(r),children:[o&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-xs text-foreground/60",children:"Loading..."})}),(0,s.jsx)("div",{ref:n,className:"w-full transition-opacity duration-200 ".concat(o?"opacity-0":"opacity-100"),style:{height:a}})]})};function at(e){var t;let{element:a,track:r,zoomLevel:n,isSelected:l,onElementMouseDown:o,onElementClick:d,isSnapping:c=!1,onSnapChange:m=()=>{},...u}=e,{mediaItems:p}=(0,P.useMediaStore)(),{updateElementTrim:h,updateElementDuration:g,removeElementFromTrack:f,dragState:x,splitElement:v,splitAndKeepLeft:b,splitAndKeepRight:y,separateAudio:w,addElementToTrack:j,replaceElementMedia:N}=(0,tU.A)(),{currentTime:E}=(0,t8.E)(),[S,C]=(0,i.useState)(!1),T=(0,i.useRef)(null),{resizing:k,isResizing:I,handleResizeStart:M,handleResizeMove:A,handleResizeEnd:D}=function(e){let{element:t,track:a,zoomLevel:r,onUpdateTrim:s,onUpdateDuration:n}=e,[l,o]=(0,i.useState)(null),{mediaItems:d}=(0,P.useMediaStore)();(0,i.useEffect)(()=>{if(!l)return;let e=e=>{m({clientX:e.clientX})},t=()=>{u()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[l]);let c=()=>{if("text"===t.type)return!0;if("media"===t.type){let e=d.find(e=>e.id===t.mediaId);if(!e)return!1;if("image"===e.type)return!0}return!1},m=e=>{if(!l)return;let i=(e.clientX-l.startX)/(50*r);if("left"===l.side){let e=Math.max(0,Math.min(t.duration-l.initialTrimEnd-.1,l.initialTrimStart+i));s(a.id,t.id,e,l.initialTrimEnd)}else{let e=l.initialTrimEnd-i;if(e<0)if(c()){let r=Math.abs(e),i=t.duration+r;n(a.id,t.id,i),s(a.id,t.id,l.initialTrimStart,0)}else s(a.id,t.id,l.initialTrimStart,0);else{let r=Math.max(0,Math.min(t.duration-l.initialTrimStart-.1,e));s(a.id,t.id,l.initialTrimStart,r)}}},u=()=>{o(null)};return{resizing:l,isResizing:null!==l,handleResizeStart:(e,a,r)=>{e.stopPropagation(),e.preventDefault(),o({elementId:a,side:r,startX:e.clientX,initialTrimStart:t.trimStart,initialTrimEnd:t.trimEnd})},handleResizeMove:()=>{},handleResizeEnd:()=>{}}}({element:a,track:r,zoomLevel:n,onUpdateTrim:h,onUpdateDuration:g}),L="media"===a.type?p.find(e=>e.id===a.mediaId):null,z=function(e){let{element:t,mediaItem:a,elementRef:r}=e,[s,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(null),[d,c]=(0,i.useState)(0),m=(null==a?void 0:a.type)==="video",u=(0,i.useCallback)(e=>{if(!r.current)return 0;let a=r.current.getBoundingClientRect(),s=Math.max(0,Math.min(1,(e-a.left)/a.width)),i=t.trimStart||0,n=t.trimEnd||0,l=t.duration-i-n;return i+s*l},[t,r]),p=(0,i.useCallback)(()=>{m&&n(!0)},[m]),h=(0,i.useCallback)(()=>{m&&(n(!1),o(null),c(0))},[m]),g=(0,i.useCallback)(e=>{m&&s&&(c(u(e.clientX)),o({x:e.clientX,y:e.clientY}))},[m,s,u]);return{isHovered:!!m&&s,mousePosition:m?l:null,previewTimestamp:m?d:0,handlers:m?{onMouseEnter:p,onMouseLeave:h,onMouseMove:g}:{},utils:{calculateTimestamp:u,getRelativePosition:(0,i.useCallback)(e=>{if(!r.current)return 0;let t=r.current.getBoundingClientRect();return Math.max(0,Math.min(1,(e-t.left)/t.width))},[r])}}}({element:a,mediaItem:L||{type:"image"},elementRef:T}),F=a.duration-a.trimStart-a.trimEnd,_=(()=>{if("media"===a.type&&a.mediaId){let e=p.find(e=>e.id===a.mediaId);if(e&&e.duration){let t=e.duration,r=a.duration,s=a.trimStart+a.trimEnd>.5,i=Math.abs(t-r)>.5;return{hasAnyMismatch:s||i,hasTrimming:s,hasSignificantMismatch:i,sourceDuration:t,elementDuration:r,missingDuration:t-r}}}return null})(),O=Math.max(tK.TIMELINE_CONSTANTS.ELEMENT_MIN_WIDTH,F*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*n),U=x.elementId===a.id,B=120+(U&&x.isDragging?x.currentTime:a.startTime)*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*n;return(0,s.jsxs)($,{children:[(0,s.jsx)(q,{asChild:!0,children:(0,s.jsx)("div",{className:"absolute top-0 h-full select-none timeline-element ".concat(U?"z-50":"z-10"," ").concat("isSnapping"in u&&c?"ring-2 ring-accent shadow-lg shadow-accent/50 animate-pulse":""),"data-testid":"timeline-element",style:{left:"".concat(B,"px"),width:"".concat(O,"px")},"data-element-id":a.id,"data-track-id":r.id,onMouseMove:k?A:void 0,onMouseUp:k?D:void 0,onMouseLeave:k?D:void 0,children:(0,s.jsxs)("div",{ref:T,className:"relative h-full rounded-[0.15rem] cursor-pointer overflow-hidden ".concat("media"===a.type&&(null==(t=p.find(e=>e.id===a.mediaId))?void 0:t.type)==="video"?"bg-black border-white/80":(0,tK.getTrackElementClasses)(r.type)," border border-white/20 ").concat(l?"border-foreground":""," ").concat(U?"z-50":"z-10"),onClick:e=>d&&d(e,a),onMouseDown:e=>{console.log("\uD83C\uDFAF ELEMENT: handleElementMouseDown called for:",a.name,{hasOnElementMouseDown:!!o,elementId:a.id,button:e.button}),e.stopPropagation(),o&&o(e,a)},onContextMenu:e=>o&&o(e,a),...z.handlers,children:[(()=>{if("text"===a.type)return(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-start pl-2",children:(0,s.jsx)("span",{className:"text-xs text-foreground/80 truncate",children:a.content})});let e=p.find(e=>e.id===a.mediaId);return e?"image"===e.type?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)("div",{className:"bg-[#004D52] py-3 w-full h-full",children:(0,s.jsx)("img",{src:e.url,alt:e.name,className:"w-full h-full object-cover",draggable:!1})})}):"video"===e.type?(0,s.jsx)("div",{className:"w-full h-full relative rounded shadow-lg",style:{backgroundColor:l?"#facc15":"",backgroundImage:l?"none":"linear-gradient(to right, rgb(147 51 234), rgb(37 99 235), rgb(67 56 202))",border:l?"4px solid #eab308":"2px solid rgb(168 85 247)"},children:(0,s.jsx)("div",{className:"absolute inset-0 flex items-center px-2",style:{backgroundColor:l?"rgba(250, 204, 21, 0.9)":"",backgroundImage:l?"none":"linear-gradient(to right, rgba(147, 51, 234, 0.8), rgba(37, 99, 235, 0.8), rgba(67, 56, 202, 0.8))"},children:(0,s.jsxs)("span",{className:"text-sm font-bold truncate drop-shadow-md",style:{color:l?"#000000":"#ffffff"},children:["\uD83C\uDFAC ",a.name]})})}):"audio"===e.type?(0,s.jsx)("div",{className:"w-full h-full flex items-center gap-2",children:(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)(ae,{audioUrl:e.url||"",height:24,className:"w-full"})})}):(0,s.jsx)("span",{className:"text-xs text-foreground/80 truncate",children:a.name}):(0,s.jsx)("span",{className:"text-xs text-foreground/80 truncate",children:a.name})})(),(null==_?void 0:_.hasAnyMismatch)&&(0,s.jsx)("div",{className:"absolute top-0 right-0 w-0 h-0 border-l-[8px] border-l-transparent border-b-[8px] border-b-yellow-500",title:_.hasTrimming?"Trimmed: ".concat((a.trimStart+a.trimEnd).toFixed(1),"s removed"):"Duration mismatch: ".concat(_.missingDuration.toFixed(1),"s shorter than source")}),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-w-resize bg-foreground z-50",onMouseDown:e=>M(e,a.id,"left")}),(0,s.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-e-resize bg-foreground z-50",onMouseDown:e=>M(e,a.id,"right")})]})]})})}),(0,s.jsxs)(J,{children:[(0,s.jsxs)(K,{onClick:()=>{let e=a.startTime,t=a.startTime+(a.duration-a.trimStart-a.trimEnd);E>e&&E<t?v(r.id,a.id,E)||R.oR.error("Failed to split element"):R.oR.error("Playhead must be within element to split")},children:[(0,s.jsx)(t0.A,{className:"h-4 w-4 mr-2"}),"Split at playhead"]}),(0,s.jsxs)(K,{onClick:()=>{let{id:e,...t}=a;j(r.id,{...t,name:a.name+" (copy)",startTime:a.startTime+(a.duration-a.trimStart-a.trimEnd)+.1})},children:[(0,s.jsx)(t4.A,{className:"h-4 w-4 mr-2"}),"Duplicate ","text"===a.type?"text":"clip"]}),(0,s.jsxs)(K,{onClick:()=>{let{currentTime:e}=t8.E.getState(),{updateElementStartTime:t}=tU.A.getState();t(r.id,a.id,e),R.oR.success("Snapped to playhead")},children:[(0,s.jsx)(t7.A,{className:"h-4 w-4 mr-2"}),"Snap to Playhead"]}),"media"===a.type&&(0,s.jsxs)(K,{onClick:()=>{if("media"!==a.type)return void R.oR.error("Replace is only available for media clips");let e=document.createElement("input");e.type="file",e.accept="video/*,audio/*,image/*",e.onchange=async e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s)try{await N(r.id,a.id,s)?R.oR.success("Clip replaced successfully"):R.oR.error("Failed to replace clip")}catch(e){R.oR.error("Failed to replace clip"),console.log(JSON.stringify({error:"Failed to replace clip",details:e}))}},e.click()},children:[(0,s.jsx)(ez.A,{className:"h-4 w-4 mr-2"}),"Replace clip"]}),(0,s.jsx)(Z,{}),(0,s.jsxs)(K,{onClick:()=>{f(r.id,a.id)},className:"text-destructive focus:text-destructive",children:[(0,s.jsx)(tt.A,{className:"h-4 w-4 mr-2"}),"Delete ","text"===a.type?"text":"clip"]})]})]})}var aa=a(6202);function ar(e){let{tracks:t,zoomLevel:a,enabled:r=!1,onSnapPointChange:s}=e,{activeProject:n}=(0,eh.I)(),l=(null==n?void 0:n.fps)||30;if(!r)return{getSnapTime:e=>({snappedTime:(0,tK.snapTimeToFrame)(e,l),didSnap:!1}),snapPoints:[],activeSnapPoint:null,clearSnapPoints:()=>{},getSnapPositions:()=>[],isSnapping:!1};let[o,d]=(0,i.useState)(null),c=(0,i.useMemo)(()=>{let e=[];if(!r)return e;try{t.forEach(t=>{t.elements.forEach(a=>{e.push({position:a.startTime,type:"element-start",strength:.8,elementId:a.id,trackId:t.id});let r=a.startTime+a.duration-a.trimStart-a.trimEnd;e.push({position:r,type:"element-end",strength:.8,elementId:a.id,trackId:t.id})})})}catch(e){return console.warn("Snapping: Error generating snap points",e),[]}return e},[t,r]),m=(0,i.useCallback)(e=>{try{if(!r||0===c.length)return{snappedTime:(0,tK.snapTimeToFrame)(e,l),didSnap:!1};let t=null,i=1/0;if(c.forEach(r=>{let s=Math.abs(r.position-e);s*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a<10&&s<i&&(i=s,t=r)}),null!==t){let e=t;return d(e),null==s||s(e),{snappedTime:e.position,snapPoint:e,didSnap:!0}}return{snappedTime:(0,tK.snapTimeToFrame)(e,l),didSnap:!1}}catch(t){return console.warn("Snapping: Error in getSnapTime",t),{snappedTime:(0,tK.snapTimeToFrame)(e,l),didSnap:!1}}},[c,r,a,l,s]),u=(0,i.useCallback)(()=>{try{d(null),null==s||s(null)}catch(e){console.warn("Snapping: Error clearing snap points",e)}},[s]),p=(0,i.useCallback)(()=>{if(!r)return[];try{return c.map(e=>e.position)}catch(e){return console.warn("Snapping: Error getting snap positions",e),[]}},[c,r]);return{getSnapTime:m,snapPoints:c,activeSnapPoint:o,clearSnapPoints:u,getSnapPositions:p,isSnapping:r&&null!==o,isEnabled:r}}function as(e){let{track:t,zoomLevel:a,onSnapPointChange:r,isSnappingEnabled:n=!1}=e,l=n&&"function"==typeof r,{mediaItems:o}=(0,P.useMediaStore)(),{tracks:d,moveElementToTrack:c,updateElementStartTime:m,addElementToTrack:u,selectedElements:p,selectElement:h,dragState:g,startDrag:f,updateDragTime:x,endDrag:v,clearSelectedElements:b,insertTrackAt:y}=(0,tU.A)(),w=l?ar({tracks:d,zoomLevel:a,enabled:n,onSnapPointChange:r}):null,j=(0,i.useRef)(null),[N,E]=(0,i.useState)(!1),[S,C]=(0,i.useState)(null),[T,k]=(0,i.useState)(!1),I=(0,i.useRef)(0),[M,A]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(!g.isDragging)return;let e=e=>{var t;if(!j.current)return;g.elementId&&g.trackId&&(p.some(e=>e.trackId===g.trackId&&e.elementId===g.elementId)||h(g.trackId,g.elementId,!1));let r=j.current.getBoundingClientRect(),s=Math.max(0,Math.max(0,(e.clientX-r.left)/(tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a))-g.clickOffsetTime),i=(null==(t=eh.I.getState().activeProject)?void 0:t.fps)||30;x(l&&w?w.getSnapTime(s).snappedTime:(0,tK.snapTimeToFrame)(s,i))},r=e=>{var a;if(!g.elementId||!g.trackId)return;let r=g.trackId===t.id,s=null==(a=j.current)?void 0:a.getBoundingClientRect();if(!s){r&&(m(t.id,g.elementId,g.currentTime),v());return}let i=e.clientY>=s.top&&e.clientY<=s.bottom;if(!i&&!r)return;let n=g.currentTime;if(i){let e=d.find(e=>e.id===g.trackId),a=null==e?void 0:e.elements.find(e=>e.id===g.elementId);if(a){let e=n+(a.duration-a.trimStart-a.trimEnd),r=d.find(e=>e.id===t.id);(null==r?void 0:r.elements.some(a=>{if(g.trackId===t.id&&a.id===g.elementId)return!1;let r=a.startTime;return n<a.startTime+(a.duration-a.trimStart-a.trimEnd)-.001&&e>r+.001}))||(g.trackId===t.id?m(t.id,g.elementId,n):(c(g.trackId,t.id,g.elementId),requestAnimationFrame(()=>{m(t.id,g.elementId,n)})))}}else if(r){let e=d.find(e=>e.id===g.trackId),a=null==e?void 0:e.elements.find(e=>e.id===g.elementId);if(a){let e=n+(a.duration-a.trimStart-a.trimEnd);t.elements.some(t=>{if(t.id===g.elementId)return!1;let a=t.startTime;return n<t.startTime+(t.duration-t.trimStart-t.trimEnd)-.001&&e>a+.001})||m(t.id,g.elementId,n)}}r&&v()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",r),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r)}},[g.isDragging,g.clickOffsetTime,g.elementId,g.trackId,g.currentTime,a,d,t.id,x,m,c,v,p,h]);let D=(e,r)=>{A({x:e.clientX,y:e.clientY});let s=2===e.button,i=e.metaKey||e.ctrlKey||e.shiftKey;if(s){p.some(e=>e.trackId===t.id&&e.elementId===r.id)||h(t.id,r.id,i);return}i&&h(t.id,r.id,!0);let n=e.currentTarget.getBoundingClientRect(),l=(e.clientX-n.left)/(tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a);console.log("\uD83D\uDDB1️ DRAG DEBUG: Starting drag action for element:",{elementId:r.id,trackId:t.id,elementName:r.name,startTime:r.startTime,clickX:e.clientX,clickOffsetTime:l}),f(r.id,t.id,e.clientX,r.startTime,l)},L=(e,a)=>{if(e.stopPropagation(),M){let t=Math.abs(e.clientX-M.x),a=Math.abs(e.clientY-M.y);if(t>5||a>5)return void A(null)}e.metaKey||e.ctrlKey||e.shiftKey||p.some(e=>e.trackId===t.id&&e.elementId===a.id)||h(t.id,a.id,!1)};return(0,s.jsx)("div",{className:"w-full h-full hover:bg-muted/20",onClick:e=>{e.target.closest(".timeline-element")||b()},onDragOver:e=>{var r,s,i,n,c;e.preventDefault();let m=e.dataTransfer.types.includes("application/x-timeline-element"),u=e.dataTransfer.types.includes("application/x-media-item");if(!m&&!u)return;let p=e.currentTarget.querySelector(".track-elements-container"),h=0;if(p){let t=p.getBoundingClientRect();h=Math.max(0,e.clientX-t.left)/(tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a)}let g=!1;if(u)try{let a=e.dataTransfer.getData("application/x-media-item");if(a){let e=JSON.parse(a);if("text"===e.type){let e=(null==(s=eh.I.getState().activeProject)?void 0:s.fps)||30,a=l&&w?w.getSnapTime(h).snappedTime:(0,tK.snapTimeToFrame)(h,e),r=a+5;g=t.elements.some(e=>{let t=e.startTime,s=e.startTime+(e.duration-e.trimStart-e.trimEnd);return a<s-.001&&r>t+.001})}else{let a=o.find(t=>t.id===e.id);if(a){let e=a.duration||5,r=(null==(i=eh.I.getState().activeProject)?void 0:i.fps)||30,s=(0,tK.snapTimeToFrame)(h,r),n=s+e;g=t.elements.some(e=>{let t=e.startTime,a=e.startTime+(e.duration-e.trimStart-e.trimEnd);return s<a-.001&&n>t+.001})}}}}catch(e){}else if(m)try{let a=e.dataTransfer.getData("application/x-timeline-element");if(a){let{elementId:e,trackId:r}=JSON.parse(a),s=d.find(e=>e.id===r),i=null==s?void 0:s.elements.find(t=>t.id===e);if(i){let a=i.duration-i.trimStart-i.trimEnd,s=(null==(n=eh.I.getState().activeProject)?void 0:n.fps)||30,l=(0,tK.snapTimeToFrame)(h,s),o=l+a;g=t.elements.some(a=>{if(r===t.id&&a.id===e)return!1;let s=a.startTime,i=a.startTime+(a.duration-a.trimStart-a.trimEnd);return l<i-.001&&o>s+.001})}}}catch(e){}if(g){e.dataTransfer.dropEffect="none",k(!0);let t=(null==(c=eh.I.getState().activeProject)?void 0:c.fps)||30;C((0,tK.snapTimeToFrame)(h,t));return}e.dataTransfer.dropEffect=m?"move":"copy",k(!1);let f=(null==(r=eh.I.getState().activeProject)?void 0:r.fps)||30;C((0,tK.snapTimeToFrame)(h,f))},onDragEnter:e=>{e.preventDefault();let t=e.dataTransfer.types.includes("application/x-timeline-element"),a=e.dataTransfer.types.includes("application/x-media-item");(t||a)&&(I.current++,E(!0))},onDragLeave:e=>{e.preventDefault();let t=e.dataTransfer.types.includes("application/x-timeline-element"),a=e.dataTransfer.types.includes("application/x-media-item");(t||a)&&(I.current--,0===I.current&&(E(!1),k(!1),C(null)))},onDrop:e=>{var r;let s;e.preventDefault(),e.stopPropagation(),I.current=0,E(!1),k(!1);let i=e.dataTransfer.types.includes("application/x-timeline-element"),n=e.dataTransfer.types.includes("application/x-media-item");if(!i&&!n)return;let l=e.currentTarget.querySelector(".track-elements-container");if(!l)return;let p=l.getBoundingClientRect(),h=Math.max(0,e.clientX-p.left),g=e.clientY-p.top,f=h/(tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a),x=(null==(r=eh.I.getState().activeProject)?void 0:r.fps)||30,v=(0,tK.snapTimeToFrame)(f,x),b=d.findIndex(e=>e.id===t.id);s=g<20?"above":g>40?"below":"on";try{if(i){let a=e.dataTransfer.getData("application/x-timeline-element");if(!a)return;let{elementId:r,trackId:s,clickOffsetTime:i=0}=JSON.parse(a),n=d.find(e=>e.id===s),l=null==n?void 0:n.elements.find(e=>e.id===r);if(!l)return void R.oR.error("Element not found");let o=Math.max(0,(0,tK.snapTimeToFrame)(v-i,x)),u=l.duration-l.trimStart-l.trimEnd,p=o+u;if(t.elements.some(e=>{if(s===t.id&&e.id===r)return!1;let a=e.startTime,i=e.startTime+(e.duration-e.trimStart-e.trimEnd),n=o<i-.001&&p>a+.001,l=Math.abs(o-i);return console.log("\uD83C\uDFAC VIDEO GAP ANALYSIS:",{video1End:i,video2Start:o,actualGap:l,gapInMs:1e3*l,toleranceMs:1,wouldOverlap:n,elementNames:"".concat(e.name," -> Moving element")}),n}))return void R.oR.error("Cannot move element here - it would overlap with existing elements");s===t.id?m(t.id,r,o):(c(s,t.id,r),requestAnimationFrame(()=>{m(t.id,r,o)}))}else if(n){let a=e.dataTransfer.getData("application/x-media-item");if(!a)return;let r=JSON.parse(a);if("text"===r.type){let e=t.id,a=t;if("text"!==t.type||"on"!==s){let t,r=(0,aa.xK)(d);t="above"===s?b:"below"===s?b+1:r?d.findIndex(e=>e.id===r.id):0,e=y("text",t);let i=tU.A.getState().tracks.find(t=>t.id===e);if(!i)return;a=i}let i=v+5;if(a.elements.some(e=>{let t=e.startTime,a=e.startTime+(e.duration-e.trimStart-e.trimEnd);return v<a-.001&&i>t+.001}))return void R.oR.error("Cannot place element here - it would overlap with existing elements");u(e,{type:"text",name:r.name||"Text",content:r.content||"Default Text",duration:tK.TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,startTime:v,trimStart:0,trimEnd:0,fontSize:48,fontFamily:"Arial",color:"#ffffff",backgroundColor:"transparent",textAlign:"center",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",x:0,y:0,rotation:0,opacity:1})}else{let e=o.find(e=>e.id===r.id);if(!e)return void R.oR.error("Media item not found");let a=t.id,i="video"===r.type||"image"===r.type,n="audio"===r.type,l=i?(0,aa.hX)("media",t.type):!!n&&(0,aa.hX)("media",t.type),c=d.find(e=>e.id===a);if((!l||"on"!==s)&&(!l||"on"!==s)){if(i){let e=(0,aa.xK)(d);if(e)if(0===e.elements.length&&"on"===s)a=e.id,c=e;else{let t=d.findIndex(t=>t.id===e.id);a=y("media","above"===s?b:"below"===s?b+1:t);let r=tU.A.getState().tracks.find(e=>e.id===a);if(!r)return;c=r}else{let e=(0,aa.zb)(d),t=(0,aa.xK)(e);if(t&&0===t.elements.length)a=t.id,c=t;else{let r=e.findIndex(e=>e.id===(null==t?void 0:t.id));a=y("media",r);let s=tU.A.getState().tracks.find(e=>e.id===a);if(!s)return;c=s}}}else if(n){let e,t=(0,aa.xK)(d);e="above"===s?b:"below"===s?b+1:t?d.findIndex(e=>e.id===t.id)+1:d.length,a=y("audio",e);let r=tU.A.getState().tracks.find(e=>e.id===a);if(!r)return;c=r}}if(!c)return;let m=e.duration||5,p=v+m;if(c.elements.some(e=>{let t=e.startTime,a=e.startTime+(e.duration-e.trimStart-e.trimEnd);return v<a-.001&&p>t+.001}))return void R.oR.error("Cannot place element here - it would overlap with existing elements");u(a,{type:"media",mediaId:e.id,name:e.name,duration:e.duration||5,startTime:v,trimStart:0,trimEnd:0})}}}catch(e){console.error("Error handling drop:",e),R.oR.error("Failed to add media to track")}},children:(0,s.jsx)("div",{ref:j,className:"h-full relative track-elements-container min-w-full min-h-[85px]",children:0===t.elements.length?(0,s.jsx)("div",{className:"h-full w-full rounded-sm border-2 border-dashed flex items-center justify-center text-xs text-muted-foreground transition-colors ".concat(N?T?"border-red-500 bg-red-500/10 text-red-600":"border-blue-500 bg-blue-500/10 text-blue-600":"border-muted/30"),children:N?T?"Cannot drop - would overlap":"Drop element here":""}):(0,s.jsx)(s.Fragment,{children:t.elements.map(e=>{let i=p.some(a=>a.trackId===t.id&&a.elementId===e.id);return(0,s.jsx)(at,{element:e,track:t,zoomLevel:a,isSelected:i,onElementMouseDown:D,onElementClick:L,...l?{isSnapping:!1,onSnapChange:e=>{r&&r(null)}}:{}},e.id)})})})})}function ai(e){let{track:t,zoomLevel:a,onSnapPointChange:r,isSnappingEnabled:i=!1,featureFlags:n={}}=e,l=i?ar({tracks:[t],zoomLevel:a,enabled:i,onSnapPointChange:r}):null;return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(as,{track:t,zoomLevel:a}),n.enableSnapVisualization&&l&&l.isEnabled&&(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[l.getSnapPositions().map((e,r)=>{var i;return(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-px transition-all duration-150 ".concat(l.isSnapping&&.01>Math.abs(e-((null==(i=l.activeSnapPoint)?void 0:i.position)||0))?"bg-accent shadow-lg opacity-100":"bg-primary/30 opacity-50"),style:{left:e*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a}},"snap-".concat(t.id,"-").concat(r,"-").concat(e))}),l.activeSnapPoint&&(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent shadow-lg animate-pulse",style:{left:l.activeSnapPoint.position*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*a}})]})]})}function an(e){let{currentTime:t,duration:a,zoomLevel:r,seek:s,rulerRef:n,rulerScrollRef:l,tracksScrollRef:o,playheadRef:d}=e,[c,m]=(0,i.useState)(!1),[u,p]=(0,i.useState)(null),[h,g]=(0,i.useState)(!1),[f,x]=(0,i.useState)(!1),[v,b]=(0,i.useState)({x:0,y:0,visible:!1}),y=c&&null!==u?u:t,w=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),m(!0),N(e)},[a,r]),j=(0,i.useCallback)(e=>{var t;0===e.button&&(null!=d&&null!=(t=d.current)&&t.contains(e.target)||(e.preventDefault(),g(!0),x(!1),m(!0),N(e)))},[a,r]),N=(0,i.useCallback)(e=>{var t;let i=n.current;if(!i)return;let l=i.getBoundingClientRect(),o=Math.max(0,Math.min(a,(e.clientX-l.left)/(tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*r))),d=(null==(t=eh.I.getState().activeProject)?void 0:t.fps)||30,c=(0,tK.snapTimeToFrame)(o,d);p(c),s(c)},[a,r,s,n]);return(0,i.useEffect)(()=>{if(!c)return;let e=e=>{N(e),b({x:e.clientX,y:e.clientY,visible:!0}),h&&x(!0)},t=e=>{m(!1),null!==u&&s(u),p(null),b(e=>({...e,visible:!1})),h&&(g(!1),f||N(e),x(!1))};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[c,u,s,N,h,f]),(0,i.useEffect)(()=>{var e,t;let a=null==(e=l.current)?void 0:e.querySelector("[data-radix-scroll-area-viewport]"),s=null==(t=o.current)?void 0:t.querySelector("[data-radix-scroll-area-viewport]");if(!a||!s)return;let i=y*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*r,n=a.clientWidth,d=Math.max(0,Math.min(a.scrollWidth-n,i-n/2));(i<a.scrollLeft+100||i>a.scrollLeft+n-100)&&(a.scrollLeft=s.scrollLeft=d)},[y,a,r,l,o]),{playheadPosition:y,handlePlayheadMouseDown:w,handleRulerMouseDown:j,isDraggingRuler:h,fakeCursorPosition:v}}let al=()=>(0,s.jsx)("div",{className:"fake-cursor pointer-events-none",style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsxs)("div",{style:{width:"2px",height:"16px",background:"#000",position:"relative"},children:[(0,s.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",width:"0",height:"0",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #000"}}),(0,s.jsx)("div",{style:{position:"absolute",bottom:"-2px",left:"-2px",width:"0",height:"0",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderTop:"4px solid #000"}})]})});function ao(e){var t;let{currentTime:a,duration:r,zoomLevel:n,tracks:l,seek:o,rulerRef:d,rulerScrollRef:c,tracksScrollRef:m,trackLabelsRef:u,timelineRef:p,playheadRef:h}=e,g=(0,i.useRef)(null),f=h||g,{playheadPosition:x,handlePlayheadMouseDown:v,fakeCursorPosition:b}=an({currentTime:a,duration:r,zoomLevel:n,seek:o,rulerRef:d,rulerScrollRef:c,tracksScrollRef:m,playheadRef:f}),y=(null==(t=p.current)?void 0:t.offsetHeight)||400;l.length>0&&(null==u?void 0:u.current)&&u.current.offsetWidth;let w=325+x*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*n;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{ref:f,className:"absolute pointer-events-auto z-[999] select-none",style:{left:"".concat(w,"px"),top:0,height:"".concat(y-8,"px"),width:"8px",cursor:"none"},onMouseDown:v,children:(0,s.jsx)("div",{className:"absolute cursor-col-resize h-full select-none",style:{left:"3px",width:"2px",backgroundColor:"#dc2626",borderLeft:"1px solid #ef4444",boxShadow:"0 0 15px rgba(220, 38, 38, 0.8), inset 0 0 5px rgba(220, 38, 38, 0.5)",userSelect:"none",pointerEvents:"none"}})}),b.visible&&(0,s.jsx)("div",{className:"fake-cursor fixed z-[9999] pointer-events-none",style:{left:"".concat(b.x+tK.TIMELINE_CONSTANTS.CURSOR_OFFSET_PX,"px"),top:"".concat(b.y-10,"px"),transform:"translate(-50%, -50%)"},children:(0,s.jsx)(al,{})})]})}function ad(e){let{isSnappingToPlayhead:t=!1,showTimeDisplay:a=!1,currentTime:r,...i}=e;return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(ao,{...i,currentTime:r}),a&&(0,s.jsx)("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-accent text-accent-foreground text-xs px-2 py-1 rounded-md whitespace-nowrap pointer-events-none shadow-lg transition-all duration-150",style:{left:"".concat(50*r*i.zoomLevel,"px")},children:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let a="number"!=typeof e||isNaN(e)?0:e,r="number"==typeof t&&!isNaN(t)&&t>0?t:30,s=Math.floor(a/3600),i=Math.floor(a%3600/60),n=Math.floor(a%60),l=Math.floor(a%1*r);if(s>0)return"".concat(s,":").concat(i.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),".").concat(l.toString().padStart(2,"0"));return"".concat(i,":").concat(n.toString().padStart(2,"0"),".").concat(l.toString().padStart(2,"0"))}catch(t){return("number"!=typeof e||isNaN(e)?0:e).toFixed(2)+"s"}}(r,30)}),t&&(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-1 bg-accent shadow-lg shadow-accent/50 animate-pulse",style:{left:"".concat(50*r*i.zoomLevel,"px"),transform:"translateX(-2px)"}})})]})}function ac(e){let{isPlaying:t,currentTime:a,duration:r,speed:i,tracks:n,toggle:l,setSpeed:o,addTrack:d,addClipToTrack:c,handleSplitSelected:m,handleDuplicateSelected:u,handleFreezeSelected:p,handleDeleteSelected:h,noWrapper:g=!1}=e,f=(0,s.jsxs)(t6.Bc,{delayDuration:500,children:[(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",onClick:l,className:"mr-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:t?(0,s.jsx)(tQ.A,{className:"h-3 w-3"}):(0,s.jsx)(eJ.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:t?"Pause (Space)":"Play (Space)"})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground font-mono px-2",style:{minWidth:"18ch",textAlign:"center"},children:[(a||0).toFixed(1),"s / ",(r||0).toFixed(1),"s"]}),0===((null==n?void 0:n.length)||0)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:()=>{c(d("media"),{mediaId:"test",name:"Test Clip",duration:5,startTime:0,trimStart:0,trimEnd:0})},className:"text-xs",children:"Add Test Clip"})}),(0,s.jsx)(t6.ZI,{children:"Add a test clip to try playback"})]})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",onClick:m,className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(t0.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Split clip (S)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(t1.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Split and keep left (A)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(t2.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Split and keep right (D)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(t5.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Separate audio (E)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",onClick:u,className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(t4.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Duplicate clip (Ctrl+D)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",onClick:p,className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(t3.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Freeze frame (F)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"icon",onClick:h,className:"mx-2 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(tt.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{children:"Delete clip (Delete)"})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)(ea,{value:i.toFixed(1),onValueChange:e=>o(parseFloat(e)),children:[(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(ei,{className:"w-[90px] h-8",style:{borderColor:"transparent"},children:(0,s.jsx)(er,{placeholder:"1.0x"})})}),(0,s.jsx)(t6.ZI,{children:"Playback Speed"})]}),(0,s.jsxs)(eo,{children:[(0,s.jsx)(ed,{value:"0.5",children:"0.5x"}),(0,s.jsx)(ed,{value:"1.0",children:"1.0x"}),(0,s.jsx)(ed,{value:"1.5",children:"1.5x"}),(0,s.jsx)(ed,{value:"2.0",children:"2.0x"})]})]})})]});return g?f:(0,s.jsx)("div",{className:"border-b flex items-center px-4 py-[8px] gap-4",children:f})}var am=a(8549),au=a(3664),ap=a(4335);function ah(e){let{zoomLevel:t,setZoomLevel:a,selectedTool:r="select",setSelectedTool:i=()=>{},isSnappingEnabled:n=!1,setIsSnappingEnabled:l=()=>{},featureFlags:o={},...d}=e;return o.enableToolSelection||o.enableSnapping?(0,s.jsxs)("div",{className:"border-b flex items-center px-4 py-[8px] gap-4",children:[(0,s.jsx)(ac,{...d,noWrapper:!0}),(o.enableToolSelection||o.enableSnapping)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)("div",{className:"flex items-center gap-2 ml-auto",children:(0,s.jsxs)(t6.Bc,{delayDuration:500,children:[o.enableToolSelection&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-1 mr-2",children:[(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>i("select"),className:"h-8 w-8 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none",color:"select"===r?"#05c7c7":void 0},children:(0,s.jsx)(am.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{side:"bottom",children:(0,s.jsx)("p",{children:"Select Tool (V)"})})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>i("cut"),className:"h-8 w-8 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none",color:"cut"===r?"#05c7c7":void 0},children:(0,s.jsx)(t0.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{side:"bottom",children:(0,s.jsx)("p",{children:"Cut Tool (C)"})})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>i("text"),className:"h-8 w-8 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none",color:"text"===r?"#05c7c7":void 0},children:(0,s.jsx)(f.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{side:"bottom",children:(0,s.jsx)("p",{children:"Text Tool (T)"})})]})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-2"})]}),o.enableSnapping&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>l(!n),className:"h-8 w-8 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",borderColor:"transparent",color:n?"#05c7c7":void 0},children:(0,s.jsx)(t7.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{side:"bottom",children:(0,s.jsx)("p",{children:"Toggle Snapping (S)"})})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-2"})]}),(0,s.jsxs)("div",{className:"flex gap-1 ml-auto",children:[(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>a(Math.max(.1,t-.1)),className:"h-8 w-8 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(au.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{side:"bottom",children:(0,s.jsx)("p",{children:"Zoom Out"})})]}),(0,s.jsxs)("span",{className:"text-sm px-2 py-1 bg-background rounded border min-w-[60px] text-center",style:{border:"none"},children:[Math.round(100*t),"%"]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",variant:"outline",onClick:()=>a(Math.min(5,t+.1)),className:"h-8 w-8 hover:text-[#05c7c7] transition-colors",style:{backgroundColor:"transparent",border:"none"},children:(0,s.jsx)(ap.A,{className:"h-3 w-3"})})}),(0,s.jsx)(t6.ZI,{side:"bottom",children:(0,s.jsx)("p",{children:"Zoom In"})})]})]})]})})]})]}):(0,s.jsx)(ac,{...d})}function ag(e){let{startPos:t,currentPos:a,containerRef:r,isActive:n}=e,l=(0,i.useRef)(null);return((0,i.useEffect)(()=>{if(!n||!t||!a||!r.current)return;let e=r.current.getBoundingClientRect(),s=t.x-e.left,i=t.y-e.top,o=a.x-e.left,d=a.y-e.top,c=Math.min(s,o),m=Math.min(i,d),u=Math.abs(o-s),p=Math.abs(d-i);l.current&&(l.current.style.left="".concat(c,"px"),l.current.style.top="".concat(m,"px"),l.current.style.width="".concat(u,"px"),l.current.style.height="".concat(p,"px"))},[t,a,n,r]),n&&t&&a)?(0,s.jsx)("div",{ref:l,className:"absolute pointer-events-none z-50",style:{backgroundColor:"hsl(var(--foreground) / 0.1)"}}):null}let af=()=>(0,s.jsx)("div",{className:"fake-cursor pointer-events-none",style:{width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsxs)("div",{style:{width:"2px",height:"16px",background:"#000",position:"relative"},children:[(0,s.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",width:"0",height:"0",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #000"}}),(0,s.jsx)("div",{style:{position:"absolute",bottom:"-2px",left:"-2px",width:"0",height:"0",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderTop:"4px solid #000"}})]})});function ax(){var e;let{tracks:t,addTrack:r,addElementToTrack:n,removeElementFromTrack:l,getTotalDuration:o,selectedElements:d,clearSelectedElements:c,setSelectedElements:m,splitElement:u,splitAndKeepLeft:p,splitAndKeepRight:h,toggleTrackMute:g,separateAudio:f,undo:x,redo:v}=(0,tU.A)(),{mediaItems:b,addMediaItem:y}=(0,P.useMediaStore)(),{activeProject:w}=(0,eh.I)(),{currentTime:j,duration:N,seek:E,setDuration:S,isPlaying:C,toggle:T}=(0,t8.E)(),[k,M]=(0,i.useState)(!1),[A,D]=(0,i.useState)(!1),[z,F]=(0,i.useState)(0),_=(0,i.useRef)(0),O=(0,i.useRef)(null),U=(0,i.useRef)(null),[B,H]=(0,i.useState)(!1),[W]=(0,i.useState)({enableSnapping:!0,enableSnapVisualization:!0,enableToolSelection:!0,enableTimeDisplay:!0}),[G,V]=(0,i.useState)("select"),[X,Z]=(0,i.useState)(!1),[Y,Q]=(0,i.useState)(null),[ee,et]=(0,i.useState)(new Map),{zoomLevel:ea,setZoomLevel:er,handleWheel:es}=function(e){let{containerRef:t,isInTimeline:a=!1}=e,[r,s]=(0,i.useState)(1),n=(0,i.useCallback)(e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();let t=e.deltaY>0?-.15:.15;s(e=>Math.max(.1,Math.min(10,e+t)))}},[]);return(0,i.useEffect)(()=>{let e=e=>{var r;a&&(e.ctrlKey||e.metaKey)&&(null==(r=t.current)?void 0:r.contains(e.target))&&e.preventDefault()};return document.addEventListener("wheel",e,{passive:!1}),()=>{document.removeEventListener("wheel",e)}},[a,t]),{zoomLevel:r,setZoomLevel:s,handleWheel:n}}({containerRef:O,isInTimeline:B}),ei=Math.max((N||0)*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*ea,(j+30)*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*ea,(null==(e=O.current)?void 0:e.clientWidth)||1e3),en=(0,i.useRef)(null),el=(0,i.useRef)(null),eo=(0,i.useRef)(null),ed=(0,i.useRef)(null),ec=(0,i.useRef)(null),em=(0,i.useRef)(!1),eu=(0,i.useRef)(0),ep=(0,i.useRef)(0),eg=(0,i.useRef)(0),{handleRulerMouseDown:ef,isDraggingRuler:ex,fakeCursorPosition:ev}=function(e){let{currentTime:t,duration:a,zoomLevel:r,seek:s,rulerRef:i,rulerScrollRef:n,tracksScrollRef:l,playheadRef:o}=e,{handleRulerMouseDown:d,isDraggingRuler:c,fakeCursorPosition:m}=an({currentTime:t,duration:a,zoomLevel:r,seek:s,rulerRef:i,rulerScrollRef:n,tracksScrollRef:l,playheadRef:o});return{handleRulerMouseDown:d,isDraggingRuler:c,fakeCursorPosition:m}}({currentTime:j,duration:N,zoomLevel:ea,seek:E,rulerRef:U,rulerScrollRef:en,tracksScrollRef:el,playheadRef:ed}),eb=(0,i.useRef)(null),{selectionBox:ey,handleMouseDown:ew,isSelecting:ej,justFinishedSelecting:eN}=function(e){let{containerRef:t,playheadRef:a,onSelectionComplete:r,isEnabled:s=!0}=e,[n,l]=(0,i.useState)(null),[o,d]=(0,i.useState)(!1),c=(0,i.useCallback)(e=>{var t;!(!s||e.target.closest(".timeline-element")||(null==a||null==(t=a.current)?void 0:t.contains(e.target))||e.target.closest("[data-track-labels]"))&&(e.target.closest("[data-ruler-area]")||l({startPos:{x:e.clientX,y:e.clientY},currentPos:{x:e.clientX,y:e.clientY},isActive:!1}))},[s,a]),m=(0,i.useCallback)((e,a)=>{if(!t.current)return;let s=t.current,i=s.getBoundingClientRect();e.x,i.left,e.y,i.top,a.x,i.left,a.y,i.top;let n=s.querySelectorAll(".timeline-element"),l=[];n.forEach(t=>{let r=t.getBoundingClientRect(),s={left:r.left,top:r.top,right:r.right,bottom:r.bottom},i={left:e.x,top:e.y,right:a.x,bottom:a.y},n={left:Math.min(i.left,i.right),top:Math.min(i.top,i.bottom),right:Math.max(i.left,i.right),bottom:Math.max(i.top,i.bottom)},o=t.getAttribute("data-element-id"),d=t.getAttribute("data-track-id");!(s.right<n.left||s.left>n.right||s.bottom<n.top||s.top>n.bottom)&&o&&d&&l.push({trackId:d,elementId:o})}),r(l)},[t,r]);return(0,i.useEffect)(()=>{if(!n)return;let e=e=>{let t=Math.abs(e.clientX-n.startPos.x),a=Math.abs(e.clientY-n.startPos.y),r={...n,currentPos:{x:e.clientX,y:e.clientY},isActive:t>5||a>5||n.isActive};l(r),r.isActive&&m(r.startPos,r.currentPos)},t=()=>{(null==n?void 0:n.isActive)&&(d(!0),setTimeout(()=>{d(!1)},50)),l(null)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[n,m]),{selectionBox:n,handleMouseDown:c,isSelecting:(null==n?void 0:n.isActive)||!1,justFinishedSelecting:o}}({containerRef:eb,playheadRef:ed,onSelectionComplete:e=>{m(e)}}),eE=(0,i.useCallback)(e=>{var t,r,s;let i;if(ej||e.target.closest(".timeline-element")||eN||(null==(t=ed.current)?void 0:t.contains(e.target)))return;if(e.target.closest("[data-track-labels]"))return void c();console.log(JSON.stringify({clearingSelectedElements:!0})),c();let n=e.target.closest("[data-ruler-area]"),l=0;if(n){let t=null==(r=en.current)?void 0:r.querySelector("[data-radix-scroll-area-viewport]");if(!t)return;let a=t.getBoundingClientRect();i=e.clientX-a.left,l=t.scrollLeft}else{let t=null==(s=el.current)?void 0:s.querySelector("[data-radix-scroll-area-viewport]");if(!t)return;let a=t.getBoundingClientRect();i=e.clientX-a.left,l=t.scrollLeft}let o=Math.max(0,Math.min(N,(i+l)/(tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*ea))),d=(null==w?void 0:w.fps)||30,{snapTimeToFrame:m}=a(8622);E(m(o,d))},[N,ea,E,en,el,c,ej,eN]);(0,i.useEffect)(()=>{S(Math.max(o(),20))},[t,S,o]),(0,i.useEffect)(()=>{let e=e=>{var t;!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&(B||(null==(t=O.current)?void 0:t.contains(document.activeElement)))&&("Delete"===e.key||"Backspace"===e.key)&&d.length>0&&(d.forEach(e=>{let{trackId:t,elementId:a}=e;l(t,a)}),c())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,l,c,B]),(0,i.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"z"===e.key&&!e.shiftKey&&(e.preventDefault(),x())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[x]),(0,i.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"z"===e.key&&e.shiftKey?(e.preventDefault(),v()):(e.metaKey||e.ctrlKey)&&"y"===e.key&&(e.preventDefault(),v())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[v]);let eS=async e=>{var a,s,i;if(e.preventDefault(),M(!1),_.current=0,e.dataTransfer.types.includes("application/x-timeline-element"))return;let l=e.dataTransfer.getData("application/x-media-item");if(l)try{let a=JSON.parse(l);if("text"===a.type){let e=r("text");n(e,{type:"text",name:a.name||"Text",content:a.content||"Default Text",duration:tK.TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,startTime:0,trimStart:0,trimEnd:0,fontSize:48,fontFamily:"Arial",color:"#ffffff",backgroundColor:"transparent",textAlign:"center",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",x:0,y:0,rotation:0,opacity:1})}else{console.group("\uD83C\uDFAC TIMELINE DROP DEBUG"),console.log("Drop event type:",e.type),console.log("Drag data:",a),console.log("Available media items:",b.map(e=>{var t,a;return{id:e.id,name:e.name,duration:e.duration,thumbnailCount:(null==(t=e.thumbnails)?void 0:t.length)||0,fileValid:!!e.file&&e.file instanceof File,fileSize:null==(a=e.file)?void 0:a.size,processingStage:e.processingStage,processingComplete:e.processingComplete}}));let l=b.find(e=>e.id===a.id);if(console.log("Found media item:",l),l?console.log("Media item detailed state:",{hasThumbnails:((null==(s=l.thumbnails)?void 0:s.length)||0)>0,duration:l.duration,fileType:null==(i=l.file)?void 0:i.type,processingComplete:l.processingComplete,processingStage:l.processingStage,isFileValid:!!l.file&&l.file instanceof File}):(console.error("❌ Media item not found - ID mismatch or item not in store"),console.log("Attempted ID:",a.id),console.log("Available IDs:",b.map(e=>e.id))),console.groupEnd(),!l){console.error("❌ Timeline Drop Failed - Media item not found:",{dragDataId:a.id,availableIds:b.map(e=>e.id),totalItems:b.length}),R.oR.error("Media item not found - try refreshing the media panel");return}if("ai"===l.source){if(!l.processingComplete||"complete"!==l.processingStage){console.log("⏳ AI video still processing:",{id:l.id,stage:l.processingStage,complete:l.processingComplete}),R.oR.error("AI video is still processing - please wait");return}if(!l.thumbnails||0===l.thumbnails.length){console.error("❌ AI video missing thumbnails:",l.id),R.oR.error("Video processing incomplete - thumbnails missing");return}}if(!l.file||!(l.file instanceof File)){console.error("❌ Invalid file reference:",{id:l.id,hasFile:!!l.file,isFileInstance:!!l.file&&l.file instanceof File,fileType:typeof l.file}),R.oR.error("Media file is corrupted - try regenerating the video");return}(!l.duration||l.duration<=0)&&console.warn("⚠️ Missing or invalid duration, using fallback:",{id:l.id,duration:l.duration});let o="audio"===a.type?"audio":"media",d=t.find(e=>e.type===o),c=d?d.id:r(o);n(c,{type:"media",mediaId:l.id,name:l.name,duration:l.duration||5,startTime:0,trimStart:0,trimEnd:0})}}catch(e){console.error("Error parsing dropped item data:",e),R.oR.error("Failed to add item to timeline")}else if((null==(a=e.dataTransfer.files)?void 0:a.length)>0){if(!w)return void R.oR.error("No active project");D(!0),F(0);try{for(let t of(await L(e.dataTransfer.files,e=>F(e)))){await y(w.id,t);let e=P.useMediaStore.getState().mediaItems.find(e=>e.name===t.name&&e.url===t.url);if(e){let a="audio"===t.type?"audio":"media",s=r(a);n(s,{type:"media",mediaId:e.id,name:e.name,duration:e.duration||5,startTime:0,trimStart:0,trimEnd:0})}}}catch(e){console.error("Error processing external files:",e),R.oR.error("Failed to process dropped files")}finally{D(!1),F(0)}}};return(0,i.useEffect)(()=>{var e,t,a;let r=null==(e=en.current)?void 0:e.querySelector("[data-radix-scroll-area-viewport]"),s=null==(t=el.current)?void 0:t.querySelector("[data-radix-scroll-area-viewport]"),i=null==(a=ec.current)?void 0:a.querySelector("[data-radix-scroll-area-viewport]");if(!r||!s)return;let n=()=>{let e=Date.now();em.current||e-eu.current<16||(eu.current=e,em.current=!0,s.scrollLeft=r.scrollLeft,em.current=!1)},l=()=>{let e=Date.now();em.current||e-ep.current<16||(ep.current=e,em.current=!0,r.scrollLeft=s.scrollLeft,em.current=!1)};if(r.addEventListener("scroll",n),s.addEventListener("scroll",l),i){let e=()=>{let e=Date.now();em.current||e-eg.current<16||(eg.current=e,em.current=!0,s.scrollTop=i.scrollTop,em.current=!1)},t=()=>{let e=Date.now();em.current||e-eg.current<16||(eg.current=e,em.current=!0,i.scrollTop=s.scrollTop,em.current=!1)};return i.addEventListener("scroll",e),s.addEventListener("scroll",t),()=>{r.removeEventListener("scroll",n),s.removeEventListener("scroll",l),i.removeEventListener("scroll",e),s.removeEventListener("scroll",t)}}return()=>{r.removeEventListener("scroll",n),s.removeEventListener("scroll",l)}},[]),(0,s.jsxs)("div",{className:"h-full flex flex-col transition-colors duration-200 relative bg-panel rounded-xl overflow-hidden",...{onDragEnter:e=>{e.preventDefault(),!e.dataTransfer.types.includes("application/x-timeline-element")&&(_.current+=1,k||M(!0))},onDragOver:e=>{e.preventDefault()},onDragLeave:e=>{e.preventDefault(),e.dataTransfer.types.includes("application/x-timeline-element")||(_.current-=1,0===_.current&&M(!1))},onDrop:eS},onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),children:[!(W.enableSnapping||W.enableToolSelection)&&(0,s.jsx)("div",{className:"border-b flex items-center px-2 py-1 pb-3 gap-1",children:(0,s.jsxs)(t6.Bc,{delayDuration:500,children:[(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:T,className:"mr-2 transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:C?(0,s.jsx)(tQ.A,{className:"h-4 w-4"}):(0,s.jsx)(eJ.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:C?"Pause (Space)":"Play (Space)"})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground font-mono px-2",style:{minWidth:"18ch",textAlign:"center"},children:[j.toFixed(1),"s / ",N.toFixed(1),"s"]}),0===t.length&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"outline",size:"sm",onClick:()=>{n(r("media"),{type:"media",mediaId:"test",name:"Test Clip",duration:tK.TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,startTime:0,trimStart:0,trimEnd:0})},className:"text-xs",children:"Add Test Clip"})}),(0,s.jsx)(t6.ZI,{children:"Add a test clip to try playback"})]})]}),(0,s.jsx)("div",{className:"w-px h-6 bg-border mx-1"}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{if(0===d.length)return void R.oR.error("No elements selected");let e=0;d.forEach(a=>{let{trackId:r,elementId:s}=a,i=t.find(e=>e.id===r),n=null==i?void 0:i.elements.find(e=>e.id===s);if(n&&i){let t=n.startTime,a=n.startTime+(n.duration-n.trimStart-n.trimEnd);j>t&&j<a&&u(r,s,j)&&e++}}),0===e&&R.oR.error("Playhead must be within selected elements to split")},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(t0.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Split element (Ctrl+S)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{if(1!==d.length)return void R.oR.error("Select exactly one element");let{trackId:e,elementId:a}=d[0],r=t.find(t=>t.id===e),s=null==r?void 0:r.elements.find(e=>e.id===a);if(!s)return;let i=s.startTime,n=s.startTime+(s.duration-s.trimStart-s.trimEnd);if(j<=i||j>=n)return void R.oR.error("Playhead must be within selected element");p(e,a,j)},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(t1.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Split and keep left (Ctrl+Q)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{if(1!==d.length)return void R.oR.error("Select exactly one element");let{trackId:e,elementId:a}=d[0],r=t.find(t=>t.id===e),s=null==r?void 0:r.elements.find(e=>e.id===a);if(!s)return;let i=s.startTime,n=s.startTime+(s.duration-s.trimStart-s.trimEnd);if(j<=i||j>=n)return void R.oR.error("Playhead must be within selected element");h(e,a,j)},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(t2.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Split and keep right (Ctrl+W)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{if(1!==d.length)return void R.oR.error("Select exactly one media element to separate audio");let{trackId:e,elementId:a}=d[0],r=t.find(t=>t.id===e);if(!r||"media"!==r.type)return void R.oR.error("Select a media element to separate audio");f(e,a)},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(t5.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Separate audio (Ctrl+D)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{if(0===d.length)return void R.oR.error("No elements selected");1===d.length&&(d.forEach(e=>{let{trackId:a,elementId:r}=e,s=t.find(e=>e.id===a),i=null==s?void 0:s.elements.find(e=>e.id===r);if(i){let e=i.startTime+(i.duration-i.trimStart-i.trimEnd)+.1,{id:t,...r}=i;n(a,{...r,startTime:e})}}),c())},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(t4.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Duplicate element (Ctrl+D)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{R.oR.info("Freeze frame functionality coming soon!")},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(t3.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Freeze frame (F)"})]}),(0,s.jsxs)(t6.m_,{children:[(0,s.jsx)(t6.k$,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{if(0===d.length)return void R.oR.error("No elements selected");d.forEach(e=>{let{trackId:t,elementId:a}=e;l(t,a)}),c()},className:"transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(220, 38, 38, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(tt.A,{className:"h-4 w-4"})})}),(0,s.jsx)(t6.ZI,{children:"Delete element (Delete)"})]})]})}),(W.enableSnapping||W.enableToolSelection)&&(0,s.jsx)(ah,{zoomLevel:ea,setZoomLevel:er,selectedTool:G,setSelectedTool:V,isSnappingEnabled:X,setIsSnappingEnabled:Z,featureFlags:W,isPlaying:C,currentTime:j,duration:N,speed:1,tracks:t,toggle:T,setSpeed:()=>{},addTrack:r,addClipToTrack:()=>{},handleSplitSelected:()=>{},handleDuplicateSelected:()=>{},handleFreezeSelected:()=>{},handleDeleteSelected:()=>{}}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden relative",ref:O,children:[W.enableTimeDisplay||W.enableSnapping&&(null==Y?void 0:Y.type)==="playhead"?(0,s.jsx)(ad,{currentTime:j,duration:N,zoomLevel:ea,tracks:t,seek:E,rulerRef:U,rulerScrollRef:en,tracksScrollRef:el,trackLabelsRef:eo,timelineRef:O,playheadRef:ed,isSnappingToPlayhead:(null==Y?void 0:Y.type)==="playhead",showTimeDisplay:W.enableTimeDisplay}):(0,s.jsx)(ao,{currentTime:j,duration:N,zoomLevel:ea,tracks:t,seek:E,rulerRef:U,rulerScrollRef:en,tracksScrollRef:el,trackLabelsRef:eo,timelineRef:O,playheadRef:ed}),(0,s.jsxs)("div",{className:"flex bg-panel border-b border-border/50 sticky top-0 z-10",children:[(0,s.jsx)("div",{className:"w-80 flex-shrink-0 bg-muted/20 border-r flex items-center justify-between px-4 py-2"}),(0,s.jsx)("div",{className:"flex-1 relative overflow-hidden bg-background/50",style:{height:"32px"},children:(0,s.jsx)("div",{className:"flex items-center px-3 py-2 h-full"})})]}),(0,s.jsxs)("div",{className:"flex bg-panel sticky top-0 z-10",style:{borderTop:"3px solid #333333"},children:[(0,s.jsx)("div",{className:"w-80 flex-shrink-0 bg-muted/30 border-r flex items-center justify-between px-4 py-2",children:(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground opacity-0",children:"."})}),(0,s.jsx)("div",{className:"flex-1 relative overflow-hidden timeline-ruler",style:{height:"28px"},onWheel:es,onMouseDown:ew,onClick:eE,"data-ruler-area":!0,ref:e=>{},children:(0,s.jsx)(tM,{className:"w-full",ref:en,children:(0,s.jsx)("div",{ref:U,className:"relative select-none cursor-default",style:{width:"".concat(ei,"px"),height:"28px",cursor:"none"},onMouseDown:ef,children:(()=>{let e=(e=>{let t=tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*e;return t>=200?.1:t>=100?.2:t>=50?.5:t>=25?1:t>=12?2:t>=6?5:10})(ea);return Array.from({length:Math.ceil(N/e)+1},(t,a)=>{let r=a*e;if(r>N)return null;let i=r%(e>=1?Math.max(1,e):1)==0;return(0,s.jsx)("div",{className:"absolute ".concat(i?"border-l-2 border-muted-foreground/60":"border-l border-muted-foreground/40"),style:{left:"".concat(r*tK.TIMELINE_CONSTANTS.PIXELS_PER_SECOND*ea+320,"px"),top:"0px",height:"32px",zIndex:1},children:(0,s.jsx)("span",{className:"absolute left-1.5 text-[0.65rem] ".concat(i?"text-muted-foreground font-medium":"text-muted-foreground/70"),style:{top:"6px"},children:(()=>{let t=Math.floor(r/3600),a=Math.floor(r%3600/60),s=r%60;return t>0?"".concat(t,":").concat(a.toString().padStart(2,"0"),":").concat(Math.floor(s).toString().padStart(2,"0")):a>0?"".concat(a,":").concat(Math.floor(s).toString().padStart(2,"0")):e>=1?"".concat(Math.floor(s),"s"):"".concat(s.toFixed(1),"s")})()})},a)}).filter(Boolean)})()})})})]}),(0,s.jsx)("div",{style:{width:"100%",height:"3px",backgroundColor:"#333333",position:"relative",zIndex:50}}),(0,s.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[t.length>0&&(0,s.jsx)("div",{ref:eo,className:"w-80 flex-shrink-0 border-r border-r-transparent bg-panel-accent overflow-y-auto","data-track-labels":!0,children:(0,s.jsx)(tM,{className:"w-full h-full",ref:ec,children:(0,s.jsx)("div",{className:"flex flex-col gap-1",children:t.map(e=>(0,s.jsxs)("div",{className:"flex items-start px-4 pr-24 border-b-transparent group bg-foreground/5 relative",style:{height:"".concat((0,tK.getTrackHeight)(e.type),"px"),borderRight:"2px solid transparent"},children:[(0,s.jsx)("div",{className:"flex items-center flex-1 min-w-0 pl-4",children:(0,s.jsx)(av,{track:e})}),e.muted&&(0,s.jsx)("span",{className:"ml-2 text-xs text-red-500 font-semibold flex-shrink-0",children:"Muted"})]},e.id))})})}),t.map((e,a)=>(0,s.jsx)("div",{style:{position:"absolute",top:"".concat((0,tK.getCumulativeHeightBefore)(t,a),"px"),left:"0px",width:"100%",height:"1px",backgroundColor:"#666666",zIndex:100}},"border-".concat(e.id))),(0,s.jsxs)("div",{className:"flex-1 relative overflow-hidden timeline-tracks",onWheel:es,onMouseDown:ew,onClick:eE,ref:eb,children:[(0,s.jsx)(ag,{startPos:(null==ey?void 0:ey.startPos)||null,currentPos:(null==ey?void 0:ey.currentPos)||null,containerRef:eb,isActive:(null==ey?void 0:ey.isActive)||!1}),(0,s.jsx)(tM,{className:"w-full h-full",ref:el,children:(0,s.jsx)("div",{className:"relative flex-1",style:{height:"".concat(Math.max(200,Math.min(800,(0,tK.getTotalTracksHeight)(t))),"px"),width:"".concat(ei,"px")},children:0===t.length?(0,s.jsx)("div",{}):(0,s.jsx)(s.Fragment,{children:t.map((e,a)=>(0,s.jsxs)($,{children:[(0,s.jsx)(q,{asChild:!0,children:(0,s.jsx)("div",{className:"absolute left-0 right-0 border-b border-l border-muted/30 border-l-transparent py-[0.05rem]",style:{top:"".concat((0,tK.getCumulativeHeightBefore)(t,a),"px"),height:"".concat((0,tK.getTrackHeight)(e.type),"px")},onClick:e=>{e.target.closest(".timeline-element")||c()},children:W.enableSnapping?(0,s.jsx)(ai,{track:e,zoomLevel:ea,onSnapPointChange:Q,isSnappingEnabled:X,featureFlags:W}):(0,s.jsx)(as,{track:e,zoomLevel:ea})})}),(0,s.jsxs)(J,{children:[(0,s.jsx)(K,{onClick:()=>g(e.id),children:e.muted?"Unmute Track":"Mute Track"}),(0,s.jsx)(K,{children:"Track settings (soon)"})]})]},e.id))})})})]})]}),(0,s.jsx)("div",{style:{width:"100%",height:"3px",backgroundColor:"#333333",position:"relative",zIndex:50}})]}),ev.visible&&(0,s.jsx)("div",{className:"fake-cursor fixed z-[9999] pointer-events-none",style:{left:"".concat(ev.x+tK.TIMELINE_CONSTANTS.CURSOR_OFFSET_PX,"px"),top:"".concat(ev.y-10,"px"),transform:"translate(-50%, -50%)"},children:(0,s.jsx)(af,{})})]})}function av(e){let{track:t}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-start pl-2 pr-6 py-2 border-2 border-transparent rounded-md",children:["media"===t.type&&(0,s.jsx)(p.A,{className:"flex-shrink-0 text-muted-foreground",style:{width:"200px",height:"24px",minWidth:"12px",minHeight:"24px",transform:"translateX(-50px)"}}),"text"===t.type&&(0,s.jsx)(f.A,{className:"w-12 h-12 flex-shrink-0 text-muted-foreground"}),"audio"===t.type&&(0,s.jsx)(g.A,{className:"w-12 h-12 flex-shrink-0 text-muted-foreground"})]})}function ab(e){let{src:t,poster:a,className:r="",clipStartTime:n,trimStart:l,trimEnd:o,clipDuration:d}=e,c=(0,i.useRef)(null),{isPlaying:m,currentTime:u,volume:p,speed:h,muted:g}=(0,t8.E)(),f=n+(d-l-o),x=u>=n&&u<f;return(0,i.useEffect)(()=>{let e=c.current;if(!e||!x)return;let t=t=>{e.currentTime=Math.max(l,Math.min(d-o,t.detail.time-n+l))},a=t=>{let a=Math.max(l,Math.min(d-o,t.detail.time-n+l));Math.abs(e.currentTime-a)>.5&&(e.currentTime=a)},r=t=>{e.playbackRate=t.detail.speed};return window.addEventListener("playback-seek",t),window.addEventListener("playback-update",a),window.addEventListener("playback-speed",r),()=>{window.removeEventListener("playback-seek",t),window.removeEventListener("playback-update",a),window.removeEventListener("playback-speed",r)}},[n,l,o,d,x]),(0,i.useEffect)(()=>{let e=c.current;e&&(m&&x?e.play().catch(()=>{}):e.pause())},[m,x]),(0,i.useEffect)(()=>{let e=c.current;e&&(e.volume=p,e.muted=g,e.playbackRate=h)},[p,h,g]),(0,s.jsx)("video",{ref:c,src:t,poster:a,className:"max-w-full max-h-full object-contain ".concat(r),playsInline:!0,preload:"auto",controls:!1,disablePictureInPicture:!0,disableRemotePlayback:!0,style:{pointerEvents:"none"},onContextMenu:e=>e.preventDefault()})}function ay(e){let{src:t,className:a="",clipStartTime:r,trimStart:n,trimEnd:l,clipDuration:o,trackMuted:d=!1}=e,c=(0,i.useRef)(null),{isPlaying:m,currentTime:u,volume:p,speed:h,muted:g}=(0,t8.E)(),f=r+(o-n-l),x=u>=r&&u<f;return(0,i.useEffect)(()=>{let e=c.current;if(!e||!x)return;let t=t=>{e.currentTime=Math.max(n,Math.min(o-l,t.detail.time-r+n))},a=t=>{let a=Math.max(n,Math.min(o-l,t.detail.time-r+n));Math.abs(e.currentTime-a)>.5&&(e.currentTime=a)},s=t=>{e.playbackRate=t.detail.speed};return window.addEventListener("playback-seek",t),window.addEventListener("playback-update",a),window.addEventListener("playback-speed",s),()=>{window.removeEventListener("playback-seek",t),window.removeEventListener("playback-update",a),window.removeEventListener("playback-speed",s)}},[r,n,l,o,x]),(0,i.useEffect)(()=>{let e=c.current;e&&(m&&x&&!d?e.play().catch(()=>{}):e.pause())},[m,x,d]),(0,i.useEffect)(()=>{let e=c.current;e&&(e.volume=p,e.muted=g||d,e.playbackRate=h)},[p,h,g,d]),(0,s.jsx)("audio",{ref:c,src:t,className:a,preload:"auto",controls:!1,style:{display:"none"},onContextMenu:e=>e.preventDefault()})}var aw=a(2776);let aj=aw.bL,aN=aw.l9;aw.YJ,aw.ZL,aw.Pb,aw.z6;let aE=(0,V.F)("relative flex cursor-pointer select-none items-center gap-2 px-2 py-1.5 text-sm outline-none transition-opacity data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"focus:opacity-65 focus:text-accent-foreground",destructive:"text-destructive focus:text-destructive/80"}},defaultVariants:{variant:"default"}});i.forwardRef((e,t)=>{let{className:a,inset:r,children:i,variant:n="default",...l}=e;return(0,s.jsxs)(aw.ZP,{ref:t,className:(0,o.cn)(aE({variant:n}),"data-[state=open]:bg-accent data-[state=open]:opacity-65",r&&"pl-8",a),...l,children:[i,(0,s.jsx)(H.A,{className:"ml-auto"})]})}).displayName=aw.ZP.displayName,i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(aw.G5,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=aw.G5.displayName;let aS=i.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...i}=e;return(0,s.jsx)(aw.ZL,{children:(0,s.jsx)(aw.UC,{ref:t,sideOffset:r,onCloseAutoFocus:e=>{e.stopPropagation(),e.preventDefault()},className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 bg-popover text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})})});aS.displayName=aw.UC.displayName;let aC=i.forwardRef((e,t)=>{let{className:a,inset:r,variant:i="default",...n}=e;return(0,s.jsx)(aw.q7,{ref:t,className:(0,o.cn)(aE({variant:i}),r&&"pl-8",a),...n})});aC.displayName=aw.q7.displayName,i.forwardRef((e,t)=>{let{className:a,children:r,checked:i,variant:n="default",...l}=e;return(0,s.jsxs)(aw.H_,{ref:t,className:(0,o.cn)(aE({variant:n}),"pl-8 pr-2",a),checked:i,...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(aw.VF,{children:(0,s.jsx)(W.A,{className:"h-4 w-4"})})}),r]})}).displayName=aw.H_.displayName,i.forwardRef((e,t)=>{let{className:a,children:r,variant:i="default",...n}=e;return(0,s.jsxs)(aw.hN,{ref:t,className:(0,o.cn)(aE({variant:i}),"pl-8 pr-2",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(aw.VF,{children:(0,s.jsx)(G.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=aw.hN.displayName,i.forwardRef((e,t)=>{let{className:a,inset:r,...i}=e;return(0,s.jsx)(aw.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...i})}).displayName=aw.JU.displayName;let aT=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(aw.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-foreground/10",a),...r})});aT.displayName=aw.wv.displayName;var ak=a(6634);let aI=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HH:MM:SS:CS",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,r=Math.floor(e/3600),s=Math.floor(e%3600/60),i=Math.floor(e%60),n=Math.floor(e%1*100),l=Math.floor(e%1*a);switch(t){case"MM:SS":return"".concat(s.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"));case"HH:MM:SS":return"".concat(r.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"));case"HH:MM:SS:CS":return"".concat(r.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"));case"HH:MM:SS:FF":return"".concat(r.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"))}};var aM=a(848),aA=a.n(aM),aR=a(805),aP=a.n(aR),aD=a(2515),aL=a.n(aD),az=a(9003),aF=a.n(az),a_=a(4960),aO=a.n(a_);let aU={Inter:aA().className,Roboto:aP().className,"Open Sans":aL().className,"Playfair Display":aF().className,"Comic Neue":aO().className,Arial:"",Helvetica:"","Times New Roman":"",Georgia:""};aA(),aP(),aL(),aF(),aO();let aB=eU.bL,aH=eU.l9;eU.Mz;let aW=i.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:i=4,...n}=e;return(0,s.jsx)(eU.ZL,{children:(0,s.jsx)(eU.UC,{ref:t,align:r,sideOffset:i,className:(0,o.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});aW.displayName=eU.UC.displayName;var aG=a(2063),aV=a(8588),a$=a.n(aV);let aq=["#ffffff","#000000","#ffe2e2","#ffc9c9","#ffa2a2","#ff6467","#fb2c36","#e7000b","#c10007","#9f0712","#82181a","#460809","#fff7ed","#ffedd4","#ffd6a7","#ffb86a","#ff8904","#ff6900","#f54900","#ca3500","#9f2d00","#7e2a0c","#441306","#fffbeb","#fef3c6","#fee685","#ffd230","#ffb900","#fe9a00","#e17100","#bb4d00","#973c00","#7b3306","#461901","#fefce8","#fef9c2","#fff085","#ffdf20","#fdc700","#f0b100","#d08700","#a65f00","#894b00","#733e0a","#432004","#f7fee7","#ecfcca","#d8f999","#bbf451","#9ae600","#7ccf00","#5ea500","#497d00","#3c6300","#35530e","#192e03","#f0fdf4","#dcfce7","#b9f8cf","#7bf1a8","#05df72","#00c950","#00a63e","#008236","#016630","#0d542b","#032e15","#ecfdf5","#d0fae5","#a4f4cf","#5ee9b5","#00d492","#00bc7d","#009966","#007a55","#006045","#004f3b","#002c22","#f0fdfa","#cbfbf1","#96f7e4","#46ecd5","#00d5be","#00bba7","#009689","#00786f","#005f5a","#0b4f4a","#022f2e","#ecfeff","#cefafe","#a2f4fd","#53eafd","#00d3f2","#00b8db","#0092b8","#007595","#005f78","#104e64","#053345","#f0f9ff","#dff2fe","#b8e6fe","#74d4ff","#00bcff","#00a6f4","#0084d1","#0069a8","#00598a","#024a70","#052f4a","#eff6ff","#dbeafe","#bedbff","#8ec5ff","#51a2ff","#2b7fff","#155dfc","#1447e6","#193cb8","#1c398e","#162456","#eef2ff","#e0e7ff","#c6d2ff","#a3b3ff","#7c86ff","#615fff","#4f39f6","#432dd7","#372aac","#312c85","#1e1a4d","#f5f3ff","#ede9fe","#ddd6ff","#c4b4ff","#a684ff","#8e51ff","#7f22fe","#7008e7","#5d0ec0","#4d179a","#2f0d68","#faf5ff","#f3e8ff","#e9d4ff","#dab2ff","#c27aff","#ad46ff","#9810fa","#8200db","#6e11b0","#59168b","#3c0366","#fdf4ff","#fae8ff","#f6cfff","#f4a8ff","#ed6aff","#e12afb","#c800de","#a800b7","#8a0194","#721378","#4b004f","#fdf2f8","#fce7f3","#fccee8","#fda5d5","#fb64b6","#f6339a","#e60076","#c6005c","#a3004c","#861043","#510424","#fff1f2","#ffe4e6","#ffccd3","#ffa1ad","#ff637e","#ff2056","#ec003f","#c70036","#a50036","#8b0836","#4d0218","#f8fafc","#f1f5f9","#e2e8f0","#cad5e2","#90a1b9","#62748e","#45556c","#314158","#1d293d","#0f172b","#020618","#f9fafb","#f3f4f6","#e5e7eb","#d1d5dc","#99a1af","#6a7282","#4a5565","#364153","#1e2939","#101828","#030712","#fafafa","#f4f4f5","#e4e4e7","#d4d4d8","#9f9fa9","#71717b","#52525c","#3f3f46","#27272a","#18181b","#09090b","#f5f5f5","#e5e5e5","#d4d4d4","#a1a1a1","#737373","#525252","#404040","#262626","#171717","#0a0a0a","#fafaf9","#f5f5f4","#e7e5e4","#d6d3d1","#a6a09b","#79716b","#57534d","#44403b","#292524","#1c1917","#0c0a09"];var aX=a(4429);function aJ(){let{activeProject:e,updateBackgroundType:t}=(0,eh.I)(),a=(null==e?void 0:e.backgroundType)||"color";return(0,s.jsxs)(aB,{children:[(0,s.jsx)(aH,{asChild:!0,children:(0,s.jsx)(I.$,{variant:"text",size:"icon",className:"!size-4 border border-muted-foreground !bg-transparent",children:(0,s.jsx)(aG.Wm,{className:"!size-3"})})}),(0,s.jsxs)(aW,{className:"flex flex-col items-start w-[20rem] h-[16rem] overflow-hidden p-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between w-full gap-2 z-10 bg-popover p-3",children:[(0,s.jsx)("h2",{className:"text-sm",children:"Background"}),(0,s.jsx)("div",{className:"flex items-center gap-2 text-sm",children:[{label:"Color",value:"color"},{label:"Blur",value:"blur"}].map(r=>(0,s.jsx)("span",{onClick:()=>{"color"===r.value?t("color",{backgroundColor:(null==e?void 0:e.backgroundColor)||"#000000"}):t("blur",{blurIntensity:(null==e?void 0:e.blurIntensity)||8})},className:(0,o.cn)("text-muted-foreground cursor-pointer",a===r.value&&"text-foreground"),children:r.label},r.value))})]}),"color"===a?(0,s.jsx)(aK,{selectedColor:(null==e?void 0:e.backgroundColor)||"#000000",onColorSelect:e=>{t("color",{backgroundColor:e})}}):(0,s.jsx)(aY,{selectedBlur:(null==e?void 0:e.blurIntensity)||8,onBlurSelect:e=>{t("blur",{blurIntensity:e})}})]})]})}function aK(e){let{selectedColor:t,onColorSelect:a}=e;return(0,s.jsxs)("div",{className:"w-full h-full",children:[(0,s.jsx)("div",{className:"absolute top-8 left-0 w-[calc(100%-1rem)] h-12 bg-gradient-to-b from-popover to-transparent pointer-events-none"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 w-full h-full p-3 pt-0 overflow-auto",children:[(0,s.jsx)("div",{className:"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary flex items-center justify-center",children:(0,s.jsx)(aX.A,{className:"size-4"})}),aq.map(e=>(0,s.jsx)(aZ,{color:e,isSelected:e===t,onClick:()=>a(e)},e))]})]})}function aZ(e){let{color:t,isSelected:a,onClick:r}=e;return(0,s.jsx)("div",{className:(0,o.cn)("w-full aspect-square rounded-sm cursor-pointer hover:border-2 hover:border-primary",a&&"border-2 border-primary"),style:{backgroundColor:t},onClick:r})}function aY(e){let{selectedBlur:t,onBlurSelect:a}=e;return(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2 w-full p-3 pt-0",children:[{label:"Light",value:4},{label:"Medium",value:8},{label:"Heavy",value:18}].map(e=>(0,s.jsxs)("div",{className:(0,o.cn)("w-full aspect-square rounded-sm cursor-pointer hover:border-2 hover:border-primary relative overflow-hidden",t===e.value&&"border-2 border-primary"),onClick:()=>a(e.value),children:[(0,s.jsx)(a$(),{src:"https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",alt:"Blur preview ".concat(e.label),fill:!0,className:"object-cover",style:{filter:"blur(".concat(e.value,"px)")}}),(0,s.jsx)("div",{className:"absolute bottom-1 left-1 right-1 text-center",children:(0,s.jsx)("span",{className:"text-xs text-white bg-black/50 px-1 rounded",children:e.label})})]},e.value))})}function aQ(){let{tracks:e}=(0,tU.A)(),{mediaItems:t}=(0,P.useMediaStore)(),{currentTime:a}=(0,t8.E)(),{canvasSize:r}=(0,tO.U)(),n=(0,i.useRef)(null),l=(0,i.useRef)(null),[o,d]=(0,i.useState)({width:0,height:0}),{activeProject:c}=(0,eh.I)();(0,i.useEffect)(()=>{let e=()=>{let e,t;if(!l.current)return;let a=l.current.getBoundingClientRect(),s=getComputedStyle(l.current),i=parseFloat(s.paddingTop),n=parseFloat(s.paddingBottom),o=parseFloat(s.paddingLeft),c=parseFloat(s.paddingRight),m=parseFloat(s.gap)||16,u=l.current.querySelector("[data-toolbar]"),p=u?u.getBoundingClientRect().height:0,h=a.width-o-c,g=a.height-i-n-p-(p>0?m:0),f=r.width/r.height;h/g>f?e=(t=g)*f:t=(e=h)/f,d({width:e,height:t})};e();let t=new ResizeObserver(e);return l.current&&t.observe(l.current),()=>t.disconnect()},[r.width,r.height]);let m=(()=>{let r=[];return e.forEach(e=>{e.elements.forEach(s=>{let i=s.startTime,n=s.startTime+(s.duration-s.trimStart-s.trimEnd);if(a>=i&&a<n){let a=null;"media"===s.type&&(a="test"===s.mediaId?null:t.find(e=>e.id===s.mediaId)||null),r.push({element:s,track:e,mediaItem:a})}})}),r})(),u=e.some(e=>e.elements.length>0),p=m.filter(e=>{let{element:t,mediaItem:a}=e;return"media"===t.type&&a&&("video"===a.type||"image"===a.type)&&"test"!==t.mediaId}),h=(e,t)=>{let{element:a,mediaItem:i}=e;if("text"===a.type){let e=aU[a.fontFamily]||"",i=o.width/r.width;return(0,s.jsx)("div",{className:"absolute flex items-center justify-center",style:{left:"".concat(50+a.x/r.width*100,"%"),top:"".concat(50+a.y/r.height*100,"%"),transform:"translate(-50%, -50%) rotate(".concat(a.rotation,"deg) scale(").concat(i,")"),opacity:a.opacity,zIndex:100+t},children:(0,s.jsx)("div",{className:e,style:{fontSize:"".concat(a.fontSize,"px"),color:a.color,backgroundColor:a.backgroundColor,textAlign:a.textAlign,fontWeight:a.fontWeight,fontStyle:a.fontStyle,textDecoration:a.textDecoration,padding:"4px 8px",borderRadius:"2px",whiteSpace:"nowrap",...""===e&&{fontFamily:a.fontFamily}},children:a.content})},a.id)}if("media"===a.type){if(!i||"test"===a.mediaId)return(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl mb-2",children:"\uD83C\uDFAC"}),(0,s.jsx)("p",{className:"text-xs text-white",children:a.name})]})},a.id);if("video"===i.type)return(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(ab,{src:i.url,poster:i.thumbnailUrl,clipStartTime:a.startTime,trimStart:a.trimStart,trimEnd:a.trimEnd,clipDuration:a.duration})},a.id);if("image"===i.type)return(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("img",{src:i.url,alt:i.name,className:"max-w-full max-h-full object-contain",draggable:!1})},a.id);if("audio"===i.type)return(0,s.jsx)("div",{className:"absolute inset-0",children:(0,s.jsx)(ay,{src:i.url,clipStartTime:a.startTime,trimStart:a.trimStart,trimEnd:a.trimEnd,clipDuration:a.duration,trackMuted:e.track.muted})},a.id)}return null};return(0,s.jsx)("div",{className:"h-full w-full flex flex-col min-h-0 min-w-0 bg-panel rounded-xl relative",style:{borderTop:"2px solid #ff6b6b",borderRight:"2px solid #4ecdc4",borderBottom:"2px solid #45b7d1",borderLeft:"2px solid #96ceb4"},children:(0,s.jsxs)("div",{ref:l,className:"flex-1 flex flex-col items-center justify-center p-6 min-h-0 min-w-0",style:{backgroundColor:"transparent",backgroundImage:"none"},children:[(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsxs)("div",{ref:n,className:"relative overflow-hidden rounded-sm border-panel-secondary",style:{width:o.width,height:o.height,backgroundColor:(null==c||c.backgroundType,(null==c?void 0:c.backgroundColor)||"#000000"),backgroundImage:"none",backgroundRepeat:"no-repeat"},children:[(()=>{if(!(null==c?void 0:c.backgroundType)||"blur"!==c.backgroundType||0===p.length)return null;let{element:e,mediaItem:t}=p[0];if(!t)return null;let a=c.blurIntensity||8;return"video"===t.type?(0,s.jsx)("div",{className:"absolute inset-0 overflow-hidden",style:{filter:"blur(".concat(a,"px)"),transform:"scale(1.1)",transformOrigin:"center"},children:(0,s.jsx)(ab,{src:t.url,poster:t.thumbnailUrl,clipStartTime:e.startTime,trimStart:e.trimStart,trimEnd:e.trimEnd,clipDuration:e.duration,className:"w-full h-full object-cover"})},"blur-".concat(e.id)):"image"===t.type?(0,s.jsx)("div",{className:"absolute inset-0 overflow-hidden",style:{filter:"blur(".concat(a,"px)"),transform:"scale(1.1)",transformOrigin:"center"},children:(0,s.jsx)("img",{src:t.url,alt:t.name,className:"w-full h-full object-cover",draggable:!1})},"blur-".concat(e.id)):null})(),u?0===m.length?(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground",children:"No elements at current time"}):m.map((e,t)=>h(e,t)):(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm mb-2",children:"No media added to timeline"}),(0,s.jsx)("div",{className:"text-xs opacity-70",children:"Drag media from the left panel to the timeline below"})]})}),(null==c?void 0:c.backgroundType)==="blur"&&0===p.length&&m.length>0&&(0,s.jsx)("div",{className:"absolute bottom-2 left-2 right-2 bg-black/70 text-white text-xs p-2 rounded",children:"Add a video or image to use blur background"})]}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(a0,{hasAnyElements:u})]})})}function a0(e){let{hasAnyElements:t}=e,{isPlaying:a,toggle:r,currentTime:i}=(0,t8.E)(),{setCanvasSize:n,setCanvasSizeToOriginal:l}=(0,tO.U)(),{getTotalDuration:d}=(0,tU.A)(),{activeProject:c}=(0,eh.I)(),{currentPreset:m,isOriginal:u,getOriginalAspectRatio:p,getDisplayName:h,canvasPresets:g}=tB(),f=e=>{n({width:e.width,height:e.height})};return(0,s.jsxs)("div",{"data-toolbar":!0,className:"flex items-end justify-between gap-2 p-1 pt-2 w-full",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("p",{className:(0,o.cn)("text-[0.75rem] text-muted-foreground flex items-center gap-1",!t&&"opacity-50"),children:[(0,s.jsx)("span",{className:"tabular-nums",style:{color:"#05c7c7"},children:aI(i,"HH:MM:SS:FF",(null==c?void 0:c.fps)||30)}),(0,s.jsx)("span",{className:"opacity-50",children:"/"}),(0,s.jsx)("span",{className:"tabular-nums",children:aI(d(),"HH:MM:SS:FF",(null==c?void 0:c.fps)||30)})]})}),(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:r,disabled:!t,className:"h-auto p-0 transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none",transform:"translateY(-4px)"},onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="translateY(-4px) scale(1.1)")},onMouseLeave:e=>{e.currentTarget.disabled||(e.currentTarget.style.color="",e.currentTarget.style.transform="translateY(-4px) scale(1)")},children:a?(0,s.jsx)(tQ.A,{className:"h-3 w-3"}):(0,s.jsx)(eJ.A,{className:"h-3 w-3"})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(aJ,{}),(0,s.jsxs)(aj,{children:[(0,s.jsx)(aN,{asChild:!0,children:(0,s.jsx)(I.$,{size:"sm",className:"!bg-panel-accent text-foreground/85 text-[0.70rem] h-4 rounded-none border border-muted-foreground px-0.5 py-0 font-light",disabled:!t,children:h()})}),(0,s.jsxs)(aS,{align:"end",children:[(0,s.jsx)(aC,{onClick:()=>{l(p())},className:(0,o.cn)("text-xs",u&&"font-semibold"),children:"Original"}),(0,s.jsx)(aT,{}),g.map(e=>(0,s.jsx)(aC,{onClick:()=>f(e),className:(0,o.cn)("text-xs",(null==m?void 0:m.name)===e.name&&"font-semibold"),children:e.name},e.name))]})]}),(0,s.jsx)(I.$,{variant:"text",size:"icon",className:"!size-4 text-muted-foreground transition-all duration-200",style:{backgroundColor:"transparent",border:"none",outline:"none",boxShadow:"none"},onMouseEnter:e=>{e.currentTarget.style.color="rgba(59, 130, 246, 1)",e.currentTarget.style.transform="scale(1.1)"},onMouseLeave:e=>{e.currentTarget.style.color="",e.currentTarget.style.transform="scale(1)"},children:(0,s.jsx)(ak.A,{className:"!size-4"})})]})]})}var a1=a(4584),a2=a.n(a1),a5=a(2161),a4=a(6225),a3=a(4387);let a6=()=>{let e=new Date().toISOString().slice(0,16).replace("T","_").replace(/:/g,"-");return{format:a3.A.MP4,quality:a3.y.HIGH,filename:"export_".concat(e),width:1920,height:1080}},a8=()=>({isExporting:!1,progress:0,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,status:""}),a7=(0,N.v)(e=>({settings:a6(),progress:a8(),error:null,isDialogOpen:!1,updateSettings:t=>e(e=>({settings:{...e.settings,...t}})),updateProgress:t=>e(e=>({progress:{...e.progress,...t}})),setError:t=>e({error:t}),setDialogOpen:t=>e({isDialogOpen:t}),resetExport:()=>e({settings:a6(),progress:a8(),error:null,isDialogOpen:!1})}));var a9=a(1992);let re=a9.bL,rt=a9.l9,ra=a9.ZL;a9.bm;let rr=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(a9.hJ,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});rr.displayName=a9.hJ.displayName;let rs=i.forwardRef((e,t)=>{let{className:a,children:r,contentClassName:i,...n}=e;return(0,s.jsxs)(ra,{children:[(0,s.jsx)(rr,{}),(0,s.jsxs)(a9.UC,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-[calc(100%-2rem)] max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[(0,s.jsx)(tM,{className:"max-h-[85vh]",children:(0,s.jsx)("div",{className:(0,o.cn)("p-6 space-y-4",i),children:r})}),(0,s.jsxs)(a9.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(eX.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});rs.displayName=a9.UC.displayName;let ri=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};ri.displayName="DialogHeader";let rn=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(a9.hE,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});rn.displayName=a9.hE.displayName;let rl=i.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(a9.VY,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});rl.displayName=a9.VY.displayName;var ro=a(3847);let rd={space:"toggle-play",k:"toggle-play",j:"seek-backward",l:"seek-forward",left:"frame-step-backward",right:"frame-step-forward","shift+left":"jump-backward","shift+right":"jump-forward",home:"goto-start",end:"goto-end",s:"split-element",n:"toggle-snapping",delete:"delete-selected",backspace:"delete-selected","ctrl+a":"select-all","cmd+a":"select-all","ctrl+d":"duplicate-selected","cmd+d":"duplicate-selected","ctrl+z":"undo","cmd+z":"undo","ctrl+shift+z":"redo","cmd+shift+z":"redo","ctrl+y":"redo","cmd+y":"redo"},rc=(0,N.v)((e,t)=>({keybindings:rd,updateKeybinding:(t,a)=>{e(e=>({keybindings:{...e.keybindings,[t]:a}}))},removeKeybinding:t=>{e(e=>{let a={...e.keybindings};return delete a[t],{keybindings:a}})},getKeybindingString:e=>{let t=[];(e.ctrlKey||e.metaKey)&&t.push(e.metaKey?"cmd":"ctrl"),e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt");let a=e.key.toLowerCase();return" "===a&&(a="space"),"arrowleft"===a&&(a="left"),"arrowright"===a&&(a="right"),"arrowup"===a&&(a="up"),"arrowdown"===a&&(a="down"),["control","meta","shift","alt"].includes(a)||t.push(a),t.join("+")},validateKeybinding:(e,a)=>{let{keybindings:r}=t(),s=r[e];return s&&s!==a?{existingAction:s}:null},getKeybindingsForAction:e=>{let{keybindings:a}=t();return Object.entries(a).filter(t=>{let[a,r]=t;return r===e}).map(e=>{let[t]=e;return t})}})),rm={"toggle-play":{description:"Play/Pause",category:"Playback"},"stop-playback":{description:"Stop playback",category:"Playback"},"seek-forward":{description:"Seek forward 1 second",category:"Playback"},"seek-backward":{description:"Seek backward 1 second",category:"Playback"},"frame-step-forward":{description:"Frame step forward",category:"Navigation"},"frame-step-backward":{description:"Frame step backward",category:"Navigation"},"jump-forward":{description:"Jump forward 5 seconds",category:"Navigation"},"jump-backward":{description:"Jump backward 5 seconds",category:"Navigation"},"goto-start":{description:"Go to timeline start",category:"Navigation"},"goto-end":{description:"Go to timeline end",category:"Navigation"},"split-element":{description:"Split element at playhead",category:"Editing"},"delete-selected":{description:"Delete selected elements",category:"Editing"},"select-all":{description:"Select all elements",category:"Selection"},"duplicate-selected":{description:"Duplicate selected element",category:"Selection"},"toggle-snapping":{description:"Toggle snapping",category:"Editing"},undo:{description:"Undo",category:"History"},redo:{description:"Redo",category:"History"}},ru=e=>e.replace("ctrl","Ctrl").replace("cmd","Cmd").replace("alt","Alt").replace("shift","Shift").replace("left","←").replace("right","→").replace("up","↑").replace("down","↓").replace("space","Space").replace("home","Home").replace("end","End").replace("delete","Delete").replace("backspace","Backspace"),rp=()=>{let{keybindings:e}=rc();return{shortcuts:(0,i.useMemo)(()=>{let t=[],a={};return Object.entries(e).forEach(e=>{let[t,r]=e;r&&(a[r]||(a[r]=[]),a[r].push(ru(t)))}),Object.entries(a).forEach(e=>{let[a,r]=e,s=rm[a];s&&t.push({id:a,keys:r.map(e=>ru(e)),description:s.description,category:s.category,action:a})}),t.sort((e,t)=>e.category!==t.category?e.category.localeCompare(t.category):e.description.localeCompare(t.description))},[e])}},rh=e=>{let{shortcut:t,recordingKey:a,onStartRecording:r}=e,i=t.keys.filter(e=>!(e.includes("Ctrl")&&t.keys.includes(e.replace("Ctrl","Cmd"))));return(0,s.jsxs)("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg hover:bg-slate-600 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 pl-8",children:[t.icon&&(0,s.jsx)("div",{className:"text-muted-foreground",children:t.icon}),(0,s.jsx)("span",{className:"text-sm text-slate-500",style:{paddingLeft:"24px"},children:t.description})]}),(0,s.jsx)("div",{className:"flex items-center gap-1 flex-shrink-0 ml-4",style:{paddingRight:"16px"},children:i.map((e,n)=>(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"flex items-center gap-4",children:e.split("+").map((i,l)=>{let o="".concat(t.id,"-").concat(n,"-").concat(l);return(0,s.jsx)(rg,{keyId:o,originalKey:e,shortcut:t,isRecording:a===o,onStartRecording:()=>r(o,t),children:i},l)})}),n<i.length-1&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground px-1",children:"or"})]},n))})]})},rg=e=>{let{children:t,keyId:a,originalKey:r,shortcut:i,isRecording:n,onStartRecording:l}=e;return(0,s.jsx)(I.$,{variant:n?"secondary":"outline",size:"sm",className:"font-mono text-xs min-w-[2rem] min-h-[1.75rem] mr-3 transition-all hover:scale-105 !rounded-lg ".concat(n?"border-blue-400 bg-blue-500/20 text-blue-300":"border-slate-500 bg-slate-800 text-slate-200 hover:bg-slate-700"),style:{borderRadius:"8px"},onClick:e=>{e.preventDefault(),e.stopPropagation(),l()},title:n?"Press any key combination...":"Click to edit shortcut",children:t})},rf=()=>{let[e,t]=(0,i.useState)(!1),[a,r]=(0,i.useState)(null),[n,l]=(0,i.useState)(null);(0,i.useEffect)(()=>{e&&setTimeout(()=>{let e=Array.from(document.querySelectorAll("button")).filter(e=>e.className.includes("absolute")&&e.className.includes("right-4"));if(e.length>0){let t=e[0];console.log("\uD83D\uDD27 Forcing close button styles..."),t.style.setProperty("background","transparent","important"),t.style.setProperty("background-color","transparent","important"),t.style.setProperty("background-image","none","important"),t.style.setProperty("color","white","important"),t.style.setProperty("position","absolute","important"),t.style.setProperty("right","16px","important"),t.style.setProperty("top","16px","important"),t.style.setProperty("z-index","999","important"),t.style.setProperty("display","block","important"),t.style.setProperty("visibility","visible","important"),t.style.setProperty("border","none","important"),t.style.setProperty("box-shadow","none","important"),t.addEventListener("mouseenter",()=>{t.style.setProperty("background","transparent","important"),t.style.setProperty("background-color","transparent","important")}),t.addEventListener("mouseleave",()=>{t.style.setProperty("background","transparent","important"),t.style.setProperty("background-color","transparent","important")})}},500)},[e]);let{updateKeybinding:o,removeKeybinding:d,getKeybindingString:c,validateKeybinding:m,getKeybindingsForAction:u}=rc(),{shortcuts:p}=rp(),h=Array.from(new Set(p.map(e=>e.category)));(0,i.useEffect)(()=>{if(!a||!n)return;let e=e=>{e.preventDefault(),e.stopPropagation();let t=c(e);if(t){let e=m(t,n.action);if(e){R.oR.error('Key "'.concat(t,'" is already bound to "').concat(e.existingAction,'"')),r(null),l(null);return}u(n.action).forEach(e=>d(e)),o(t,n.action),r(null),l(null)}},t=e=>{r(null),l(null)};return document.addEventListener("keydown",e),document.addEventListener("click",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("click",t)}},[a,n,c,o,d,m,u]);let g=(e,t)=>{r(e),l(t)};return(0,s.jsxs)(re,{open:e,onOpenChange:t,children:[(0,s.jsx)(rt,{asChild:!0,children:(0,s.jsxs)(I.$,{variant:"text",size:"sm",className:"gap-2 transition-all duration-200 !bg-transparent hover:!bg-transparent !border-transparent text-white hover:text-white",children:[(0,s.jsx)(ro.A,{className:"w-4 h-4 text-white"}),(0,s.jsx)("span",{className:"hidden sm:inline text-xs ml-2 text-white",children:"Shortcuts"})]})}),(0,s.jsxs)(rs,{className:"w-[40vw] max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl !rounded-2xl",style:{backgroundColor:"#334155",border:"none",borderRadius:"16px"},children:[(0,s.jsxs)(ri,{className:"rounded-t-2xl -m-6 p-6 mb-6",style:{backgroundColor:"#475569"},children:[(0,s.jsxs)(rn,{className:"flex items-center justify-center text-lg text-white font-semibold",children:[(0,s.jsx)(ro.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{style:{marginLeft:"12px"},children:"Keyboard Shortcuts"})]}),(0,s.jsxs)(rl,{className:"text-sm text-slate-300 text-center",children:["Speed up your workflow with these keyboard shortcuts.",(0,s.jsx)("br",{}),"Click any key to edit."]})]}),(0,s.jsx)("div",{className:"px-6 pb-6 overflow-y-auto max-h-[60vh] bg-slate-700",style:{backgroundColor:"#334155"},children:(0,s.jsx)("div",{className:"space-y-6",children:h.map(e=>(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("h3",{className:"text-xs uppercase tracking-wide font-semibold text-slate-400 mb-3",style:{paddingLeft:"16px"},children:e}),(0,s.jsx)("div",{className:"space-y-2",children:p.filter(t=>t.category===e).map((e,t)=>(0,s.jsx)(rh,{shortcut:e,recordingKey:a,onStartRecording:g},t))})]},e))})})]})]})};function rx(){let{getTotalDuration:e}=(0,tU.A)(),{activeProject:t}=(0,eh.I)(),{setDialogOpen:a}=a7(),r=(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(a2(),{href:"/projects",className:"font-medium tracking-tight flex items-center gap-2 hover:opacity-80 transition-opacity relative shadow-lg hover:shadow-xl before:absolute before:inset-0 before:-translate-x-full before:animate-shimmer before:bg-gradient-to-r before:from-transparent before:via-white/30 before:to-transparent no-underline",style:{backgroundColor:"white",color:"black",height:"32px",borderRadius:"9999px",fontSize:"13px",position:"relative",overflow:"hidden",border:"none",outline:"none",boxShadow:"none",paddingLeft:"16px",paddingRight:"16px"},prefetch:!1,children:[(0,s.jsx)(a5.A,{className:"h-4 w-4",style:{width:"12px",height:"12px",marginRight:"8px"}}),(0,s.jsx)("span",{className:"text-sm",children:null==t?void 0:t.name})]})}),i=(0,s.jsx)("div",{className:"flex items-center gap-2 text-xs",children:(0,s.jsx)("span",{children:aI(e(),"HH:MM:SS:FF",(null==t?void 0:t.fps)||30)})}),n=(0,s.jsxs)("nav",{className:"flex items-center gap-2",children:[(0,s.jsx)(rf,{}),(0,s.jsxs)(I.$,{variant:"text",size:"sm",style:{backgroundColor:"#05c7c7",color:"#171717",height:"32px",borderRadius:"9999px",fontSize:"13px",position:"relative",overflow:"hidden",border:"none",outline:"none",boxShadow:"none",paddingLeft:"16px",paddingRight:"16px"},className:"relative shadow-lg hover:shadow-xl before:absolute before:inset-0 before:-translate-x-full before:animate-shimmer before:bg-gradient-to-r before:from-transparent before:via-white/30 before:to-transparent transition-all duration-200",onClick:()=>{a(!0)},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.backgroundColor="#05c7c7"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.backgroundColor="#05c7c7"},children:[(0,s.jsx)(eF.A,{className:"align-text-bottom",style:{width:"12px",height:"12px",marginRight:"8px"}}),"Export"]})]});return(0,s.jsx)(a4.H,{leftContent:r,centerContent:i,rightContent:n,className:"bg-background h-[3.2rem] px-4"})}function rv(e){let{children:t}=e,{isInitializing:a,isPanelsReady:r,initializeApp:n}=(0,tO.U)();return((0,i.useEffect)(()=>{n()},[n]),(0,i.useEffect)(()=>{},[a,r]),a||!r)?(0,s.jsx)("div",{className:"h-screen w-screen flex items-center justify-center bg-background",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(z.A,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading editor..."})]})}):(0,s.jsx)(s.Fragment,{children:t})}let rb=()=>{let{isPlaying:e,currentTime:t,play:a,pause:r,seek:s}=(0,t8.E)(),{selectedElements:n,tracks:l,splitElement:o,splitAndKeepLeft:d,splitAndKeepRight:c,separateAudio:m}=(0,tU.A)(),u=(0,i.useCallback)(()=>{if(1!==n.length)return void R.oR.error("Select exactly one element to split");let{trackId:e,elementId:a}=n[0],r=l.find(t=>t.id===e),s=null==r?void 0:r.elements.find(e=>e.id===a);if(!s)return;let i=s.startTime,d=s.startTime+(s.duration-s.trimStart-s.trimEnd);if(t<=i||t>=d)return void R.oR.error("Playhead must be within selected element");o(e,a,t)},[n,l,t,o]),p=(0,i.useCallback)(()=>{if(1!==n.length)return void R.oR.error("Select exactly one element");let{trackId:e,elementId:a}=n[0],r=l.find(t=>t.id===e),s=null==r?void 0:r.elements.find(e=>e.id===a);if(!s)return;let i=s.startTime,o=s.startTime+(s.duration-s.trimStart-s.trimEnd);if(t<=i||t>=o)return void R.oR.error("Playhead must be within selected element");d(e,a,t)},[n,l,t,d]),h=(0,i.useCallback)(()=>{if(1!==n.length)return void R.oR.error("Select exactly one element");let{trackId:e,elementId:a}=n[0],r=l.find(t=>t.id===e),s=null==r?void 0:r.elements.find(e=>e.id===a);if(!s)return;let i=s.startTime,o=s.startTime+(s.duration-s.trimStart-s.trimEnd);if(t<=i||t>=o)return void R.oR.error("Playhead must be within selected element");c(e,a,t)},[n,l,t,c]),g=(0,i.useCallback)(()=>{if(1!==n.length)return void R.oR.error("Select exactly one media element to separate audio");let{trackId:e,elementId:t}=n[0],a=l.find(t=>t.id===e);if(!a||"media"!==a.type)return void R.oR.error("Select a media element to separate audio");m(e,t)},[n,l,m]),f=(0,i.useCallback)(t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement))switch(t.key){case" ":t.preventDefault(),e?r():a();break;case"s":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),u());break;case"q":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),p());break;case"w":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),h());break;case"d":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),g())}},[e,a,r,u,p,h,g]);(0,i.useEffect)(()=>(document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)),[f])};var ry=a(1609);let rw=i.forwardRef((e,t)=>{let{className:a,value:r,...i}=e;return(0,s.jsx)(ry.bL,{ref:t,className:(0,o.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...i,children:(0,s.jsx)(ry.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});rw.displayName=ry.bL.displayName;var rj=a(4567),rN=a(6281),rE=a(6046);let rS=(0,i.forwardRef)((e,t)=>{let{settings:a,className:r=""}=e,n=(0,i.useRef)(null),l=(0,i.useRef)(null);return(0,i.useEffect)(()=>{let e=n.current;if(!e)return;let t=e.getContext("2d");if(!t)return;l.current=t,e.width=a.width,e.height=a.height;let r=window.devicePixelRatio||1;e.width=a.width*r,e.height=a.height*r,t.scale(r,r),e.style.width="".concat(a.width,"px"),e.style.height="".concat(a.height,"px"),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high"},[a.width,a.height]),(0,i.useImperativeHandle)(t,()=>({getCanvas:()=>n.current,getContext:()=>l.current,clear:()=>{let e=l.current,t=n.current;e&&t&&e.clearRect(0,0,t.width,t.height)},capture:()=>{let e=n.current;return e?e.toDataURL("image/png"):null}})),(0,s.jsx)("canvas",{ref:n,className:"hidden ".concat(r),style:{width:a.width,height:a.height}})});rS.displayName="ExportCanvas";var rC=a(26),rT=a(7997),rk=a(4999);class rI{static async createOptimalEngine(e){try{console.log("\uD83C\uDFED Creating optimal export engine...");let t=this.memoryMonitor.getMemoryStatus();if(console.log("\uD83D\uDCBE Memory status: ".concat(t.currentUsageGB,"GB / 8GB (").concat(t.percentageUsed,"%)")),t.shouldEmergencyCleanup)return console.warn("⚠️ Memory critical, forcing stable engine"),this.createStableEngine(e);if(await rT.w.safeWebCodecsCheck()){let t=await rT.w.checkSupport();if(t.supported)if(t.hardwareAcceleration)return console.log("✅ Using WebCodecs engine with hardware acceleration"),await this.createWebCodecsEngine(e,"hardware");else return console.log("✅ Using WebCodecs engine (software encoding)"),await this.createWebCodecsEngine(e,"software")}if(t.availableGB>2&&navigator.hardwareConcurrency>=4)return console.log("\uD83D\uDE80 Using parallel batch processing engine (Phase 2 optimization)"),this.createParallelEngine(e)}catch(e){console.warn("⚠️ Advanced engine creation failed, using fallback:",e)}return console.log("✅ Using current optimized export engine (proven stable)"),this.createStableEngine(e)}static createStableEngine(e){console.log("\uD83D\uDD12 Using stable export engine (bypassing WebCodecs)"),this.memoryMonitor.getMemoryStatus();let t=this.memoryMonitor.getOptimalExportSettings("1080p",e.duration);return console.log("\uD83D\uDCCA Memory-optimized settings: ".concat(t.qualityLevel," quality, ").concat(t.parallelEncoders," encoders")),new rC.N({...e,settings:{...e.settings}})}static createParallelEngine(e){try{return console.log("\uD83D\uDE80 Creating parallel batch processing engine"),a.e(902).then(a.bind(a,7902)).then(async t=>{let{ParallelExportEngine:a}=t,r=this.memoryMonitor.getMemoryStatus(),s=this.memoryMonitor.getOptimalExportSettings("1080p",e.duration);return console.log("⚡ Parallel engine: ".concat(s.parallelEncoders," encoders, ").concat(r.availableGB.toFixed(1),"GB available")),new a({...e})}).catch(t=>(console.warn("Failed to load ParallelExportEngine, using stable engine:",t),this.createStableEngine(e))),this.createStableEngine(e)}catch(t){return console.warn("Failed to create parallel engine:",t),this.createStableEngine(e)}}static async createTestEngine(e){try{console.log("\uD83E\uDDEA Creating test WebCodecs engine");let{WebCodecsExportEngine:t}=await a.e(890).then(a.bind(a,8890)),r=new t(e);return await r.initialize(),console.log("\uD83E\uDDEA Test WebCodecs engine created successfully"),r}catch(t){return console.log("\uD83E\uDDEA Test WebCodecs engine failed, using stable engine:",t),this.createStableEngine(e)}}static async createWebCodecsEngine(e,t){try{let{WebCodecsExportEngine:r}=await a.e(890).then(a.bind(a,8890));this.memoryMonitor.getMemoryStatus();let s=this.memoryMonitor.getOptimalExportSettings("1080p",e.duration);console.log("\uD83D\uDE80 Creating WebCodecs engine (".concat(t,") with ").concat(s.qualityLevel," quality settings"));let i=new r({...e,memoryMonitor:this.memoryMonitor,webCodecsSettings:{type:t,...s}});return await i.initialize(),i}catch(a){return console.warn("Failed to create ".concat(t," WebCodecs engine:"),a),this.createStableEngine(e)}}static async createEngineByPreference(e,t){switch(console.log("\uD83C\uDFAF Creating engine based on user preference: ".concat(e)),e){case"stable":return this.createStableEngine(t);case"parallel":return this.createParallelEngine(t);case"webcodecs":return await this.createTestEngine(t);default:return await this.createOptimalEngine(t)}}static async getEngineCapabilities(){try{let[e,t,a]=await Promise.all([rT.w.getCapabilities(),this.memoryMonitor.getMemoryStatus(),rT.w.getStatusMessage()]),r="auto";return t.shouldEmergencyCleanup?r="stable":e.hardwareAcceleration&&(r="auto"),{webcodecs:e.webcodecs,hardwareAcceleration:e.hardwareAcceleration,memoryStatus:this.memoryMonitor.getMemoryStatusString(),recommendedEngine:r,statusMessage:a}}catch(e){return console.warn("Failed to get engine capabilities:",e),{webcodecs:!1,hardwareAcceleration:!1,memoryStatus:"Unknown",recommendedEngine:"stable",statusMessage:"⚠️ Using stable optimized engine"}}}static validateExportSettings(e,t,a){let r=this.memoryMonitor.getMemoryStatus(),s=[];if(r.availableGB<2){let e=this.memoryMonitor.getOptimalExportSettings(a,t);return s.push("Memory low (".concat(r.currentUsageGB,"GB used), reducing quality to prevent crashes")),{valid:!0,adjustedSettings:e,warnings:s}}return r.shouldTriggerGC&&s.push("Memory usage high (".concat(r.percentageUsed,"%), export may be slower")),{valid:!0,warnings:s}}static async cleanup(){try{await this.memoryMonitor.optimizeMemoryUsage(),console.log("\uD83E\uDDF9 Export engine factory cleanup completed")}catch(e){console.warn("Export engine factory cleanup failed:",e)}}}rI.memoryMonitor=new rk.l;var rM=a(5655);function rA(){let{settings:e,progress:t,updateSettings:a,updateProgress:r,resetExport:n,isDialogOpen:l,setDialogOpen:o}=a7(),{tracks:d,getTotalDuration:c}=(0,tU.A)(),{activeProject:m}=(0,eh.I)(),{mediaItems:u}=(0,P.useMediaStore)(),p=(0,i.useRef)(null),[h,g]=(0,i.useState)(e.format),[f,x]=(0,i.useState)(e.quality),[v,b]=(0,i.useState)(e.filename),[y,w]=(0,i.useState)(null),[j,N]=(0,i.useState)("info"),[E,S]=(0,i.useState)("auto"),[C,T]=(0,i.useState)("Detecting capabilities..."),[k,M]=(0,i.useState)(null),A=t.isExporting,R=t.progress,D=t.status,L=e=>e.trim().length>0&&!/[<>:"/\\|?*]/.test(e),z=(e=>{switch(e){case a3.y.HIGH:return{width:1920,height:1080,label:"1920\xd71080"};case a3.y.MEDIUM:return{width:1280,height:720,label:"1280\xd7720"};case a3.y.LOW:return{width:854,height:480,label:"854\xd7480"};default:return{width:1920,height:1080,label:"1920\xd71080"}}})(f),F=(e=>{switch(e){case a3.y.HIGH:return"~50-100 MB/min";case a3.y.MEDIUM:return"~25-50 MB/min";case a3.y.LOW:return"~15-25 MB/min";default:return"~50-100 MB/min"}})(f),_=c();(0,i.useEffect)(()=>{a({format:h,quality:f,filename:v,width:z.width,height:z.height})},[h,f,v,z.width,z.height,a]),(0,i.useEffect)(()=>{(async()=>{try{let e=await rI.getEngineCapabilities();M(e),T(e.statusMessage),e.recommendedEngine!==E&&S(e.recommendedEngine)}catch(e){console.warn("Failed to check engine capabilities:",e),T("⚠️ Using stable optimized engine"),S("stable")}})()},[]),(0,i.useEffect)(()=>{(()=>{let e=c(),t=(null==m?void 0:m.fps)||30,a=(0,rM.Ml)(z.width,z.height,e,t),r=rM.aW.checkFileSafety(a);if(r)w(r.message),N(r.level),"error"===r.level&&"stable"!==E&&(S("stable"),T("⚠️ Memory critical - forced stable engine"));else{let e=(0,rM.pl)(a);w(e),e.includes("Consider using FFmpeg")?N("error"):e.includes("Monitor memory")?N("warning"):(e.includes("acceptable"),N("info"))}})()},[f,c,null==m?void 0:m.fps,z.width,z.height,E]);let O=async()=>{var t,a;if(console.log("\uD83C\uDFAC EXPORT-DIALOG: Export button clicked"),(null==(t=p.current)?void 0:t.getCanvas())&&!A)try{r({isExporting:!0,progress:0,status:"Initializing export..."});let t=null==(a=p.current)?void 0:a.getCanvas();if(!t)throw Error("Canvas not available");let s=d.flatMap(e=>e.elements),i=s.filter(e=>"media"===e.type),n=i.filter(e=>{var t;let a=u.find(t=>t.id===e.mediaId);return(null==a||null==(t=a.metadata)?void 0:t.source)==="text2image"});console.log("\uD83D\uDCCA EXPORT-DIALOG: Export content analysis",{totalElements:s.length,mediaElements:i.length,generatedImages:n.length,regularMedia:i.length-n.length,textElements:s.filter(e=>"text"===e.type).length,mediaItemsCount:u.length,generatedMediaItems:u.filter(e=>{var t;return(null==(t=e.metadata)?void 0:t.source)==="text2image"}).length}),n.length>0&&console.log("\uD83D\uDDBC️ EXPORT-DIALOG: Generated images to export:",n.map(e=>{var t,a;let r=u.find(t=>t.id===e.mediaId);return{elementId:e.id,mediaId:e.mediaId,mediaName:null==r?void 0:r.name,hasUrl:!!(null==r?void 0:r.url),urlType:(null==r||null==(t=r.url)?void 0:t.startsWith("data:"))?"data":(null==r||null==(a=r.url)?void 0:a.startsWith("blob:"))?"blob":"other",position:{start:e.startTime,duration:e.duration}}})),console.log("\uD83C\uDFED EXPORT-DIALOG: Creating export engine with:",{engineType:E,mediaItemsCount:u.length,generatedImagesCount:u.filter(e=>{var t;return(null==(t=e.metadata)?void 0:t.source)==="text2image"}).length,timelineElementsCount:d.flatMap(e=>e.elements).length,duration:c(),fps:(null==m?void 0:m.fps)||30});let l=await rI.createEngineByPreference(E,{canvas:t,settings:{...e,format:h,quality:f,filename:v,width:z.width,height:z.height},timelineElements:d.flatMap(e=>e.elements),mediaItems:u,duration:c(),fps:(null==m?void 0:m.fps)||30,onProgress:(e,t)=>{r({isExporting:!0,progress:e,status:t}),(t.includes("\uD83D\uDCBE")||t.includes("⚠️")||t.includes("WebCodecs"))&&(w(t),t.includes("WebCodecs")?N("info"):N("warning"))},onError:e=>{r({isExporting:!1,status:"Error: ".concat(e)})}});console.log("\uD83D\uDE80 EXPORT-DIALOG: Starting export...");let g=await l.startExport(),x="".concat(v,".").concat(h);console.log("✅ EXPORT-DIALOG: Export completed",{blobSize:g.size,blobType:g.type,filename:x}),await rC.N.createDownloadLink(g,x),r({isExporting:!1,progress:100,status:"Export complete!"}),setTimeout(()=>o(!1),1e3)}catch(t){let e=t instanceof Error?t.message:"Unknown error";if(e.includes("File too large")||e.includes("Memory")||e.includes("MemoryError")){let e=Math.round((0,rM.Ml)(z.width,z.height,c(),(null==m?void 0:m.fps)||30)/3145728);e>2600?(r({isExporting:!1,status:"File too large (".concat(e,"MB) - Use desktop app or compress video")}),w("This file exceeds browser limits. Try the desktop version or reduce file size/quality."),N("error")):e>1300?(r({isExporting:!1,status:"Large file warning (".concat(e,"MB) - Consider reducing quality")}),w("Large file detected. Try reducing quality to 720p or lower for better performance."),N("critical")):(r({isExporting:!1,status:"Memory issue - Close other tabs and try again"}),w("Memory issue detected. Close other browser tabs and try exporting again."),N("warning"))}else r({isExporting:!1,status:"Error: ".concat(e)}),"auto"===E&&(w("".concat(e,' - Try switching to "Stable Mode" in export options.')),N("error"))}};return(0,s.jsxs)("div",{className:"h-full bg-background rounded-xl",children:[(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-sm font-semibold ml-[5px]",children:"Export Video"}),(0,s.jsx)("p",{className:"text-[13px] text-muted-foreground mt-1 ml-[5px]",children:"Configure your export settings and render your video."})]}),(0,s.jsx)(I.$,{variant:"text",size:"icon",onClick:()=>{A||o(!1)},className:"h-9 w-9 rounded-lg bg-transparent hover:bg-transparent",children:(0,s.jsx)(eX.A,{className:"h-5 w-5"})})]}),(0,s.jsx)("div",{className:"p-6 border-b border-border",children:(0,s.jsxs)(I.$,{variant:"shimmer",size:"lg",onClick:O,disabled:A||!L(v)||"error"===j||0===_,className:"w-full",children:[(0,s.jsx)(eF.A,{style:{width:"12px",height:"12px",marginRight:"8px"}}),A?"Exporting...":"Export Video"]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 ml-[5px]",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",children:"Format"}),(0,s.jsxs)(eP,{value:h,onValueChange:e=>g(e),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:a3.A.MP4,id:"mp4"}),(0,s.jsx)(ek.J,{htmlFor:"mp4",className:"ml-2 text-[13px]",children:"MP4 (Recommended)"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:a3.A.WEBM,id:"webm"}),(0,s.jsx)(ek.J,{htmlFor:"webm",className:"ml-2 text-[13px]",children:"WebM"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:a3.A.MOV,id:"mov"}),(0,s.jsx)(ek.J,{htmlFor:"mov",className:"ml-2 text-[13px]",children:"MOV"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",style:{marginTop:"10px"},children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",children:"Quality"}),(0,s.jsxs)(eP,{value:f,onValueChange:e=>x(e),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:a3.y.HIGH,id:"1080p"}),(0,s.jsx)(ek.J,{htmlFor:"1080p",className:"ml-2 text-[13px]",children:"1080p (High Quality)"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:a3.y.MEDIUM,id:"720p"}),(0,s.jsx)(ek.J,{htmlFor:"720p",className:"ml-2 text-[13px]",children:"720p (Medium Quality)"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:a3.y.LOW,id:"480p"}),(0,s.jsx)(ek.J,{htmlFor:"480p",className:"ml-2 text-[13px]",children:"480p (Low Quality)"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",style:{marginTop:"10px"},children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",children:"Export Engine"}),(0,s.jsxs)(eP,{value:E,onValueChange:e=>S(e),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:"auto",id:"auto"}),(0,s.jsx)(ek.J,{htmlFor:"auto",className:"text-[13px] ml-2",children:"Auto (Recommended) - Best available"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:"stable",id:"stable"}),(0,s.jsx)(ek.J,{htmlFor:"stable",className:"text-[13px] ml-2",children:"Stable Mode - Proven optimized"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:"parallel",id:"parallel"}),(0,s.jsx)(ek.J,{htmlFor:"parallel",className:"text-[13px] ml-2",children:"Parallel Processing - 5-10x faster"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eD,{value:"webcodecs",id:"webcodecs"}),(0,s.jsx)(ek.J,{htmlFor:"webcodecs",className:"text-[13px] ml-2",children:"WebCodecs (Experimental) - Force new"})]})]}),(0,s.jsx)("div",{className:"p-3 bg-muted rounded-lg",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-[12px] font-medium",children:"Engine Status:"}),(0,s.jsx)("p",{className:"text-[12px] text-muted-foreground",children:C}),k&&(0,s.jsxs)("div",{className:"text-[12px] text-muted-foreground space-y-1",children:[k.memoryStatus&&(0,s.jsxs)("div",{children:["Memory: ",k.memoryStatus]}),k.hardwareAcceleration&&(0,s.jsx)("div",{className:"text-green-600",children:"✅ Hardware acceleration available"})]})]})})]}),(0,s.jsxs)("div",{className:"space-y-3",style:{marginTop:"10px"},children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",children:"Resolution & Size"}),(0,s.jsxs)("div",{className:"p-3 bg-muted rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-[12px] font-medium",children:"Resolution:"}),(0,s.jsx)("span",{className:"text-[12px]",children:z.label})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-[12px] font-medium",children:"Est. size:"}),(0,s.jsx)("span",{className:"text-[12px] text-muted-foreground",children:F})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-[12px] font-medium",children:"Memory:"}),(0,s.jsx)("span",{className:"text-[12px] text-muted-foreground",children:rM.aW.getMemorySummary()})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",htmlFor:"filename",children:"Filename"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(Y.p,{id:"filename",value:v,onChange:e=>b(e.target.value),placeholder:"Enter filename",className:L(v)?"":"border-red-500"}),(0,s.jsxs)("span",{className:"text-[12px] text-muted-foreground",children:[".",h]})]}),!L(v)&&(0,s.jsx)("p",{className:"text-[12px] text-red-500",children:'Invalid filename. Avoid special characters: < > : " / \\ | ? *'})]}),(0,s.jsxs)("div",{className:"space-y-3",style:{marginTop:"10px"},children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",children:"Export Duration"}),(0,s.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-[12px] font-medium",children:"Timeline duration:"}),(0,s.jsxs)("span",{className:"text-[12px]",children:[_.toFixed(2),"s"]})]}),0===_&&(0,s.jsx)("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-[12px]",children:(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)("span",{className:"text-red-600",children:"❌"}),(0,s.jsxs)("div",{className:"text-red-800",children:[(0,s.jsx)("div",{className:"font-medium",children:"No Content"}),(0,s.jsx)("div",{children:"Your timeline is empty. Add some media files to export a video."})]})]})})]})]}),y&&(0,s.jsx)(rj.Fc,{className:"".concat("error"===j?"border-red-500 bg-red-50 dark:bg-red-950":"critical"===j?"border-orange-500 bg-orange-50 dark:bg-orange-950":"warning"===j?"border-red-500 bg-red-50 dark:bg-red-950":"border-blue-500 bg-blue-50 dark:bg-blue-950"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:["error"===j||"critical"===j?(0,s.jsx)(rN.A,{className:"h-4 w-4 ".concat("error"===j?"text-red-600 dark:text-red-400":"text-orange-600 dark:text-orange-400")}):"warning"===j?(0,s.jsx)(rN.A,{className:"h-4 w-4 text-red-600 dark:text-red-400"}):(0,s.jsx)(rE.A,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,s.jsx)(rj.TN,{className:"text-[13px] ".concat("error"===j?"text-red-800 dark:text-red-200":"critical"===j?"text-orange-800 dark:text-orange-200":"warning"===j?"text-red-800 dark:text-red-200":"text-blue-800 dark:text-blue-200"),children:y})]})}),A&&(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(ek.J,{className:"text-[13px] font-medium",children:"Export Progress"}),(0,s.jsxs)("span",{className:"text-[12px] text-muted-foreground",children:[R.toFixed(0),"%"]})]}),(0,s.jsx)(rw,{value:R,className:"w-full"}),(0,s.jsx)("p",{className:"text-[12px] text-muted-foreground",children:D})]})})]}),(0,s.jsx)("div",{className:"border-t border-border p-6",children:(0,s.jsxs)(I.$,{variant:"outline",onClick:()=>{A||o(!1)},disabled:A,className:"w-full h-11 text-[13px] font-medium !bg-transparent hover:!bg-transparent",children:[(0,s.jsx)(eX.A,{className:"h-4 w-4 mr-2.5"}),"Cancel"]})})]}),(0,s.jsx)(rS,{ref:p,settings:e,className:"export-canvas"})]})}let rR=0;function rP(){var e;let{toolsPanel:t,previewPanel:a,mainContent:r,timeline:l,setToolsPanel:o,setPreviewPanel:u,setMainContent:p,setTimeline:h,propertiesPanel:g,setPropertiesPanel:f,mainContentHeight:x,setMainContentHeight:v,timelineHeight:b,setTimelineHeight:y,setAiPanelWidth:w,getAiPanelSizeForTab:j}=k(),{activeTab:N}=S(),{activeProject:E,loadProject:C,createNewProject:T}=(0,eh.I)(),{isDialogOpen:I}=a7(),M=(0,n.useRouter)(),A=(0,i.useCallback)(C,[]),R=(0,i.useCallback)(T,[]),{project_id:P}=M.query,D=Array.isArray(P)?P[0]:P,L="string"==typeof M.query.project_id?M.query.project_id:null,z=null!=(e=null!=D?D:L)?e:"";(0,i.useEffect)(()=>{U.w.log("EditorPage","PROJECT_ID_CHANGED",{projectIdParam:D,projectIdQuery:L,finalProjectId:z,routerReady:M.isReady,routerQuery:M.query})},[z,M.isReady]),rb(),(0,i.useEffect)(()=>(rR++,U.w.log("EditorPage","COMPONENT_MOUNT_UPDATE",{renderCount:rR,projectId:z,activeProjectId:null==E?void 0:E.id,location:window.location.href}),()=>{U.w.log("EditorPage","COMPONENT_UNMOUNT",{renderCount:rR,projectId:z,reason:"Component cleanup"})}),[]),(0,i.useEffect)(()=>{let e=e=>{let t=Error().stack;U.w.log("Router","ROUTE_CHANGE_START",{newUrl:e,currentUrl:M.asPath,currentProjectId:null==E?void 0:E.id,callStack:t,trigger:"navigation_detected"})},t=e=>{U.w.log("Router","ROUTE_CHANGE_COMPLETE",{newUrl:e,previousUrl:M.asPath,currentProjectId:null==E?void 0:E.id})},a=(e,t)=>{U.w.log("Router","ROUTE_CHANGE_ERROR",{error:e.message,targetUrl:t,currentUrl:M.asPath,currentProjectId:null==E?void 0:E.id})};return M.events.on("routeChangeStart",e),M.events.on("routeChangeComplete",t),M.events.on("routeChangeError",a),()=>{M.events.off("routeChangeStart",e),M.events.off("routeChangeComplete",t),M.events.off("routeChangeError",a)}},[M,null==E?void 0:E.id]),(0,i.useEffect)(()=>{let e=e=>{var t,a;U.w.log("Window","ERROR",{error:null==(t=e.error)?void 0:t.message,stack:null==(a=e.error)?void 0:a.stack,filename:e.filename,lineno:e.lineno}),"electronDebug"in window&&window.electronDebug&&window.electronDebug.logError(e.error)},t=e=>{U.w.log("Window","UNHANDLED_PROMISE_REJECTION",{reason:e.reason})};return window.addEventListener("error",e),window.addEventListener("unhandledrejection",t),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",t)}},[]);let F=(0,i.useRef)(!1);return((0,i.useEffect)(()=>(U.w.log("EditorPage","PROJECT_INIT_EFFECT",{projectId:z,hasActiveProject:!!E,activeProjectId:null==E?void 0:E.id,needsLoad:z&&(!E||E.id!==z),renderCount:rR}),z)?E&&E.id===z?void U.w.log("EditorPage","PROJECT_ALREADY_LOADED",{activeProjectId:E.id,requestedProjectId:z}):void(async()=>{if(U.w.log("EditorPage","STARTING_PROJECT_LOAD",{projectId:z}),!F.current){let e=z.startsWith("project-")&&(/^project-\d{13}$/.test(z)||"project-1753087892498"===z);if(U.w.log("EditorPage","FALLBACK_DETECTION",{projectId:z,startsWithProject:z.startsWith("project-"),regexTest:/^project-\d{13}$/.test(z),isFallbackProjectId:e,projectIdLength:z.length,fallbackCheckAlreadyDone:F.current}),F.current=!0,e){U.w.log("EditorPage","FALLBACK_PROJECT_DETECTED",{projectId:z,redirectAction:"projects"}),localStorage.removeItem("opencut-fallback-project"),U.w.log("EditorPage","NAVIGATING_TO_PROJECTS",{reason:"fallback_project",projectId:z}),setTimeout(()=>M.replace("/projects"),100);return}}try{await A(z),U.w.log("EditorPage","PROJECT_LOAD_SUCCESS",{projectId:z})}catch(a){U.w.log("EditorPage","PROJECT_LOAD_FAILED",{projectId:z,error:a instanceof Error?a.message:"Unknown error"});let e=localStorage.getItem("opencut-fallback-project");if(e)try{let t=JSON.parse(e);if(t.id===z){U.w.log("EditorPage","USING_FALLBACK_PROJECT",{projectName:t.name});let e=await R(t.name);localStorage.removeItem("opencut-fallback-project"),U.w.log("EditorPage","NAVIGATING_TO_FALLBACK_PROJECT",{newProjectId:e}),setTimeout(()=>M.replace("/editor/project/".concat(e)),100);return}}catch(e){U.w.log("EditorPage","FALLBACK_PROJECT_PARSE_ERROR",{error:e instanceof Error?e.message:"Unknown parse error"})}U.w.log("EditorPage","CREATING_NEW_FALLBACK_PROJECT",{});let t=await R("New Project");U.w.log("EditorPage","NAVIGATING_TO_NEW_PROJECT",{oldProjectId:z,newProjectId:t,currentLocation:window.location.href}),setTimeout(()=>M.replace("/editor/project/".concat(t)),100)}})():void U.w.log("EditorPage","NO_PROJECT_ID"),[z]),E)?(U.w.log("EditorPage","RENDERING_EDITOR_INTERFACE",{projectId:z,activeProjectId:null==E?void 0:E.id,projectName:null==E?void 0:E.name,renderCount:rR}),(0,s.jsxs)("div",{className:"h-screen bg-background",children:[(0,s.jsx)(rx,{}),(0,s.jsxs)(d,{direction:"vertical",className:"flex-1",children:[(0,s.jsx)(c,{defaultSize:x,minSize:60,maxSize:85,onResize:e=>v(e),children:(0,s.jsx)("div",{className:"h-full overflow-hidden p-4",children:(0,s.jsxs)(d,{direction:"horizontal",className:"h-full gap-6",children:[(0,s.jsx)(c,{defaultSize:j(N||"media").defaultSize||22,minSize:j(N||"media").minSize||4,maxSize:j(N||"media").maxSize||30,onResize:e=>{let t="number"!=typeof e||isNaN(e)?22:e;o(t),"ai"===N&&w(t)},children:(0,s.jsx)("div",{className:"h-full rounded-xl overflow-hidden",style:{borderTop:"2px solid #ff6b6b",borderRight:"2px solid #4ecdc4",borderBottom:"2px solid #45b7d1",borderLeft:"2px solid #96ceb4"},children:(0,s.jsx)(tF,{})})}),(0,s.jsx)(t_,{}),(0,s.jsx)(c,{defaultSize:r,minSize:30,onResize:e=>p(e),children:(0,s.jsx)("div",{className:"h-full rounded-xl overflow-hidden",style:{borderTop:"2px solid #ff6b6b",borderRight:"2px solid #4ecdc4",borderBottom:"2px solid #45b7d1",borderLeft:"2px solid #96ceb4"},children:(0,s.jsx)(aQ,{})})}),(0,s.jsx)(m,{withHandle:!0}),(0,s.jsx)(c,{defaultSize:g,minSize:15,maxSize:35,onResize:e=>f(e),children:(0,s.jsx)("div",{className:"h-full rounded-xl overflow-hidden",style:{borderTop:"2px solid #ff6b6b",borderRight:"2px solid #4ecdc4",borderBottom:"2px solid #45b7d1",borderLeft:"2px solid #96ceb4"},children:I?(0,s.jsx)(rA,{}):(0,s.jsx)(tZ,{})})})]})})}),(0,s.jsx)(m,{withHandle:!0}),(0,s.jsx)(c,{defaultSize:b,minSize:15,maxSize:40,onResize:e=>y(e),children:(0,s.jsx)("div",{className:"p-4 pt-2 h-full",children:(0,s.jsx)("div",{className:"h-full rounded-xl overflow-hidden",style:{borderTop:"2px solid #ff6b6b",borderRight:"2px solid #4ecdc4",borderBottom:"2px solid #45b7d1",borderLeft:"2px solid #96ceb4"},children:(0,s.jsx)(ax,{})})})})]})]})):(U.w.log("EditorPage","RENDERING_LOADING_SCREEN",{projectId:z,hasActiveProject:!!E,renderCount:rR}),(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading project..."})]})}))}function rD(){return(0,s.jsx)(rv,{children:(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading editor..."})]})}),children:(0,s.jsx)(rP,{})})})}},5655:(e,t,a)=>{"use strict";a.d(t,{Ml:()=>i,aW:()=>s,pl:()=>n});class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}getMemoryInfo(){if(!this.isMemoryAPISupported())return null;let e=performance.memory,t=e.usedJSHeapSize/e.jsHeapSizeLimit*100,a=e.jsHeapSizeLimit-e.usedJSHeapSize;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit,usedPercent:t,availableMemory:a}}isMemoryAPISupported(){return"undefined"!=typeof performance&&void 0!==performance.memory}startMonitoring(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;this.isMonitoring||(this.isMonitoring=!0,this.monitorInterval=setInterval(()=>{this.checkMemoryUsage()},e),console.log("\uD83D\uDD0D Memory monitoring started"))}stopMonitoring(){this.isMonitoring&&(this.isMonitoring=!1,this.monitorInterval&&(clearInterval(this.monitorInterval),this.monitorInterval=null),console.log("\uD83D\uDD0D Memory monitoring stopped"))}checkMemoryUsage(){let e=this.getMemoryInfo();if(!e)return;let t=this.evaluateMemoryUsage(e);t&&(this.warnings.push(t),console.warn("\uD83D\uDCBE Memory Warning [".concat(t.level,"]:"),t.message))}evaluateMemoryUsage(e){let{usedPercent:t}=e;return t>=this.THRESHOLDS.ERROR?{level:"error",message:"Critical memory usage: ".concat(t.toFixed(1),"%"),recommendation:"Operation blocked. Please close other tabs or reduce file size.",canContinue:!1}:t>=this.THRESHOLDS.CRITICAL?{level:"critical",message:"High memory usage: ".concat(t.toFixed(1),"%"),recommendation:"Consider reducing video quality or duration to prevent crashes.",canContinue:!0}:t>=this.THRESHOLDS.WARNING?{level:"warning",message:"Elevated memory usage: ".concat(t.toFixed(1),"%"),recommendation:"Monitor memory usage. Consider reducing quality for large files.",canContinue:!0}:t>=this.THRESHOLDS.INFO?{level:"info",message:"Memory usage: ".concat(t.toFixed(1),"%"),recommendation:"Memory usage is being monitored.",canContinue:!0}:null}checkFileSafety(e){let t=this.getMemoryInfo();if(!t)return{level:"warning",message:"Cannot determine memory usage",recommendation:"Proceed with caution - memory monitoring unavailable",canContinue:!0};let a=e/1024/1024,r=Math.max(t.availableMemory/1024/1024,4915.2),s=3*a;return(console.log("\uD83D\uDD0D MEMORY-MONITOR: File size check for ".concat(a.toFixed(1),"MB file:"),{estimatedMemoryNeeded:s.toFixed(1)+"MB",browserAvailableMemory:(t.availableMemory/1024/1024).toFixed(1)+"MB",overrideAvailableMemory:r.toFixed(1)+"MB",maxAllowedMemory:"8192MB"}),a>2734.08)?{level:"error",message:"File too large: ".concat(a.toFixed(1),"MB exceeds 8GB processing limit"),recommendation:"Use desktop app or compress video for files this large",canContinue:!1}:s>4096?{level:"critical",message:"Large file: ".concat(a.toFixed(1),"MB requires ").concat(s.toFixed(1),"MB processing memory"),recommendation:"Consider reducing quality or duration. May cause performance issues.",canContinue:!0}:s>2048?{level:"warning",message:"Large file: ".concat(a.toFixed(1),"MB requires ").concat(s.toFixed(1),"MB processing memory"),recommendation:"Monitor memory usage during processing. Close other tabs if needed.",canContinue:!0}:a>500?{level:"info",message:"Processing ".concat(a.toFixed(1),"MB file (estimated ").concat(s.toFixed(1),"MB memory needed)"),recommendation:"File size is acceptable for browser processing",canContinue:!0}:null}getRecentWarnings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return this.warnings.slice(-e)}clearWarnings(){this.warnings=[]}getMemorySummary(){let e=this.getMemoryInfo();if(!e)return"Memory monitoring unavailable";let t=e.usedJSHeapSize/1024/1024,a=e.jsHeapSizeLimit/1024/1024,r=e.usedPercent;return"Memory: ".concat(t.toFixed(1),"MB / ").concat(a.toFixed(1),"MB (").concat(r.toFixed(1),"%)")}canPerformOperation(e){let t=this.getMemoryInfo();return!t||!(e>.8*(t.availableMemory/1024/1024))}constructor(){this.warnings=[],this.isMonitoring=!1,this.monitorInterval=null,this.THRESHOLDS={INFO:50,WARNING:70,CRITICAL:85,ERROR:95}}}let s=r.getInstance();function i(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;return e*t*4*(a*r)*.5}function n(e){let t=e/1024/1024;return t>200?"Consider using FFmpeg offline export for large files":t>100?"Monitor memory usage during export":t>50?"File size is acceptable for browser processing":"File size is optimal for browser processing"}},6225:(e,t,a)=>{"use strict";a.d(t,{H:()=>i});var r=a(6029),s=a(2185);function i(e){let{leftContent:t,centerContent:a,rightContent:i,className:n,children:l,style:o}=e;return l?(0,r.jsx)("header",{className:(0,s.cn)("px-6 h-16 flex items-center",n),style:o,children:l}):(0,r.jsxs)("header",{className:(0,s.cn)("px-6 h-14 flex justify-between items-center",n),style:o,children:[t&&(0,r.jsx)("div",{className:"flex items-center",children:t}),a&&(0,r.jsx)("div",{className:"flex items-center",children:a}),i&&(0,r.jsx)("div",{className:"flex items-center",children:i})]})}},6949:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>l});var r=a(6029),s=a(5729),i=a(2185);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground",a),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",a),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("font-semibold leading-none tracking-tight",a),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},7997:(e,t,a)=>{"use strict";a.d(t,{w:()=>r});class r{static async checkSupport(){if(!("VideoEncoder"in window))return{supported:!1,codecs:[],hardwareAcceleration:!1,limitations:["WebCodecs API not available"]};let e=[],t=[];for(let r of this.SUPPORTED_CODECS)try{let t=await VideoEncoder.isConfigSupported({codec:r,width:1920,height:1080,bitrate:8e6,framerate:30,hardwareAcceleration:"prefer-hardware"});if(t.supported){var a;e.push({codec:r,config:t.config,hardwareAcceleration:(null==(a=t.config)?void 0:a.hardwareAcceleration)==="prefer-hardware"})}}catch(e){console.warn("Codec ".concat(r," test failed:"),e),t.push("Codec ".concat(r," test failed"))}return{supported:e.length>0,codecs:e.map(e=>e.codec),hardwareAcceleration:e.some(e=>e.hardwareAcceleration),limitations:0===e.length?["No supported codecs"]:t}}static shouldUseWebCodecs(){try{return"VideoEncoder"in window&&"VideoFrame"in window}catch(e){return console.warn("WebCodecs detection failed, using fallback:",e),!1}}static async safeWebCodecsCheck(){try{if(!this.shouldUseWebCodecs())return!1;return(await this.checkSupport()).supported}catch(e){return console.warn("WebCodecs compatibility check failed, falling back to existing system:",e),!1}}static async getCapabilities(){try{if(!await this.safeWebCodecsCheck())return{webcodecs:!1,hardwareAcceleration:!1,supportedCodecs:[],maxResolution:{width:1920,height:1080},recommendedEngine:"optimized"};let e=await this.checkSupport();return{webcodecs:e.supported,hardwareAcceleration:e.hardwareAcceleration,supportedCodecs:e.codecs,maxResolution:e.hardwareAcceleration?{width:3840,height:2160}:{width:1920,height:1080},recommendedEngine:e.hardwareAcceleration?"webcodecs":"optimized"}}catch(e){return console.warn("Failed to get WebCodecs capabilities:",e),{webcodecs:!1,hardwareAcceleration:!1,supportedCodecs:[],maxResolution:{width:1920,height:1080},recommendedEngine:"optimized"}}}static async getStatusMessage(){try{let e=await this.getCapabilities();if(!e.webcodecs)return"⚠️ WebCodecs not available, using optimized engine";if(e.hardwareAcceleration)return"✅ WebCodecs with hardware acceleration available (".concat(e.supportedCodecs.length," codecs)");return"✅ WebCodecs software encoding available (".concat(e.supportedCodecs.length," codecs)")}catch(e){return"⚠️ Using stable optimized engine"}}static async hasHardwareAcceleration(){try{return(await this.checkSupport()).hardwareAcceleration}catch(e){return!1}}static async getBestCodec(){try{let e=await this.checkSupport();if(!e.supported)return null;if(e.codecs.includes("avc1.42001E"))return"avc1.42001E";return e.codecs[0]||null}catch(e){return console.warn("Failed to get best codec:",e),null}}}r.SUPPORTED_CODECS=["avc1.42001E","avc1.42401E","avc1.4D401E","avc1.64001E","hev1.1.6.L93.B0","av01.0.04M.08"]},8622:(e,t,a)=>{"use strict";a.r(t),a.d(t,{FPS_PRESETS:()=>m,TIMELINE_CONSTANTS:()=>c,TRACK_COLORS:()=>r,TRACK_HEIGHTS:()=>n,frameToTime:()=>p,getCumulativeHeightBefore:()=>o,getFrameDuration:()=>g,getTotalTracksHeight:()=>d,getTrackColors:()=>s,getTrackElementClasses:()=>i,getTrackHeight:()=>l,snapTimeToFrame:()=>h,timeToFrame:()=>u});let r={media:{solid:"bg-blue-500",background:"bg-blue-500/20",border:"border-white/80"},text:{solid:"bg-[#9C4937]",background:"bg-[#9C4937]",border:"border-white/80"},audio:{solid:"bg-green-500",background:"bg-green-500/20",border:"border-white/80"}};function s(e){return r[e]}function i(e){let t=r[e];return"".concat(t.background," ").concat(t.border)}let n={media:85,text:35,audio:65};function l(e){return n[e]}function o(e,t){return e.slice(0,t).reduce((e,t)=>e+n[t.type]+4,0)}function d(e){return e.reduce((e,t)=>e+n[t.type],0)+4*Math.max(0,e.length-1)}let c={ELEMENT_MIN_WIDTH:80,PIXELS_PER_SECOND:80,TRACK_HEIGHT:60,DEFAULT_TEXT_DURATION:5,ZOOM_LEVELS:[.25,.5,1,1.5,2,3,4],CURSOR_OFFSET_PX:200},m=[{value:"24",label:"24 fps (Film)"},{value:"25",label:"25 fps (PAL)"},{value:"30",label:"30 fps (NTSC)"},{value:"60",label:"60 fps (High)"},{value:"120",label:"120 fps (Slow-mo)"}];function u(e,t){return Math.round(e*t)}function p(e,t){return e/t}function h(e,t){return t<=0?e:u(e,t)/t}function g(e){return 1/e}},9221:(e,t,a)=>{"use strict";a.d(t,{D:()=>n,T:()=>i});var r=a(4011),s=a(1642).hp;class i{async startRecording(){console.log("\uD83D\uDE80 FFmpegVideoRecorder: Starting recording and initializing FFmpeg...");try{await (0,r.ml)(),this.ffmpegReady=!0,console.log("✅ FFmpeg loaded successfully")}catch(e){throw console.error("❌ Failed to load FFmpeg:",e),Error("Failed to initialize FFmpeg: ".concat(e))}this.frames=[]}async addFrame(e,t){if(!this.ffmpegReady)throw Error("FFmpeg not initialized. Call startRecording() first.");let a=e.split(",",2)[1],r=new Uint8Array(s.from(a,"base64")),i="frame-".concat(String(t).padStart(5,"0"),".png");this.frames.push({name:i,data:r})}async stopRecording(){if(!this.ffmpegReady)throw Error("FFmpeg not initialized. Call startRecording() first.");console.log("\uD83C\uDFAC Encoding ".concat(this.frames.length," frames to video..."));try{let e="webm"===this.settings.format?"webm":"mp4",t=await (0,r.Rx)(this.frames,{fps:this.fps,format:e});return console.log("✅ Video encoding completed successfully"),this.frames=[],t}catch(e){throw console.error("❌ Video encoding failed:",e),Error("Video encoding failed: ".concat(e))}}setAudioStream(e){}cleanup(){this.frames=[],this.ffmpegReady=!1}constructor(e){this.frames=[],this.ffmpegReady=!1,this.fps=e.fps,this.settings=e.settings}}let n=()=>!0}},e=>{var t=t=>e(e.s=t);e.O(0,[128,588,159,8,636,593,792],()=>t(5061)),_N_E=e.O()}]);