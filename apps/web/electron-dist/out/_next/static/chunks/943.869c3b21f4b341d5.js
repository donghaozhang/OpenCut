"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{5943:(t,e,s)=>{s.d(e,{ArrayBufferTarget:()=>ec,Muxer:()=>ex});var i,a,r,n,o,h,l,f,m,d,c,p,u,w,k,g,C,y,T,b,S,v,x,z,M,B,A,W,U,O,D,E,L,I,j,N,R,V,$,H,_,P,F,q,G,J,K,Q,X,Y,Z,tt,te,ts,ti,ta,tr,tn=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},to=(t,e,s)=>(tn(t,e,"read from private field"),s?s.call(t):e.get(t)),th=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},tl=(t,e,s,i)=>(tn(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),tf=(t,e,s,i)=>({set _(value){tl(t,e,value,s)},get _(){return to(t,e,i)}}),tm=(t,e,s)=>(tn(t,e,"access private method"),s),td=new Uint8Array(8),tc=new DataView(td.buffer),tp=t=>[(t%256+256)%256],tu=t=>(tc.setUint16(0,t,!1),[td[0],td[1]]),tw=t=>(tc.setInt16(0,t,!1),[td[0],td[1]]),tk=t=>(tc.setUint32(0,t,!1),[td[1],td[2],td[3]]),tg=t=>(tc.setUint32(0,t,!1),[td[0],td[1],td[2],td[3]]),tC=t=>(tc.setInt32(0,t,!1),[td[0],td[1],td[2],td[3]]),ty=t=>(tc.setUint32(0,Math.floor(t/0x100000000),!1),tc.setUint32(4,t,!1),[td[0],td[1],td[2],td[3],td[4],td[5],td[6],td[7]]),tT=t=>(tc.setInt16(0,256*t,!1),[td[0],td[1]]),tb=t=>(tc.setInt32(0,65536*t,!1),[td[0],td[1],td[2],td[3]]),tS=t=>(tc.setInt32(0,0x40000000*t,!1),[td[0],td[1],td[2],td[3]]),tv=(t,e=!1)=>{let s=Array(t.length).fill(null).map((e,s)=>t.charCodeAt(s));return e&&s.push(0),s},tx=t=>t&&t[t.length-1],tz=t=>{let e;for(let s of t)(!e||s.presentationTimestamp>e.presentationTimestamp)&&(e=s);return e},tM=(t,e,s=!0)=>{let i=t*e;return s?Math.round(i):i},tB=t=>{let e=Math.PI/180*t,s=Math.cos(e),i=Math.sin(e);return[s,i,0,-i,s,0,0,0,1]},tA=tB(0),tW=t=>[tb(t[0]),tb(t[1]),tS(t[2]),tb(t[3]),tb(t[4]),tS(t[5]),tb(t[6]),tb(t[7]),tS(t[8])],tU=t=>t&&"object"==typeof t?Array.isArray(t)?t.map(tU):Object.fromEntries(Object.entries(t).map(([t,e])=>[t,tU(e)])):t,tO=t=>t>=0&&t<0x100000000,tD=(t,e,s)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:s}),tE=(t,e,s,i,a)=>tD(t,[tp(e),tk(s),i??[]],a),tL=t=>t.fragmented?tD("ftyp",[tv("iso5"),tg(512),tv("iso5"),tv("iso6"),tv("mp41")]):tD("ftyp",[tv("isom"),tg(512),tv("isom"),t.holdsAvc?tv("avc1"):[],tv("mp41")]),tI=t=>({type:"mdat",largeSize:t}),tj=t=>({type:"free",size:t}),tN=(t,e,s=!1)=>tD("moov",null,[tR(e,t),...t.map(t=>tV(t,e)),s?t5(t):null]),tR=(t,e)=>{let s=tM(Math.max(0,...e.filter(t=>t.samples.length>0).map(t=>{let e=tz(t.samples);return e.presentationTimestamp+e.duration})),eT),i=Math.max(...e.map(t=>t.id))+1,a=!tO(t)||!tO(s),r=a?ty:tg;return tE("mvhd",+a,0,[r(t),r(t),tg(eT),r(s),tb(1),tT(1),Array(10).fill(0),tW(tA),Array(24).fill(0),tg(i)])},tV=(t,e)=>tD("trak",null,[t$(t,e),tH(t,e)]),t$=(t,e)=>{let s,i=tz(t.samples),a=tM(i?i.presentationTimestamp+i.duration:0,eT),r=!tO(e)||!tO(a),n=r?ty:tg;return s="video"===t.info.type?"number"==typeof t.info.rotation?tB(t.info.rotation):t.info.rotation:tA,tE("tkhd",+r,3,[n(e),n(e),tg(t.id),tg(0),n(a),Array(8).fill(0),tu(0),tu(0),tT(+("audio"===t.info.type)),tu(0),tW(s),tb("video"===t.info.type?t.info.width:0),tb("video"===t.info.type?t.info.height:0)])},tH=(t,e)=>tD("mdia",null,[t_(t,e),tP("video"===t.info.type?"vide":"soun"),tF(t)]),t_=(t,e)=>{let s=tz(t.samples),i=tM(s?s.presentationTimestamp+s.duration:0,t.timescale),a=!tO(e)||!tO(i),r=a?ty:tg;return tE("mdhd",+a,0,[r(e),r(e),tg(t.timescale),r(i),tu(21956),tu(0)])},tP=t=>tE("hdlr",0,0,[tv("mhlr"),tv(t),tg(0),tg(0),tg(0),tv("mp4-muxer-hdlr",!0)]),tF=t=>tD("minf",null,["video"===t.info.type?tq():tG(),tJ(),tX(t)]),tq=()=>tE("vmhd",0,1,[tu(0),tu(0),tu(0),tu(0)]),tG=()=>tE("smhd",0,0,[tu(0),tu(0)]),tJ=()=>tD("dinf",null,[tK()]),tK=()=>tE("dref",0,0,[tg(1)],[tQ()]),tQ=()=>tE("url ",0,1),tX=t=>{let e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(t=>0!==t.sampleCompositionTimeOffset);return tD("stbl",null,[tY(t),t1(t),t2(t),t8(t),t3(t),t4(t),e?t6(t):null])},tY=t=>tE("stsd",0,0,[tg(1)],["video"===t.info.type?tZ(el[t.info.codec],t):t0(em[t.info.codec],t)]),tZ=(t,e)=>tD(t,[Array(6).fill(0),tu(1),tu(0),tu(0),Array(12).fill(0),tu(e.info.width),tu(e.info.height),tg(4718592),tg(4718592),tg(0),tu(1),Array(32).fill(0),tu(24),tw(65535)],[ef[e.info.codec](e)]),t0=(t,e)=>tD(t,[Array(6).fill(0),tu(1),tu(0),tu(0),tg(0),tu(e.info.numberOfChannels),tu(16),tu(0),tu(0),tb(e.info.sampleRate)],[ed[e.info.codec](e)]),t1=t=>tE("stts",0,0,[tg(t.timeToSampleTable.length),t.timeToSampleTable.map(t=>[tg(t.sampleCount),tg(t.sampleDelta)])]),t2=t=>{if(t.samples.every(t=>"key"===t.type))return null;let e=[...t.samples.entries()].filter(([,t])=>"key"===t.type);return tE("stss",0,0,[tg(e.length),e.map(([t])=>tg(t+1))])},t8=t=>tE("stsc",0,0,[tg(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(t=>[tg(t.firstChunk),tg(t.samplesPerChunk),tg(1)])]),t3=t=>tE("stsz",0,0,[tg(0),tg(t.samples.length),t.samples.map(t=>tg(t.size))]),t4=t=>t.finalizedChunks.length>0&&tx(t.finalizedChunks).offset>=0x100000000?tE("co64",0,0,[tg(t.finalizedChunks.length),t.finalizedChunks.map(t=>ty(t.offset))]):tE("stco",0,0,[tg(t.finalizedChunks.length),t.finalizedChunks.map(t=>tg(t.offset))]),t6=t=>tE("ctts",0,0,[tg(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(t=>[tg(t.sampleCount),tg(t.sampleCompositionTimeOffset)])]),t5=t=>tD("mvex",null,t.map(t9)),t9=t=>tE("trex",0,0,[tg(t.id),tg(1),tg(0),tg(0),tg(0)]),t7=(t,e)=>tD("moof",null,[et(t),...e.map(es)]),et=t=>tE("mfhd",0,0,[tg(t)]),ee=t=>{let e=0,s=0,i="delta"===t.type;return s|=i,i?e|=1:e|=2,e<<24|s<<16},es=t=>tD("traf",null,[ei(t),ea(t),er(t)]),ei=t=>{let e=t.currentChunk.samples[1]??t.currentChunk.samples[0],s={duration:e.timescaleUnitsToNextSample,size:e.size,flags:ee(e)};return tE("tfhd",0,131128,[tg(t.id),tg(s.duration),tg(s.size),tg(s.flags)])},ea=t=>tE("tfdt",1,0,[ty(tM(t.currentChunk.startTimestamp,t.timescale))]),er=t=>{let e,s=t.currentChunk.samples.map(t=>t.timescaleUnitsToNextSample),i=t.currentChunk.samples.map(t=>t.size),a=t.currentChunk.samples.map(ee),r=t.currentChunk.samples.map(e=>tM(e.presentationTimestamp-e.decodeTimestamp,t.timescale)),n=new Set(s),o=new Set(i),h=new Set(a),l=new Set(r),f=2===h.size&&a[0]!==a[1],m=n.size>1,d=o.size>1,c=!f&&h.size>1,p=l.size>1||[...l].some(t=>0!==t);return tE("trun",1,1|4*f|256*m|512*d|1024*c|2048*p,[tg(t.currentChunk.samples.length),tg(t.currentChunk.offset-t.currentChunk.moofOffset||0),f?tg(a[0]):[],t.currentChunk.samples.map((t,e)=>[m?tg(s[e]):[],d?tg(i[e]):[],c?tg(a[e]):[],p?tC(r[e]):[]])])},en=t=>tD("mfra",null,[...t.map(eo),eh()]),eo=(t,e)=>tE("tfra",1,0,[tg(t.id),tg(63),tg(t.finalizedChunks.length),t.finalizedChunks.map(s=>[ty(tM(s.startTimestamp,t.timescale)),ty(s.moofOffset),tg(e+1),tg(1),tg(1)])]),eh=()=>tE("mfro",0,0,[tg(0)]),el={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},ef={avc:t=>t.info.decoderConfig&&tD("avcC",[...new Uint8Array(t.info.decoderConfig.description)]),hevc:t=>t.info.decoderConfig&&tD("hvcC",[...new Uint8Array(t.info.decoderConfig.description)]),vp9:t=>{if(!t.info.decoderConfig)return null;let e=t.info.decoderConfig;if(!e.colorSpace)throw Error("'colorSpace' is required in the decoder config for VP9.");let s=e.codec.split("."),i=Number(s[1]),a=Number(s[2]),r=(Number(s[3])<<4)+0+Number(e.colorSpace.fullRange);return tE("vpcC",1,0,[tp(i),tp(a),tp(r),tp(2),tp(2),tp(2),tu(0)])},av1:()=>tD("av1C",[129,0,0,0])},em={aac:"mp4a",opus:"Opus"},ed={aac:t=>{let e=new Uint8Array(t.info.decoderConfig.description);return tE("esds",0,0,[tg(0x3808080),tp(32+e.byteLength),tu(1),tp(0),tg(0x4808080),tp(18+e.byteLength),tp(64),tp(21),tk(0),tg(130071),tg(130071),tg(0x5808080),tp(e.byteLength),...e,tg(0x6808080),tp(1),tp(2)])},opus:t=>tD("dOps",[tp(0),tp(t.info.numberOfChannels),tu(3840),tg(t.info.sampleRate),tT(0),tp(0)])},ec=class{constructor(){this.buffer=null}},ep=class{constructor(t){this.options=t}},eu=class{constructor(t,e){this.stream=t,this.options=e}},ew=class{constructor(){this.pos=0,th(this,i,new Uint8Array(8)),th(this,a,new DataView(to(this,i).buffer)),this.offsets=new WeakMap}seek(t){this.pos=t}writeU32(t){to(this,a).setUint32(0,t,!1),this.write(to(this,i).subarray(0,4))}writeU64(t){to(this,a).setUint32(0,Math.floor(t/0x100000000),!1),to(this,a).setUint32(4,t,!1),this.write(to(this,i).subarray(0,8))}writeAscii(t){for(let e=0;e<t.length;e++)to(this,a).setUint8(e%8,t.charCodeAt(e)),e%8==7&&this.write(to(this,i));t.length%8!=0&&this.write(to(this,i).subarray(0,t.length%8))}writeBox(t){if(this.offsets.set(t,this.pos),t.contents&&!t.children)this.writeBoxHeader(t,t.size??t.contents.byteLength+8),this.write(t.contents);else{let e=this.pos;if(this.writeBoxHeader(t,0),t.contents&&this.write(t.contents),t.children)for(let e of t.children)e&&this.writeBox(e);let s=this.pos,i=t.size??s-e;this.seek(e),this.writeBoxHeader(t,i),this.seek(s)}}writeBoxHeader(t,e){this.writeU32(t.largeSize?1:e),this.writeAscii(t.type),t.largeSize&&this.writeU64(e)}measureBoxHeader(t){return 8+8*!!t.largeSize}patchBox(t){let e=this.pos;this.seek(this.offsets.get(t)),this.writeBox(t),this.seek(e)}measureBox(t){if(t.contents&&!t.children)return this.measureBoxHeader(t)+t.contents.byteLength;{let e=this.measureBoxHeader(t);if(t.contents&&(e+=t.contents.byteLength),t.children)for(let s of t.children)s&&(e+=this.measureBox(s));return e}}};i=new WeakMap,a=new WeakMap;var ek=class extends ew{constructor(t){super(),th(this,l),th(this,r,void 0),th(this,n,new ArrayBuffer(65536)),th(this,o,new Uint8Array(to(this,n))),th(this,h,0),tl(this,r,t)}write(t){tm(this,l,f).call(this,this.pos+t.byteLength),to(this,o).set(t,this.pos),this.pos+=t.byteLength,tl(this,h,Math.max(to(this,h),this.pos))}finalize(){tm(this,l,f).call(this,this.pos),to(this,r).buffer=to(this,n).slice(0,Math.max(to(this,h),this.pos))}};r=new WeakMap,n=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakSet,f=function(t){let e=to(this,n).byteLength;for(;e<t;)e*=2;if(e===to(this,n).byteLength)return;let s=new ArrayBuffer(e),i=new Uint8Array(s);i.set(to(this,o),0),tl(this,n,s),tl(this,o,i)};var eg=class extends ew{constructor(t){super(),th(this,m,void 0),th(this,d,[]),tl(this,m,t)}write(t){to(this,d).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){if(0===to(this,d).length)return;let t=[],e=[...to(this,d)].sort((t,e)=>t.start-e.start);t.push({start:e[0].start,size:e[0].data.byteLength});for(let s=1;s<e.length;s++){let i=t[t.length-1],a=e[s];a.start<=i.start+i.size?i.size=Math.max(i.size,a.start+a.data.byteLength-i.start):t.push({start:a.start,size:a.data.byteLength})}for(let e of t){for(let t of(e.data=new Uint8Array(e.size),to(this,d)))e.start<=t.start&&t.start<e.start+e.size&&e.data.set(t.data,t.start-e.start);to(this,m).options.onData?.(e.data,e.start)}to(this,d).length=0}finalize(){}};m=new WeakMap,d=new WeakMap;var eC=class extends ew{constructor(t){if(super(),th(this,w),th(this,g),th(this,y),th(this,b),th(this,c,void 0),th(this,p,void 0),th(this,u,[]),tl(this,c,t),tl(this,p,t.options?.chunkSize??0x1000000),!Number.isInteger(to(this,p))||1024>to(this,p))throw Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(t){tm(this,w,k).call(this,t,this.pos),tm(this,b,S).call(this),this.pos+=t.byteLength}finalize(){tm(this,b,S).call(this,!0)}};c=new WeakMap,p=new WeakMap,u=new WeakMap,w=new WeakSet,k=function(t,e){let s=to(this,u).findIndex(t=>t.start<=e&&e<t.start+to(this,p));-1===s&&(s=tm(this,y,T).call(this,e));let i=to(this,u)[s],a=e-i.start,r=t.subarray(0,Math.min(to(this,p)-a,t.byteLength));i.data.set(r,a);let n={start:a,end:a+r.byteLength};if(tm(this,g,C).call(this,i,n),0===i.written[0].start&&i.written[0].end===to(this,p)&&(i.shouldFlush=!0),to(this,u).length>2){for(let t=0;t<to(this,u).length-1;t++)to(this,u)[t].shouldFlush=!0;tm(this,b,S).call(this)}r.byteLength<t.byteLength&&tm(this,w,k).call(this,t.subarray(r.byteLength),e+r.byteLength)},g=new WeakSet,C=function(t,e){let s=0,i=t.written.length-1,a=-1;for(;s<=i;){let r=Math.floor(s+(i-s+1)/2);t.written[r].start<=e.start?(s=r+1,a=r):i=r-1}for(t.written.splice(a+1,0,e),(-1===a||t.written[a].end<e.start)&&a++;a<t.written.length-1&&t.written[a].end>=t.written[a+1].start;)t.written[a].end=Math.max(t.written[a].end,t.written[a+1].end),t.written.splice(a+1,1)},y=new WeakSet,T=function(t){let e={start:Math.floor(t/to(this,p))*to(this,p),data:new Uint8Array(to(this,p)),written:[],shouldFlush:!1};return to(this,u).push(e),to(this,u).sort((t,e)=>t.start-e.start),to(this,u).indexOf(e)},b=new WeakSet,S=function(t=!1){for(let e=0;e<to(this,u).length;e++){let s=to(this,u)[e];if(s.shouldFlush||t){for(let t of s.written)to(this,c).options.onData?.(s.data.subarray(t.start,t.end),s.start+t.start);to(this,u).splice(e--,1)}}};var ey=class extends eC{constructor(t){super(new ep({onData:(e,s)=>t.stream.write({type:"write",data:e,position:s}),chunkSize:t.options?.chunkSize}))}},eT=1e3,eb=["avc","hevc","vp9","av1"],eS=["aac","opus"],ev=["strict","offset","cross-track-offset"],ex=class{constructor(t){if(th(this,I),th(this,N),th(this,V),th(this,H),th(this,P),th(this,q),th(this,J),th(this,Q),th(this,Y),th(this,tt),th(this,ts),th(this,ta),th(this,v,void 0),th(this,x,void 0),th(this,z,void 0),th(this,M,void 0),th(this,B,null),th(this,A,null),th(this,W,Math.floor(Date.now()/1e3)+0x7c25b080),th(this,U,[]),th(this,O,1),th(this,D,[]),th(this,E,[]),th(this,L,!1),tm(this,I,j).call(this,t),t.video=tU(t.video),t.audio=tU(t.audio),t.fastStart=tU(t.fastStart),this.target=t.target,tl(this,v,{firstTimestampBehavior:"strict",...t}),t.target instanceof ec)tl(this,x,new ek(t.target));else if(t.target instanceof ep)tl(this,x,t.target.options?.chunked?new eC(t.target):new eg(t.target));else if(t.target instanceof eu)tl(this,x,new ey(t.target));else throw Error(`Invalid target: ${t.target}`);tm(this,H,_).call(this),tm(this,N,R).call(this)}addVideoChunk(t,e,s,i){let a=new Uint8Array(t.byteLength);t.copyTo(a),this.addVideoChunkRaw(a,t.type,s??t.timestamp,t.duration,e,i)}addVideoChunkRaw(t,e,s,i,a,r){if(tm(this,ta,tr).call(this),!to(this,v).video)throw Error("No video track declared.");if("object"==typeof to(this,v).fastStart&&to(this,B).samples.length===to(this,v).fastStart.expectedVideoChunks)throw Error(`Cannot add more video chunks than specified in 'fastStart' (${to(this,v).fastStart.expectedVideoChunks}).`);let n=tm(this,q,G).call(this,to(this,B),t,e,s,i,a,r);if("fragmented"===to(this,v).fastStart&&to(this,A)){for(;to(this,E).length>0&&to(this,E)[0].decodeTimestamp<=n.decodeTimestamp;){let t=to(this,E).shift();tm(this,J,K).call(this,to(this,A),t)}n.decodeTimestamp<=to(this,A).lastDecodeTimestamp?tm(this,J,K).call(this,to(this,B),n):to(this,D).push(n)}else tm(this,J,K).call(this,to(this,B),n)}addAudioChunk(t,e,s){let i=new Uint8Array(t.byteLength);t.copyTo(i),this.addAudioChunkRaw(i,t.type,s??t.timestamp,t.duration,e)}addAudioChunkRaw(t,e,s,i,a){if(tm(this,ta,tr).call(this),!to(this,v).audio)throw Error("No audio track declared.");if("object"==typeof to(this,v).fastStart&&to(this,A).samples.length===to(this,v).fastStart.expectedAudioChunks)throw Error(`Cannot add more audio chunks than specified in 'fastStart' (${to(this,v).fastStart.expectedAudioChunks}).`);let r=tm(this,q,G).call(this,to(this,A),t,e,s,i,a);if("fragmented"===to(this,v).fastStart&&to(this,B)){for(;to(this,D).length>0&&to(this,D)[0].decodeTimestamp<=r.decodeTimestamp;){let t=to(this,D).shift();tm(this,J,K).call(this,to(this,B),t)}r.decodeTimestamp<=to(this,B).lastDecodeTimestamp?tm(this,J,K).call(this,to(this,A),r):to(this,E).push(r)}else tm(this,J,K).call(this,to(this,A),r)}finalize(){if(to(this,L))throw Error("Cannot finalize a muxer more than once.");if("fragmented"===to(this,v).fastStart){for(let t of to(this,D))tm(this,J,K).call(this,to(this,B),t);for(let t of to(this,E))tm(this,J,K).call(this,to(this,A),t);tm(this,tt,te).call(this,!1)}else to(this,B)&&tm(this,Y,Z).call(this,to(this,B)),to(this,A)&&tm(this,Y,Z).call(this,to(this,A));let t=[to(this,B),to(this,A)].filter(Boolean);if("in-memory"===to(this,v).fastStart){let e;for(let s=0;s<2;s++){let s=tN(t,to(this,W)),i=to(this,x).measureBox(s);e=to(this,x).measureBox(to(this,M));let a=to(this,x).pos+i+e;for(let t of to(this,U))for(let{data:s}of(t.offset=a,t.samples))a+=s.byteLength,e+=s.byteLength;if(a<0x100000000)break;e>=0x100000000&&(to(this,M).largeSize=!0)}let s=tN(t,to(this,W));for(let t of(to(this,x).writeBox(s),to(this,M).size=e,to(this,x).writeBox(to(this,M)),to(this,U)))for(let e of t.samples)to(this,x).write(e.data),e.data=null}else if("fragmented"===to(this,v).fastStart){let e=to(this,x).pos,s=en(t);to(this,x).writeBox(s);let i=to(this,x).pos-e;to(this,x).seek(to(this,x).pos-4),to(this,x).writeU32(i)}else{let e=to(this,x).offsets.get(to(this,M)),s=to(this,x).pos-e;to(this,M).size=s,to(this,M).largeSize=s>=0x100000000,to(this,x).patchBox(to(this,M));let i=tN(t,to(this,W));if("object"==typeof to(this,v).fastStart){to(this,x).seek(to(this,z)),to(this,x).writeBox(i);let t=e-to(this,x).pos;to(this,x).writeBox(tj(t))}else to(this,x).writeBox(i)}tm(this,ts,ti).call(this),to(this,x).finalize(),tl(this,L,!0)}};v=new WeakMap,x=new WeakMap,z=new WeakMap,M=new WeakMap,B=new WeakMap,A=new WeakMap,W=new WeakMap,U=new WeakMap,O=new WeakMap,D=new WeakMap,E=new WeakMap,L=new WeakMap,I=new WeakSet,j=function(t){if(t.video){if(!eb.includes(t.video.codec))throw Error(`Unsupported video codec: ${t.video.codec}`);let e=t.video.rotation;if("number"!=typeof e||[0,90,180,270].includes(e)){if(Array.isArray(e)&&(9!==e.length||e.some(t=>"number"!=typeof t)))throw Error(`Invalid video transformation matrix: ${e.join()}`)}else throw Error(`Invalid video rotation: ${e}. Has to be 0, 90, 180 or 270.`)}if(t.audio&&!eS.includes(t.audio.codec))throw Error(`Unsupported audio codec: ${t.audio.codec}`);if(t.firstTimestampBehavior&&!ev.includes(t.firstTimestampBehavior))throw Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`);if("object"==typeof t.fastStart){if(t.video&&void 0===t.fastStart.expectedVideoChunks)throw Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(t.audio&&void 0===t.fastStart.expectedAudioChunks)throw Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory","fragmented"].includes(t.fastStart))throw Error("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.")},N=new WeakSet,R=function(){if(to(this,x).writeBox(tL({holdsAvc:to(this,v).video?.codec==="avc",fragmented:"fragmented"===to(this,v).fastStart})),tl(this,z,to(this,x).pos),"in-memory"===to(this,v).fastStart)tl(this,M,tI(!1));else if("fragmented"===to(this,v).fastStart);else{if("object"==typeof to(this,v).fastStart){let t=tm(this,V,$).call(this);to(this,x).seek(to(this,x).pos+t)}tl(this,M,tI(!0)),to(this,x).writeBox(to(this,M))}tm(this,ts,ti).call(this)},V=new WeakSet,$=function(){if("object"!=typeof to(this,v).fastStart)return;let t=0;for(let e of[to(this,v).fastStart.expectedVideoChunks,to(this,v).fastStart.expectedAudioChunks])e&&(t+=8*Math.ceil(2/3*e)+4*e+12*Math.ceil(2/3*e)+4*e+8*e);return t+4096},H=new WeakSet,_=function(){if(to(this,v).video&&tl(this,B,{id:1,info:{type:"video",codec:to(this,v).video.codec,width:to(this,v).video.width,height:to(this,v).video.height,rotation:to(this,v).video.rotation??0,decoderConfig:null},timescale:11520,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),to(this,v).audio){let t=tm(this,P,F).call(this,2,to(this,v).audio.sampleRate,to(this,v).audio.numberOfChannels);tl(this,A,{id:to(this,v).video?2:1,info:{type:"audio",codec:to(this,v).audio.codec,numberOfChannels:to(this,v).audio.numberOfChannels,sampleRate:to(this,v).audio.sampleRate,decoderConfig:{codec:to(this,v).audio.codec,description:t,numberOfChannels:to(this,v).audio.numberOfChannels,sampleRate:to(this,v).audio.sampleRate}},timescale:to(this,v).audio.sampleRate,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]})}},P=new WeakSet,F=function(t,e,s){let i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),a="";a+=t.toString(2).padStart(5,"0"),a+=i.toString(2).padStart(4,"0"),15===i&&(a+=e.toString(2).padStart(24,"0"));let r=8*Math.ceil((a+=s.toString(2).padStart(4,"0")).length/8),n=new Uint8Array((a=a.padEnd(r,"0")).length/8);for(let t=0;t<a.length;t+=8)n[t/8]=parseInt(a.slice(t,t+8),2);return n},q=new WeakSet,G=function(t,e,s,i,a,r,n){let o=i/1e6,h=(i-(n??0))/1e6,l=a/1e6,f=tm(this,Q,X).call(this,o,h,t);return o=f.presentationTimestamp,h=f.decodeTimestamp,r?.decoderConfig&&(null===t.info.decoderConfig?t.info.decoderConfig=r.decoderConfig:Object.assign(t.info.decoderConfig,r.decoderConfig)),{presentationTimestamp:o,decodeTimestamp:h,duration:l,data:e,size:e.byteLength,type:s,timescaleUnitsToNextSample:tM(l,t.timescale)}},J=new WeakSet,K=function(t,e){"fragmented"!==to(this,v).fastStart&&t.samples.push(e);let s=tM(e.presentationTimestamp-e.decodeTimestamp,t.timescale);if(null!==t.lastTimescaleUnits){let i=Math.round(tM(e.decodeTimestamp,t.timescale,!1)-t.lastTimescaleUnits);if(t.lastTimescaleUnits+=i,t.lastSample.timescaleUnitsToNextSample=i,"fragmented"!==to(this,v).fastStart){let e=tx(t.timeToSampleTable);1===e.sampleCount?(e.sampleDelta=i,e.sampleCount++):e.sampleDelta===i?e.sampleCount++:(e.sampleCount--,t.timeToSampleTable.push({sampleCount:2,sampleDelta:i}));let a=tx(t.compositionTimeOffsetTable);a.sampleCompositionTimeOffset===s?a.sampleCount++:t.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:s})}}else t.lastTimescaleUnits=0,"fragmented"!==to(this,v).fastStart&&(t.timeToSampleTable.push({sampleCount:1,sampleDelta:tM(e.duration,t.timescale)}),t.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:s}));t.lastSample=e;let i=!1;if(t.currentChunk){let s=e.presentationTimestamp-t.currentChunk.startTimestamp;"fragmented"===to(this,v).fastStart?t===(to(this,B)??to(this,A))&&"key"===e.type&&s>=1&&(i=!0,tm(this,tt,te).call(this)):i=s>=.5}else i=!0;i&&(t.currentChunk&&tm(this,Y,Z).call(this,t),t.currentChunk={startTimestamp:e.presentationTimestamp,samples:[]}),t.currentChunk.samples.push(e)},Q=new WeakSet,X=function(t,e,s){let i="strict"===to(this,v).firstTimestampBehavior,a=-1===s.lastDecodeTimestamp,r=0!==e;if(i&&a&&r)throw Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${e}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if("offset"===to(this,v).firstTimestampBehavior||"cross-track-offset"===to(this,v).firstTimestampBehavior){let i;void 0===s.firstDecodeTimestamp&&(s.firstDecodeTimestamp=e),e-=i="offset"===to(this,v).firstTimestampBehavior?s.firstDecodeTimestamp:Math.min(to(this,B)?.firstDecodeTimestamp??1/0,to(this,A)?.firstDecodeTimestamp??1/0),t-=i}if(e<s.lastDecodeTimestamp)throw Error(`Timestamps must be monotonically increasing (DTS went from ${1e6*s.lastDecodeTimestamp} to ${1e6*e}).`);return s.lastDecodeTimestamp=e,{presentationTimestamp:t,decodeTimestamp:e}},Y=new WeakSet,Z=function(t){if("fragmented"===to(this,v).fastStart)throw Error("Can't finalize individual chunks 'fastStart' is set to 'fragmented'.");if(t.currentChunk){if(t.finalizedChunks.push(t.currentChunk),to(this,U).push(t.currentChunk),(0===t.compactlyCodedChunkTable.length||tx(t.compactlyCodedChunkTable).samplesPerChunk!==t.currentChunk.samples.length)&&t.compactlyCodedChunkTable.push({firstChunk:t.finalizedChunks.length,samplesPerChunk:t.currentChunk.samples.length}),"in-memory"===to(this,v).fastStart){t.currentChunk.offset=0;return}for(let e of(t.currentChunk.offset=to(this,x).pos,t.currentChunk.samples))to(this,x).write(e.data),e.data=null;tm(this,ts,ti).call(this)}},tt=new WeakSet,te=function(t=!0){if("fragmented"!==to(this,v).fastStart)throw Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let e=[to(this,B),to(this,A)].filter(t=>t&&t.currentChunk);if(0===e.length)return;let s=tf(this,O)._++;if(1===s){let t=tN(e,to(this,W),!0);to(this,x).writeBox(t)}let i=to(this,x).pos,a=t7(s,e);to(this,x).writeBox(a);{let t=tI(!1),s=0;for(let t of e)for(let e of t.currentChunk.samples)s+=e.size;let i=to(this,x).measureBox(t)+s;i>=0x100000000&&(t.largeSize=!0,i=to(this,x).measureBox(t)+s),t.size=i,to(this,x).writeBox(t)}for(let t of e)for(let e of(t.currentChunk.offset=to(this,x).pos,t.currentChunk.moofOffset=i,t.currentChunk.samples))to(this,x).write(e.data),e.data=null;let r=to(this,x).pos;to(this,x).seek(to(this,x).offsets.get(a));let n=t7(s,e);for(let t of(to(this,x).writeBox(n),to(this,x).seek(r),e))t.finalizedChunks.push(t.currentChunk),to(this,U).push(t.currentChunk),t.currentChunk=null;t&&tm(this,ts,ti).call(this)},ts=new WeakSet,ti=function(){to(this,x)instanceof eg&&to(this,x).flush()},ta=new WeakSet,tr=function(){if(to(this,L))throw Error("Cannot add new video or audio chunks after the file has been finalized.")}}}]);